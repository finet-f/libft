if (self.CavalryLogger) { CavalryLogger.start_js(["ucQ+B"]); }

__d("MercuryAssert",["MercuryIDs"],(function(a,b,c,d,e,f){__p&&__p();e.exports={isParticipantID:function(a){if(!b("MercuryIDs").isValid(a))throw new Error("bad_participant_id "+a)},allParticipantIDs:function(a){a.forEach(this.isParticipantID)},isUserParticipantID:function(a){var c=b("MercuryIDs").tokenize(a);if(c.type!="fbid")throw new Error("bad_user_id "+a)},isEmailParticipantID:function(a){var c=b("MercuryIDs").tokenize(a);if(c.type!="email")throw new Error("bad_email_id "+a)},allThreadID:function(a){a.forEach(this.isThreadID)},isThreadID:function(a){if(!b("MercuryIDs").isValid(a))throw new Error("bad_thread_id "+a)}}}),null);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function(a,b,c,d,e,f){"use strict";a=b("EmojiStaticConfig").sizeMap;c=Object.freeze({XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"});d={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"};f=Object.freeze({PICKER:"picker",HOT_LIKE:"hot_like"});b=[983040];var g="hot_emoji_source",h="hot_emoji_size",i="emoji_like",j="\ud83d\udc4d",k=[128077];e.exports={FB_THUMBS_UP_EMOJI:b,size:c,sizeMap:a,sizeMapTransfer:d,source:f,SOURCE_TAG_PREFIX:g,TAG_PREFIX_NEW:h,TAG_PREFIX_OLD:i,THUMBS_UP_EMOJI:j,THUMBS_UP_EMOJI_CODES:k}}),null);
__d("MercuryTagHelper",[],(function(a,b,c,d,e,f){"use strict";a={get:function(a,b){a=a.find(function(a){return a.startsWith(b)});return a==null?a:a.substr(a.indexOf(":")+1)}};e.exports=a}),null);
__d("EmojiLikeUtils",["EmojiLikeConstants","MercuryTagHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){!a.tags?a.tags=[g(b)]:a.tags.push(g(b));return a}function g(a){var c=b("EmojiLikeConstants").TAG_PREFIX_NEW;return c+":"+a}function c(a,b){!a.tags?a.tags=[h(b)]:a.tags.push(h(b));return a}function h(a){return b("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+a}function d(a){return i(a)!=null}function i(a){if(!a.tags)return null;var c=b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_NEW);return c?c:b("MercuryTagHelper").get(a.tags,b("EmojiLikeConstants").TAG_PREFIX_OLD)}e.exports={getEmojiSize:i,isEmojiLike:d,setEmojiSize:a,setEmojiSource:c}}),null);
__d("MercuryAttachment",["cx","EmojiLikeUtils","MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType","StoryAttachmentStyle"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=function(a){return a===Object(a)},i="_1c_u",j=new Set([b("MercuryAttachmentType").ANIMATED_IMAGE,b("MercuryAttachmentType").PHOTO,b("MercuryAttachmentType").VIDEO,b("MercuryAttachmentType").THIRDPARTYSTICKER]),k={getAttachIconClass:function(a){__p&&__p();switch(a){case b("MercuryAttachmentContentType").PHOTO:return"_y2-";case b("MercuryAttachmentContentType").VIDEO:return"_y2_";case b("MercuryAttachmentContentType").MUSIC:return"_y30";case b("MercuryAttachmentContentType").VOICE:return"_y31";case b("MercuryAttachmentContentType").TEXT:return"_y32";case b("MercuryAttachmentContentType").PDF:return"_1k9k";case b("MercuryAttachmentContentType").RICHTEXT:return"_1k9l";case b("MercuryAttachmentContentType").SPREADSHEET:return"_1k9p";case b("MercuryAttachmentContentType").PRESENTATION:return"_1k9r";case b("MercuryAttachmentContentType").ARCHIVE:return"_1k9s";case b("MercuryAttachmentContentType").MSWORD:return"_y33";case b("MercuryAttachmentContentType").MSXLS:return"_y34";case b("MercuryAttachmentContentType").MSPPT:return"_y35"}return"_y36"},getAttachIconClassByMime:function(a){return this.getAttachIconClass(this.getAttachTypeByMime(a))},getAttachTypeByMime:function(a){__p&&__p();if(!a)return b("MercuryAttachmentContentType").UNKNOWN;if(a.startsWith("image"))return b("MercuryAttachmentContentType").PHOTO;else if(a.startsWith("video"))return b("MercuryAttachmentContentType").VIDEO;else if(a.startsWith("audio"))return b("MercuryAttachmentContentType").MUSIC;else if(a.startsWith("text/plain"))return b("MercuryAttachmentContentType").TEXT;else if(a=="text/pdf"||a=="application/pdf"||a=="application/vnd.pdf"||a=="application/x-pdf")return b("MercuryAttachmentContentType").PDF;else if(a=="text/richtext"||a=="application/rtf"||a=="application/x-iwork-pages-sffkey")return b("MercuryAttachmentContentType").RICHTEXT;else if(a=="text/csv"||a=="application/x-iwork-numbers-sffkey")return b("MercuryAttachmentContentType").SPREADSHEET;else if(a=="application/x-iwork-keynote-sffkey")return b("MercuryAttachmentContentType").PRESENTATION;else if(a=="application/vnd.ms-cab-compressed"||a=="application/x-7z-compressed"||a=="application/x-ace-compressed"||a=="application/x-apple-diskimage"||a=="application/x-compress"||a=="application/x-compressed"||a=="application/x-gzip"||a=="application/x-rar-compressed"||a=="application/x-tar"||a=="application/x-zip-compressed"||a=="application/zip")return b("MercuryAttachmentContentType").ARCHIVE;else if(a=="application/msword"||a.startsWith("application/vnd.ms-word")||a.startsWith("application/vnd.openxmlformats-officedocument.wordprocessingml"))return b("MercuryAttachmentContentType").MSWORD;else if(a.startsWith("application/vnd.ms-excel")||a.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml"))return b("MercuryAttachmentContentType").MSXLS;else if(a.startsWith("application/vnd.ms-powerpoint")||a.startsWith("application/vnd.openxmlformats-officedocument.presentationml"))return b("MercuryAttachmentContentType").MSPPT;else return b("MercuryAttachmentContentType").UNKNOWN},convertRaw:function(a){__p&&__p();var c=[];for(var d=0;d<a.length;d++){var e=a[d];if(e.attach_type===b("MercuryAttachmentType").PHOTO)c.push(e);else if(e.filename){var f=k.getAttachTypeByMime(e.filetype),g={};g.attach_type=b("MercuryAttachmentType").FILE;g.name=e.filename;g.icon_type=f;g.url="";c.push(g)}}return c},get:function(a){__p&&__p();var c=[];a.attachments?c=a.attachments:a.raw_attachments&&(c=this.convertRaw(a.raw_attachments));var d=b("EmojiLikeUtils").getEmojiSize(a);d&&(c=c.concat([{attach_type:b("MercuryAttachmentType").EMOJI_LIKE,size:d}]));if(!(a.attachments&&a.attachments.length>0)){if(a.sticker_id)return c.concat([{attach_type:b("MercuryAttachmentType").STICKER}]);if(a.preview_attachments&&a.preview_attachments.length>0)return c.concat(a.preview_attachments)}return c},resizeContain:function(a,b){var c=a.width/a.height,d=b.width/b.height;if(d<c)return{width:Math.ceil(Math.min(a.height*d,b.width)),height:Math.ceil(Math.min(a.height,b.height))};else return{width:Math.ceil(Math.min(a.width,b.width)),height:Math.ceil(Math.min(a.width/d,b.height))}},isBubblePreferred:function(a){return this.isFileAttachment(a)},isPhotoAttachment:function(a){return!!(a.attach_type==b("MercuryAttachmentType").PHOTO||a.attach_type==b("MercuryAttachmentType").ANIMATED_IMAGE||a.attach_type==b("MercuryAttachmentType").THIRDPARTYSTICKER||a.attach_type==b("MercuryAttachmentType").FILE&&a.preview_url)},isPhotoGroupAttachment:function(a){return j.has(a.attach_type)},isSinglePhotoGroupAttachment:function(a){return!!(a.attachments&&a.attachments.length===1&&a.attachments[0]&&this.isPhotoGroupAttachment(a.attachments[0]))},isVideoAttachment:function(a){return a.attach_type==b("MercuryAttachmentType").VIDEO},isShareAttachment:function(a){return a.attach_type==b("MercuryAttachmentType").SHARE},isFileAttachment:function(a){return a.attach_type==b("MercuryAttachmentType").FILE},isErrorAttachment:function(a){return a.attach_type==b("MercuryAttachmentType").ERROR},isStickerAttachment:function(a){return a.attach_type==b("MercuryAttachmentType").STICKER},isEmojiLikeAttachment:function(a){return a.attach_type===b("MercuryAttachmentType").EMOJI_LIKE},isVoiceAttachment:function(a){return!a.metadata?!1:a.metadata.type===b("MercuryAudioType").AudioClip||a.metadata.type===b("MercuryAudioType").VoiceMessageWithTranscript},hasAttribution:function(a){return!!a.app_attribution},isLightweightActionAttachment:function(a){return!!(k.isShareAttachment(a)&&a.share&&a.share.target!=null&&a.share.target.lwa_type!=null)},isSingleVideoAttachment:function(a){a=this.get(a).filter(h).filter(function(a){return this.isVideoAttachment(a)}.bind(this));return a.length===1},isSharedVideoAttachment:function(a){a=a.attach_type===b("MercuryAttachmentType").SHARE&&a.share&&a.share.subattachments&&a.share.subattachments[0];return!!(a&&a.target&&a.target.video_id)},isGenieSharedVideoAttachment:function(a){return!!(a.attach_type===b("MercuryAttachmentType").SHARE&&a.share&&a.share.style_list.indexOf(b("StoryAttachmentStyle").GENIE_MESSAGE)>-1&&a.share.target&&a.share.target.attachment&&this.isSharedVideoAttachment(a.share.target.attachment))},isSharedVideoAttachmentMessage:function(a){a=this.get(a).filter(h).filter(function(a){return this.isSharedVideoAttachment(a)||this.isGenieSharedVideoAttachment(a)}.bind(this));return a.length===1},getVideoElem:function(a,b){b=b.getMessageElement(a);if(!b)return null;a=b.getElementsByClassName(i);return a&&a.length?a[0]:b}};e.exports=k}),null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a={renderFilteredContent:function(a){if(a.is_filtered_content_bh)return g._("Ce message a \u00e9t\u00e9 bloqu\u00e9, car il contient des liens bloqu\u00e9s ou dangereux.");if(a.is_filtered_content_account)return g._("Ce message a \u00e9t\u00e9 supprim\u00e9 temporairement car le compte de l\u2019exp\u00e9diteur n\u00e9cessite une v\u00e9rification.");if(a.is_filtered_content_quasar)return g._("Ce message a \u00e9t\u00e9 supprim\u00e9 car il contient du contenu bloqu\u00e9 ou dangereux.");return a.is_filtered_content_invalid_app?g._("Ce message a \u00e9t\u00e9 supprim\u00e9, car l\u2019app dont il provient n\u2019a pas l\u2019autorisation d\u2019envoyer des messages."):g._("Ce message a \u00e9t\u00e9 temporairement supprim\u00e9, car le compte de l\u2019exp\u00e9diteur doit \u00eatre v\u00e9rifi\u00e9 ou a \u00e9t\u00e9 identifi\u00e9 comme \u00e9tant abusif.")}};e.exports=a}),null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={generateMessageID:function(a){a=a||Date.now();var c=b("randomInt")(0,4294967295),d=b("PresenceUtil").getSessionID();return"<"+a+":"+c+"-"+d+"@mail.projektitan.com>"},generateThreadID:function(a){return"root:"+g.generateOfflineThreadingID(a)},generateOfflineThreadingID:function(a){a=a||Date.now();var c=b("randomInt")(0,4294967295);c=("0000000000000000000000"+c.toString(2)).slice(-22);a=a.toString(2)+c;return h(a.slice(-63))}};function h(a){var b="";while(a!="0"){var c=0,d="";for(var e=0;e<a.length;e++)c=2*c+parseInt(a[e],10),c>=10?(d+="1",c-=10):d+="0";b=c.toString()+b;a=d.slice(d.indexOf("1"))}return b}e.exports=g}),null);
__d("MercuryMessageClientState",[],(function(a,b,c,d,e,f){a=Object.freeze({DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"});e.exports=a}),null);
__d("MessengerMQTTConnectionEvents",[],(function(a,b,c,d,e,f){"use strict";e.exports={DELTA_EVENT:"messenger-mqtt-delta",STREAM_DISCONNECT:"messenger-mqtt-stream-disconnect",STREAM_CONNECTING:"messenger-mqtt-stream-connecting",STREAM_CONNECT:"messenger-mqtt-stream-connect",STATE_CONNECTED:"Connected",STATE_DISCONNECTED:"Disconnected",STATE_CONNECTING:"Connecting",TYP:"messenger-mqtt-typ"}}),null);
__d("MessengerMQTTGating",["gkx"],(function(a,b,c,d,e,f){"use strict";var g={_forcedOff:!1,isEnabled:function(){return b("gkx")("678651")&&!g._forcedOff},turnOff:function(){g._forcedOff=!0}};e.exports=g}),null);
__d("MercurySyncEventsProxy",["Arbiter","Bootloader","ChannelConstants","LogHistory","MercurySingletonProvider","MessengerMQTTConnectionEvents","MessengerMQTTGating","gkx","ifRequired"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("LogHistory").getInstance("mercury_event_proxy"),h={DELTA:"DELTA",FAKE_DFF:"FAKE_DFF",FLOW:"FLOW",FLOW_REJECT:"FLOW_REJECT",INIT:"MercurySyncDeltaHandler/initSeqID",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",SHUTDOWN:"SHUTDOWN",TYP:"TYP"};i.getArbiterTypeForFBID=function(a,event){return a+"/"+event};i.getForFBID=function(a){return j.getForFBID(a)};i.get=function(){return j.get()};function i(a){this.$2=[],this.$3=[],this.$1=a,this.init()}i.prototype.getArbiterType=function(event){return i.getArbiterTypeForFBID(this.$1,event)};i.prototype.init=function(){__p&&__p();this.$2.forEach(function(a){return b("Arbiter").unsubscribe(a)});this.$3.forEach(function(a){return b("ifRequired")("ChannelConnection",function(b){return b.unsubscribe(a)})});var a=[],c=[],d=b("MessengerMQTTGating").isEnabled(),e=d?b("MessengerMQTTConnectionEvents").DELTA_EVENT:b("ChannelConstants").getArbiterType("delta");a.push(b("Arbiter").subscribe(e,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.DELTA)].concat(d))}.bind(this)),b("Arbiter").subscribe("messenger-mqtt-drop-down-to-channel",function(){return this.init()}.bind(this)));!d?(a.push(b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("deltaflow"),function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.FLOW)].concat(d))}.bind(this)),b("Arbiter").subscribe(b("ChannelConstants").getArbiterType("deltaflowreject"),function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.FLOW_REJECT)].concat(d))}.bind(this))),b("Bootloader").loadModules(["ChannelConnection","ChannelConnectionEvents"],function(a,d){__p&&__p();c.push(a.subscribe(d.CONNECTED,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.CONNECTED)].concat(d))}.bind(this)),a.subscribe(d.RECONNECTING,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.RECONNECTING)].concat(d))}.bind(this)),a.subscribe(d.SHUTDOWN,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.SHUTDOWN)].concat(d))}.bind(this)))}.bind(this),"MercurySyncEventsProxy")):a.push(b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").STREAM_CONNECT,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.CONNECTED)].concat(d))}.bind(this)),b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").STREAM_DISCONNECT,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.SHUTDOWN)].concat(d))}.bind(this)),b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").STREAM_CONNECTING,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.RECONNECTING)].concat(d))}.bind(this)));a.push(b("Arbiter").subscribe(b("ChannelConstants").getArbiterType(b("ChannelConstants").FAKE_DFF),function(a){g.debug("fakedff",JSON.stringify({fbid:this.$1}));for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.FAKE_DFF)].concat(d))}.bind(this)));d&&b("gkx")("678650")?a.push(b("Arbiter").subscribe(b("MessengerMQTTConnectionEvents").TYP,function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.TYP)].concat(d))}.bind(this))):a.push(b("Arbiter").subscribe([b("ChannelConstants").getArbiterType("typ"),b("ChannelConstants").getArbiterType("ttyp")],function(a){for(var c=arguments.length,d=new Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b("Arbiter").inform.apply(b("Arbiter"),[this.getArbiterType(h.TYP)].concat(d))}.bind(this)));this.$2=a;this.$3=c};i.Events=h;var j=new(b("MercurySingletonProvider"))(i);e.exports=i}),null);
__d("MercuryThreadInfo",["MercuryIDs","MessengerThreadCannotReplyReason"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={canReply:function(a){return!!(a.is_subscribed&&(a.can_reply===undefined||a.can_reply)&&!a.has_email_participant&&!a.read_only)},getMuteSetting:function(a){return a.mute_until?a.mute_until:undefined},isEmptyLocalThread:function(a){return b("MercuryIDs").tokenize(a.thread_id).type==="root"&&!a.timestamp},isMuted:function(a){a=g.getMuteSetting(a);return a!=null&&(a>Date.now()/1e3||a===-1)},areMentionsMuted:function(a){return a.mentions_mute_mode===1},areReactionsMuted:function(a){return a.reactions_mute_mode===1},isNewEmptyLocalThread:function(a){return!!(g.isEmptyLocalThread(a)&&a.participants&&a.participants.length===0)},showComposer:function(a){return!!(a.is_subscribed&&(a.can_reply||!a.cannot_reply_reason||a.cannot_reply_reason===b("MessengerThreadCannotReplyReason").BLOCKED)&&!a.has_email_participant&&!a.read_only)},isColdOpen:function(a){return!!(a.is_canonical_user&&(a.message_count===0||!a.timestamp))}};e.exports=g}),null);
__d("MercuryThreadInformer",["ArbiterMixin","LogHistory","MercuryAssert","MercurySingletonProvider","mixin"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h=b("LogHistory").getInstance("mercury_informer");c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));g=c&&c.prototype;a.get=function(){return i.get()};a.getForFBID=function(a){return i.getForFBID(a)};function a(a){g.constructor.call(this),this.$MercuryThreadInformer1=a,this.$MercuryThreadInformer2={},this.$MercuryThreadInformer3={},this.$MercuryThreadInformer4={},this.$MercuryThreadInformer5={},this.$MercuryThreadInformer6=!1,this.$MercuryThreadInformer7=!1,this.$MercuryThreadInformer8=!1,this.$MercuryThreadInformer9={},this.$MercuryThreadInformer10={},this.$MercuryThreadInformer11={},this.$MercuryThreadInformer12=0}a.prototype.updatedThread=function(a){this.$MercuryThreadInformer3[a]=!0,this.$MercuryThreadInformer13()};a.prototype.invalidatedThread=function(a){this.$MercuryThreadInformer4[a]=!0,this.$MercuryThreadInformer13()};a.prototype.deletedThread=function(a){this.$MercuryThreadInformer2[a]=!0,this.$MercuryThreadInformer13()};a.prototype.updatedThreadlist=function(){this.$MercuryThreadInformer6=!0,this.$MercuryThreadInformer13()};a.prototype.updatedUnseenState=function(){this.$MercuryThreadInformer7=!0,this.$MercuryThreadInformer13()};a.prototype.updatedUnreadState=function(){this.$MercuryThreadInformer8=!0,this.$MercuryThreadInformer13()};a.prototype.changedThreadReadState=function(a,b,c){(!this.$MercuryThreadInformer5[a]||this.$MercuryThreadInformer5[a].timestamp<c)&&(this.$MercuryThreadInformer5[a]={mark_as_read:b,timestamp:c}),this.$MercuryThreadInformer13()};a.prototype.receivedMessage=function(a){b("MercuryAssert").isThreadID(a.thread_id);var c=a.thread_id;this.$MercuryThreadInformer9[c]||(this.$MercuryThreadInformer9[c]=[]);this.$MercuryThreadInformer9[c].push(a);this.updatedThread(c)};a.prototype.reorderedMessages=function(a,b){this.$MercuryThreadInformer10[a]={source:b},this.$MercuryThreadInformer13()};a.prototype.updatedMessage=function(a,b,c){this.$MercuryThreadInformer11[a]||(this.$MercuryThreadInformer11[a]={}),this.$MercuryThreadInformer11[a][b]={source:c},this.updatedThread(a)};a.prototype.synchronizeInforms=function(a){this.$MercuryThreadInformer12++;try{a()}catch(a){throw a}finally{this.$MercuryThreadInformer12--,this.$MercuryThreadInformer13()}};a.prototype.listen=function(a,b){return this.subscribe("threads-updated",function(c,d){d[a]&&b(a)})};a.prototype.$MercuryThreadInformer13=function(){__p&&__p();if(!this.$MercuryThreadInformer12){var a=this.$MercuryThreadInformer2,b=this.$MercuryThreadInformer3,c=this.$MercuryThreadInformer4,d=this.$MercuryThreadInformer5,e=this.$MercuryThreadInformer6,f=this.$MercuryThreadInformer7,g=this.$MercuryThreadInformer8,h=this.$MercuryThreadInformer9,i=this.$MercuryThreadInformer10,j=this.$MercuryThreadInformer11;this.$MercuryThreadInformer2={};this.$MercuryThreadInformer3={};this.$MercuryThreadInformer4={};this.$MercuryThreadInformer5={};this.$MercuryThreadInformer6=!1;this.$MercuryThreadInformer7=!1;this.$MercuryThreadInformer8=!1;this.$MercuryThreadInformer9={};this.$MercuryThreadInformer10={};this.$MercuryThreadInformer11={};var k=Object.keys(b);(k.length||e)&&this.inform("threadlist-updated",k);k.length&&this.$MercuryThreadInformer14("threads-updated",b);for(var e in c){this.$MercuryThreadInformer14("thread-invalidated",c);break}for(var e in d){this.$MercuryThreadInformer14("thread-read-changed",d);break}for(e in a){this.$MercuryThreadInformer14("threads-deleted",a);break}f&&this.$MercuryThreadInformer14("unseen-updated",null);g&&this.$MercuryThreadInformer14("unread-updated",null);for(e in h){this.$MercuryThreadInformer14("messages-received",h);break}for(e in i){this.$MercuryThreadInformer14("messages-reordered",i);break}for(e in j){this.$MercuryThreadInformer14("messages-updated",j);break}}};a.prototype.$MercuryThreadInformer14=function(a,b){a==="threads-updated"&&h.debug(a,JSON.stringify(b)),this.inform(a,b)};var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],(function(a,b,c,d,e,f){"use strict";var g="fbid:"+b("CurrentUser").getID();a={getID:function(){return g},isViewer:function(a){b("MercuryAssert").isParticipantID(a);return a===g}};e.exports=a}),null);
__d("MercuryMessageDeliveryState",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SENDING:1,SENT:2,DELIVERED:3,ERROR:0,UNKNOWN:-1});e.exports=a}),null);
__d("MessengerState.bs",["invariant","URI","FBID.bs","bs_list","bs_array","bs_block","bs_curry","JSSet.bs","Utils.bs","FBJSON","Arbiter","gkx","bs_js_dict","bs_belt_Map","bs_belt_Set","bs_caml_obj","JSLogger","FBIDCheck","immutable","bs_belt_Array","bs_caml_array","ChatConfig","LogHistory","MercuryIDs","bs_pervasives","bs_belt_Option","CurrentUser","ReasonReact.bs","bs_js_primitive","MessagingTag","TypingStates","MercuryAssert","MercuryViewer","ParticipantId.bs","bs_belt_MapString","bs_caml_primitive","MercuryFilters.bs","ImmutableObject","MercuryLocalIDs","ChannelConstants","MessengerFolders.bs","MessengerMessage.bs","bs_js_null_undefined","MercuryActionType","MercuryAttachment","MercuryMessageIDs.bs","MercuryThreadInfo","MessengerPersonas.bs","XGroupsController","MercuryThreadIDMap","PageCommItemStatus","MercuryActionStatus","MercuryPayloadSource","MercuryThreadActions","MessengerThreadUtils.bs","MercuryLogMessageType","MercuryServerRequests","MercuryThreadInformer","MercurySyncEventsProxy","bs_caml_builtin_exceptions","MercuryGlobalActionType","MercuryMessageClientState","MessengerGroupsSyncStatus","MercuryThreadlistConstants","MessengerSharedMediaActions","setTimeoutAcrossTransitions","MessagingGenericAdminTextType","ChatReliabilityInstrumentation","MercuryDisplayTimeFilterMessageRenderer"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(a){return a[0]}function c(a){return a[1]}function d(a){return a[2]}function e(a){return a[3]}function h(a){return a[4]}function i(a){return a[5]}function j(a){return a[6]}function k(a){return a[7]}function l(a){return a[8]}function m(a){return a[9]}function n(a){return a[10]}function o(a){return a[11]}function p(a){return a[12]}function q(a){return a[13]}function r(a){return a[14]}function s(a){return a[15]}function t(a){return a[16]}function u(a){return a[17]}function v(a){return a[18]}function w(a){b("ChatReliabilityInstrumentation").logMESSAGE_RECEIVED(b("FBJSON").stringify({otid:a.offline_threading_id,message_id:a.message_id,other_user_fbid:a.other_user_fbid}));return 0}var x=function(a,b){delete a[b];return 0};function aa(a,c,d){var e=b("bs_belt_MapString").get(a,c);if(e!==undefined){e=b("bs_js_primitive").valFromOption(e);var f=b("bs_belt_Map").get(e,d);if(f!==undefined)return b("bs_belt_MapString").set(a,c,b("bs_belt_Map").remove(e,d));else return a}else return a}function ba(c,a){var d=b("bs_caml_obj").caml_notequal(a.author,b("MercuryViewer").getID()),e=a.thread_id;if(d&&!(e==null)){d=aa(c[6],e,a.author);if(d!==c[6])return[c[0],c[1],c[2],c[3],c[4],c[5],d,c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]];else return c}else return c}function ca(a,c){__p&&__p();var d=c.thread_fbid;if(d==null)if(c.type==="typ"||c.type==="page_typing"){c=b("FBID.bs").ofString(c.from.toString());if(c!==undefined)return b("MercuryIDs").getThreadIDFromUserID(b("bs_js_primitive").valFromOption(c));else return null}else return null;else{c=b("MercuryThreadIDMap").getForFBID(a);return c.getClientIDFromServerIDNow(d.toString())}}var y=b("MercuryFilters.bs").getSupportedFilters(0).concat([b("MercuryFilters.bs").all,b("MercuryFilters.bs").groups]),z=b("MessengerFolders.bs").getSupportedFolders(0).concat([b("MessagingTag").SPAM,b("MessagingTag").PAGE_BACKGROUND]);function da(){var a={};z.forEach(function(b){var c={};y.forEach(function(a){c[a]={threadlist:[],reachedEnd:!1,existingIDs:new Set()};return 0});a[b]=c;return 0});return a}function ea(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.invalidatedThread(c);return 0}function A(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.updatedMessage(c,d,b("bs_js_null_undefined").fromOption(e));return 0}function fa(c,a){c=b("MercuryThreadInformer").getForFBID(c);c.receivedMessage(a);return 0}function ga(a,c,d){a=b("MercuryThreadInformer").getForFBID(a);a.reorderedMessages(c,d);return 0}var ha=function(a,b){delete a[b];return 0};function B(a,c){var d=a[10].get(c);return b("bs_js_primitive").nullable_to_opt(a[9].get(b("bs_belt_Option").getWithDefault(d==null?undefined:b("bs_js_primitive").some(d),c)))}function C(a,c,d){a=a!==undefined?a:!1;d=b("bs_belt_Array").keepMap(d,function(a){return B(c,a)});if(a)return d.slice().reverse();else return d}function ia(a,c){return b("bs_belt_Array").keepMap(c,function(b){return B(a,b)}).sort(function(a,c){return b("MessengerMessage.bs").compare(c,a)}).map(function(a){return a.message_id})}function ja(a,b){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9].set(b[0],b[1]),a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}function ka(b,a){b[10].set(a.message_id,a.message_id);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}var D=function(a,b){delete a[b];return 0};function E(c,d){__p&&__p();var a=c[15];Object.keys(d).forEach(function(e){__p&&__p();var f=d[e];if(f!==undefined){var g=f[0],h=g[2],i=g[1];g=a.get(g[0]);if(g==null)return 0;else{g=g[1];if(g.length>=(i+h|0)){b("bs_curry")._2(D,d,e);return b("bs_curry")._1(f[1],C(!0,c,g.slice(i,i+h|0)))}else return 0}}else return 0});return 0}function la(c,d,e){__p&&__p();var a=e[1],f=e[0];b("MessengerMessage.bs").finalizeRanges(a);var g=a.offline_threading_id;if(!(g==null)&&g!==a.message_id){c[10].set(g,a.message_id);b("MercuryMessageIDs.bs").addServerID(g,a.message_id);g=a.threading_id;g==null||b("MercuryMessageIDs.bs").addServerID(g,a.message_id)}g=c[9].has(f);var h=c[0],i=c[1],j=c[2],k=c[3],l=c[4],m=c[5],n=c[6],o=c[7],p=c[8],q=c[9].set(f,a),r=c[10],s=c[11],t=c[12],u=c[13],v=c[14],w=c[15],x=c[16],aa=c[17];c=c[18];h=[h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,aa,c];if(!g&&e[2]===1){i=b("MercuryIDs").isLocalThread(a.thread_id);j=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").flatMap(b("bs_js_primitive").nullable_to_opt(a.thread_id),function(a){return b("bs_js_primitive").nullable_to_opt(w.get(a))}),[i?1:0,[]]);k=a.thread_id;if(!(k==null)){l=ia(h,[f].concat(j[1].filter(function(c){return b("bs_caml_obj").caml_notequal(c,a.offline_threading_id)})));w.set(k,[j[0],l])}E(h,d[3][0])}return h}function ma(b,c,a){b[11].set(c,a);return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15],b[16],b[17],b[18]]}function na(a,c){var d=c[1];c=c[0];var e=a[11].get(c);b("bs_belt_Option").isSome(e==null?undefined:b("bs_js_primitive").some(e))||g(0,1777);a[11]["delete"](c);if(e==null)return b("bs_pervasives").failwith("Message must exist to update");else return Object.assign(e,{image_ids:d.image_ids,file_ids:d.file_ids,audio_ids:d.audio_ids,gif_ids:d.gif_ids,video_ids:d.video_ids,client_state:b("MercuryMessageClientState").SEND_TO_SERVER})}function oa(a,c){__p&&__p();var d=c[0],e=a[15].get(d);if(e==null)return a;else{var f=b("bs_array").map(function(a){return a.message_id},b("bs_belt_Array").keepMap(c[1],function(b){return B(a,b)})),g=ia(a,e[1].filter(function(a){return f.indexOf(a)===-1}));a[15].set(d,[e[0],g]);ga(a[0],d,b("bs_js_null_undefined").fromOption(c[2]));return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15],a[16],a[17],a[18]]}}function pa(c,d,e,f){__p&&__p();var g=e.client_message_id;if(g==null)return c;else{var h=B(c,g);if(h!==undefined){h=b("bs_js_primitive").valFromOption(h);var i=e.message_id,j=e.status;if(b("bs_caml_obj").caml_equal(h.status,b("MercuryActionStatus").SUCCESS))return c;else if(c[9].has(i)){var a=Object.assign(Object.assign({},h),e);A(c[0],a.thread_id,a.message_id,f);return ja(c,[i,a])}else{a=b("bs_caml_obj").caml_equal(e.status,b("MercuryActionStatus").SUCCESS);a=a?e.error_data:null;b("MercuryMessageIDs.bs").addServerID(g,i);c[10].set(g,i);h=Object.assign(h,{status:j,error_data:a,timestamp:e.timestamp,log_message_data:e.log_message_data,ranges:e.ranges,attachments:e.attachments});b("MessengerMessage.bs").finalizeRanges(h);j=ja(c,[i,h]);j[9].set(g,{});j[9]["delete"](g);a=h.thread_id;e=j[15].get(a);if(!(e==null)){var k=ia(j,e[1]);j[15].set(a,[e[0],k])}A(j[0],h.thread_id,h.message_id,f);a=b("MessengerMessage.bs").isTitanMessage(h);e=d[2].get(h.thread_id);a&&(e==null||d[2].set(h.thread_id,e-1|0));return[j[0],j[1],j[2],j[3],j[4],j[5],j[6],j[7],j[8],j[9],j[10].set(g,i),j[11],j[12],j[13],j[14],j[15],j[16],j[17],j[18]]}}else return c}}function qa(a,c,d){__p&&__p();if(d!==undefined&&b("bs_caml_obj").caml_equal(b("bs_js_primitive").valFromOption(d),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)&&b("bs_caml_obj").caml_equal(c.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)){d=c.offline_threading_id;if(d==null||!b("bs_caml_obj").caml_equal(b("bs_js_primitive").nullable_to_opt(a[10].get(d)),d))d=1;else return Object.assign({},Object.assign(c,{client_message_id:c.offline_threading_id,status:b("MercuryActionStatus").SUCCESS,action_type:b("MercuryActionType").SEND_MESSAGE}));if(d===1){d=b("bs_belt_Option").flatMap(b("bs_js_primitive").nullable_to_opt(c.thread_id),function(c){return b("bs_js_primitive").undefined_to_opt(a[7][c])});if(d!==undefined)return Object.assign(Object.assign({},c),{folder:b("bs_js_primitive").valFromOption(d).folder});else return c}}else return c}function ra(a,c,d,e){__p&&__p();d=qa(a,d,e);if(b("bs_caml_obj").caml_equal(d.action_type,b("MercuryActionType").SEND_MESSAGE))return pa(a,c,d,e);else{var f=d.offline_threading_id;f=b("bs_belt_Option").flatMap(f==null?undefined:b("bs_js_primitive").some(f),function(c){return b("bs_js_primitive").nullable_to_opt(a[10].get(c))});var g=B(a,d.message_id);if(f!==undefined||g!==undefined)return a;else{f=b("bs_caml_obj").caml_equal(e,b("bs_js_primitive").some(b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))?ka(a,d):a;g=b("bs_caml_obj").caml_equal(d.client_state,b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER);e=d.upload_id;g=g&&!(e==null)?ma(f,e,d):f;e=b("MessengerMessage.bs").isErrorLogMessage(d);f=d.thread_id;e&&(f==null||(c[6][0][f]=!0));e=d.manual_retry_cnt;f=d.thread_id;e==null||!(f==null)&&e>0&&ga(g[0],f,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE);e=la(g,c,[d.message_id,d,1]);fa(e[0],d);return e}}}var sa=function(a,b){delete a[b];return 0},ta=function(a,b){delete a[b];return 0};function F(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.updatedThread(c);return 0}function ua(a,c){a=b("MercuryThreadInformer").getForFBID(a);a.deletedThread(c);return 0}function va(a,c,d,e){a=b("MercuryThreadInformer").getForFBID(a);a.changedThreadReadState(c,d,e);return 0}function wa(a,c){__p&&__p();Object.keys(c).forEach(function(d){__p&&__p();var e={},f=c[d];if(f!==undefined){var g=f[0];g.forEach(function(c){var b=a[c];if(b!==undefined){e[c]=b;return 0}else return 0});if(Object.keys(e).length===g.length){b("bs_curry")._2(ta,c,d);return b("bs_curry")._1(f[1],e)}else return 0}else return 0});return 0}function xa(c,a,d){a=a.specific_to_list;if(a==null){d=b("MercuryIDs").tokenize(d);if(d.type!=="user"||d.value.length===0)return[c];else return[b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d.value)),c]}else return a}function G(c,a,d){var e=b("MercuryIDs").tokenize(d),f=e.type==="user",g=a.specific_to_list;g=f?!0:g==null?!1:b("MessengerThreadUtils.bs").isCanonicalFromInitialParticipants(c,g);if(g||f)c=xa(c,a,d);else{var h=a.specific_to_list;c=h==null?[]:h}return new(b("ImmutableObject"))({admins:{},admin_model_status:null,approval_mode:0,approval_queue_ids:[],associated_object:null,can_reply:undefined,cannot_reply_reason:null,comm_item_owners:null,comm_source_id:null,comm_status:null,custom_like_icon:null,custom_nickname:null,customization_enabled:!1,description:null,ephemeral_ttl_mode:0,footer_color:null,game_id:null,gradient_colors:[],group_approval_queue:null,work_associated_group:null,groups_sync_status:null,has_email_participant:!1,has_montage:!1,header_color:null,is_canonical_neo_user:!1,is_pin_protected:!1,is_pinned:!1,is_thread_queue_enabled:!1,joinable_mode:{link:"",mode:0},last_message_timestamp:0,last_message_type:null,last_read_timestamp:0,lightweight_event:null,lightweight_events:{},marketplace_thread_data:null,mentions_mute_mode:0,mute_until:null,page_comm_item_id:null,page_thread_info:null,participant_add_mode:null,participants_event_status:null,reactions_mute_mode:0,read_only:!1,recipients_loadable:!0,rtc_call_data:null,server_timestamp:0,solid_color:null,subtitle:null,theme_id:null,thread_fbid:null,thread_type:null,thread_id:d,participants:c,name:"",snippet:a.body,snippet_attachments:[],snippet_sender:a.author,unread_count:0,message_count:0,image_src:null,timestamp:a.timestamp,other_user_fbid:f?b("FBID.bs").ofStringExn(e.value):null,is_canonical_user:f,is_canonical:g,is_subscribed:!0,folder:b("MessagingTag").INBOX,is_archived:!1,is_page_follow_up:!1,is_page_unresponded_thread:!1,object_association_type:null,joinable_link:null})}function ya(c,d,a,e){__p&&__p();e=b("MessengerMessage.bs").hasServerTimestamp(a,e);var f=a.thread_id;if(f==null)return undefined;else{b("MercuryAssert").isThreadID(f);var g=d[f];if(g!==undefined)return b("bs_js_primitive").some(g);else if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&!e){g=G(b("MercuryIDs").getParticipantIDFromUserID(c),a,f);d[f]=g;return b("bs_js_primitive").some(g)}else return undefined}}function za(c,a,d){d=b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").LOG_MESSAGE)||b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)?d==null?!0:!d:b("MessengerMessage.bs").hasServerTimestamp(a,d);if(c.server_timestamp!==0&&a.timestamp<c.server_timestamp)return d;else return!1}function Aa(c,d,a,e){var f=a.offline_threading_id;if(!(f==null)&&d.server_timestamp!==0&&b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)&&f.length>0&&b("bs_caml_obj").caml_notequal(a.author,b("MercuryIDs").getParticipantIDFromUserID(c)))if(e.has(f))return!0;else{e.add(f);return!1}else return!1}function Ba(a,c,d){__p&&__p();var e=new Set(c.participants);Object.assign(c,{participants:Array.from(c.participants)});d.forEach(function(d){if(e.has(d))return 0;else{c.participants.push(d);if(b("bs_caml_obj").caml_equal(d,a)){Object.assign(c,{is_subscribed:!0,can_reply:!0,cannot_reply_reason:null});return 0}else return 0}});return 0}function H(a,c,d,e){__p&&__p();var f=new Set(e);Object.assign(d,{participants:d.participants.filter(function(a){return!f.has(a)})});e=b("bs_js_dict").fromArray(b("bs_js_dict").entries(d.admins));Object.assign(d,{admins:b("bs_array").fold_left(function(a,c){c=b("MercuryIDs").getUserIDFromParticipantID(c);if(!(c==null)){var d=a[c];d!==undefined&&b("bs_curry")._2(x,a,c)}return a},e,b("JSSet.bs").values(f))});f.has(a)&&Object.assign(d,{is_subscribed:!1});e=b("MercuryServerRequests").getForFBID(c);e.fetchThreadData([d.thread_id],null);return 0}function I(a,c,d){var e=a.event_title,f=a.event_time;a=a.event_location_name;return{creator_id:null,latitude:null,location_address:null,longitude:null,note:"",related_event:{id:""},repeat_mode:null,seconds_to_notify_before:0,status:null,track_rsvp:c.track_rsvp,title:e==null?c.title:e,event_time:f==null?c.event_time:parseInt(f,10),location_name:a==null?c.location_name:a,event_members:d!==undefined?b("bs_js_primitive").valFromOption(d):c.event_members,oid:c.oid,event_type:c.event_type}}function J(b,a){var c={};Object.keys(b).forEach(function(a){c[a]=b[a];return 0});c[a.guest_id]=a.guest_status;return c}var K=function(a,b){delete a[b];return 0};function L(a){__p&&__p();var c=[-1],d=[null],e=Math.floor(Date.now()/1e3);b("bs_js_dict").entries(a).forEach(function(a){a=a[1];var b=a.event_time;if(b>e&&(c[0]<0||c[0]>b)){c[0]=b;d[0]=a;return 0}else return 0});return d[0]}var Ca=function(a,b){delete a[b];return 0};function M(c,d,a,e,f){__p&&__p();a.timestamp!==0&&va(c,d.thread_id,f,a.timestamp);if(d.timestamp===0){b("ChatReliabilityInstrumentation").logERROR("thread timestamp is 0");e.add(d.thread_id);return!1}else{a=d.unread_count===0;if(a===f)return!1;else{Object.assign(d,{unread_count:f?0:1});F(c,d.thread_id);return!0}}}function Da(c,d,e,f,a,g){__p&&__p();var h=e.action_type,i=g==null?!1:g;(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(h,b("MercuryActionType").LOG_MESSAGE))&&((e.is_unread||e.skip_bump_thread)&&(d.unread_count===0&&e.skip_bump_thread||e.timestamp<=d.server_timestamp||Object.assign(d,{unread_count:d.unread_count+1|0})),Object.assign(d,{message_count:d.message_count+1|0,is_archived:!1}));var j=b("MercuryIDs").getParticipantIDFromUserID(c);if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").DELETE_THREAD)){Object.assign(d,{message_count:0});ua(c,f);return 0}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").USER_GENERATED_MESSAGE)){d.unread_count===0&&b("bs_caml_obj").caml_equal(e.author,j)&&e.timestamp>=d.last_read_timestamp&&Object.assign(d,{last_read_timestamp:e.timestamp});var k=e.offline_threading_id;if(!(k==null)&&b("bs_caml_obj").caml_notequal(k,e.message_id)){Object.assign(d,{last_message_timestamp:e.timestamp});k=e.comm_status;k==null||Object.assign(d,{last_message_id:e.message_id})}k=e.comm_status;var m=d.comm_status;k==null||!(m==null)&&m.toUpperCase()!==b("PageCommItemStatus").FOLLOW_UP&&Object.assign(d,{comm_status:k});m=e.creator_info;m==null||b("bs_caml_obj").caml_equal(m.pageID,c)&&Object.assign(d,{folder:e.folder});k=d;m=e.author;var n=k.participants.indexOf(m);if(n>0){Object.assign(k,{participants:[m].concat(k.participants.slice(0,n),k.participants.slice(n+1|0))});return 0}else return 0}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").SEND_MESSAGE)){m=e.log_message_type;if(m==null){Object.assign(d,{snippet_attachments:e.attachments});return 0}else{if(b("bs_caml_obj").caml_equal(m,b("MercuryLogMessageType").THREAD_IMAGE)){k=e.log_message_data;n=k==null?null:k.image.preview_url;Object.assign(d,{image_src:n});F(c,f)}if(b("bs_caml_obj").caml_notequal(m,b("MercuryLogMessageType").SUBSCRIBE)&&b("bs_caml_obj").caml_notequal(m,b("MercuryLogMessageType").UNSUBSCRIBE)){Object.assign(d,{snippet_attachments:e.attachments});return 0}else return 0}}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").LOG_MESSAGE)){d.last_message_timestamp<e.timestamp&&Object.assign(d,{last_message_timestamp:e.timestamp});k=e.log_message_type;if(k==null)return 0;else if(b("bs_caml_obj").caml_equal(k,b("MercuryLogMessageType").SUBSCRIBE)&&!i){n=e.log_message_data;if(n==null)m=[];else{n=n.added_participants;m=n==null?[]:n}Ba(j,d,m);return F(c,f)}else if(b("bs_caml_obj").caml_equal(k,b("MercuryLogMessageType").UNSUBSCRIBE)&&!i){n=e.log_message_data;if(n==null)m=[];else{n=n.removed_participants;m=n==null?[]:n}H(j,c,d,m);return F(c,f)}else if(b("bs_caml_obj").caml_equal(k,b("MercuryLogMessageType").THREAD_IMAGE))if(i)return 0;else{n=e.log_message_data;m=n==null?null:n.image.preview_url;Object.assign(d,{image_src:m});return 0}else if(b("bs_caml_obj").caml_equal(k,b("MercuryLogMessageType").THREAD_NAME)){n=e.log_message_data;if(n==null)return 0;else{m=n.name;!(m==null)&&d.name===m||F(c,f);Object.assign(d,{name:n.name});return 0}}else if(b("bs_caml_obj").caml_equal(k,b("MercuryLogMessageType").GENERIC_ADMIN_TEXT)){m=c;n=d;k=e;var o=f;k=k.log_message_data;if(k==null)return 0;else{var p=k.untypedData;if(k.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME){var q=n.custom_nickname;if(!(q==null)){q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(q));var r=p.nickname;r.trim().length>0?q[p.participant_id]=r:b("bs_curry")._2(Ca,q,p.participant_id);Object.assign(n,{custom_nickname:q})}F(m,o)}else if(k.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_ICON)b("MercuryThreadActions").getForFBID(m).updateCustomLike(o,p.thread_icon);else if(k.message_type===b("MessagingGenericAdminTextType").CHANGE_THREAD_THEME){if(!b("ChatConfig").get("chat_tab_has_gradients")){r=p.theme_color;if(r==null)Object.assign(n,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});else if(r.length>0){q="#"+r.slice(2);Object.assign(n,{solid_color:q,header_color:q,footer_color:q,gradient_colors:[q]})}else Object.assign(n,{solid_color:null,header_color:null,footer_color:null,gradient_colors:[]});F(m,o)}}else if(k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE){var s={},t=p.event_creator_id;n.participants.forEach(function(c){c=b("MercuryIDs").getUserIDFromParticipantID(c);if(c==null)return 0;else{var a=b("bs_caml_obj").caml_equal(c,t);s[c]=a?"GOING":"INVITED";return 0}});r=b("bs_js_dict").fromArray(b("bs_js_dict").entries(n.lightweight_events));q=p.event_time;q={track_rsvp:p.event_track_rsvp,title:p.event_title,event_time:q==null?0:parseInt(q,10),location_name:p.event_location_name,event_members:s,oid:p.event_id,event_type:p.event_type};Object.assign(n,{lightweight_event:q});r[p.event_id]=Object.assign({},q);Object.assign(n,{lightweight_events:r});F(m,o)}else if(k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE||k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME||k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE||k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION){q=n.lightweight_event;if(!(q==null)){r=b("bs_js_dict").fromArray(b("bs_js_dict").entries(n.lightweight_events));q.oid===p.event_id&&Object.assign(n,{lightweight_event:I(p,q,b("bs_js_primitive").some(q.event_members))});q=r[p.event_id];q!==undefined&&(r[p.event_id]=I(p,q,undefined),Object.assign(n,{lightweight_events:r}))}F(m,o)}else if(k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP){q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(n.lightweight_events));r=n.lightweight_event;if(!(r==null)&&r.oid===p.event_id){var u=J(r.event_members,p);Object.assign(n,{lightweight_event:I(p,r,b("bs_js_primitive").some(u))})}r=q[p.event_id];if(r!==undefined){u=J(r.event_members,p);q[p.event_id]=I(p,r,b("bs_js_primitive").some(u));Object.assign(n,{lightweight_events:q})}F(m,o)}else if(k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE||k.message_type===b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY){r=b("bs_js_dict").fromArray(b("bs_js_dict").entries(n.lightweight_events));b("bs_curry")._2(K,r,p.event_id);Object.assign(n,{lightweight_event:L(r),lightweight_events:r});F(m,o)}return 0}}else return 0}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").CHANGE_READ_STATUS)){u=M(c,d,e,a,e.mark_as_read);u&&(d.last_message_timestamp>d.last_read_timestamp&&Object.assign(d,{last_read_timestamp:d.last_message_timestamp}));q=!d.read_only&&d.folder===b("MessagingTag").INBOX;if(u&&i){k=b("MercuryServerRequests").getForFBID(c);k.changeThreadReadStatus(d.thread_id,e.mark_as_read,e.source,d.last_read_timestamp,q,d.last_message_type)}return 0}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS))if(d.is_page_follow_up!==e.is_page_follow_up){Object.assign(d,{is_page_follow_up:e.is_page_follow_up});return F(c,f)}else return 0;else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").DELETE_MESSAGES)){if(g==null||!g)p=1;else{Object.assign(d,{snippet:"...",snippet_attachments:null,snippet_sender:null});return F(c,f)}if(p===1){n=e.message_ids;if(n==null)return 0;else{Object.assign(d,{message_count:d.message_count-n.length|0});return 0}}}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").CHANGE_MUTE_SETTINGS)){r=e.reactions_mute_mode;m=e.mentions_mute_mode;if(r==null)if(m==null){o=e.mute_until;Object.assign(d,{mute_until:o==null?undefined:o})}else Object.assign(d,{mentions_mute_mode:m});else Object.assign(d,{reactions_mute_mode:r});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").BLOCK_STATUS_CHANGED)){Object.assign(d,{can_reply:e.canViewerReply});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").ADD_PARTICIPANTS)){Ba(j,d,e.participants);return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").CHANGE_FLAG)){a=d.page_thread_info;Object.assign(d,{page_thread_info:Object.assign(a==null?{}:a,{flagged:e.mark_as_flag})});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").MOVE_PENDING_TO_INBOX)){d.folder===b("MessagingTag").PENDING&&Object.assign(d,{folder:b("MessagingTag").INBOX});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_CUSTOM_LIKE)){Object.assign(d,{custom_like_icon:e.custom_like});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").PROMOTE_GROUP_ADMINS)){u=e.promoted_admins;if(!(u==null)){i=b("bs_js_dict").fromArray(b("bs_js_dict").entries(d.admins));Object.assign(d,{admins:b("bs_array").fold_left(function(a,b){a[b.admin_fbid]=b.admin_type;return a},i,u)})}return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").REMOVE_GROUP_ADMINS)){k=e.removed_admin_ids;if(!(k==null)){q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(d.admins));Object.assign(d,{admins:b("bs_array").fold_left(function(c,d){var a=c[d];a!==undefined&&b("bs_curry")._2(x,c,d);return c},q,k)})}return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").JOINABLE_MODE)){Object.assign(d,{joinable_mode:e.joinable_mode});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").APPROVAL_MODE)){Object.assign(d,{approval_mode:e.approval_mode});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").APPROVAL_QUEUE)){g=e.added_id;g==null||d.approval_queue_ids.indexOf(g)===-1&&Object.assign(d,{approval_queue_ids:d.approval_queue_ids.concat([g])});p=e.added_group_id;if(!(p==null)){n=d.group_approval_queue;n==null?Object.assign(d,{group_approval_queue:[p]}):n.map(function(a){return a.requester.id}).indexOf(p.requester.id)===-1&&Object.assign(d,{group_approval_queue:n.concat([p])})}var v=e.removed_id;v==null||Object.assign(d,{approval_queue_ids:d.approval_queue_ids.filter(function(a){return b("bs_caml_obj").caml_notequal(a,v)})});var w=e.removed_group_id;if(!(w==null)){o=d.group_approval_queue;Object.assign(d,{group_approval_queue:(o==null?[]:o).filter(function(a){return a.requester.id!==w})})}return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").IS_PIN_PROTECTED)){Object.assign(d,{is_pin_protected:e.is_pin_protected});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_RTC_CALL_DATA)){m=e.initiator_fbid;if(m==null){r=d.rtc_call_data;j=r==null?undefined:r.initiator_fbid}else j=m;Object.assign(d,{rtc_call_data:new(b("ImmutableObject"))({call_state:e.call_state,server_info_data:e.server_info_data,initiator_fbid:j})});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_COMM_STATUS)){Object.assign(d,{comm_status:e.comm_status});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER)){a=e.id;i=a==null?{nodes:[]}:{nodes:[{admin:{id:a,name:e.name,profile_picture:{uri:e.profile_pic_uri}}}]};Object.assign(d,{comm_item_owners:i});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").EVENT_RSVP_CHANGED)){u=d.participants_event_status;q=(u==null?[]:u).filter(function(a){return a.participant_id!==e.actor_fbid});q.push({participant_id:e.actor_fbid,event_status:e.rsvp_status});Object.assign(d,{participants_event_status:q});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED)){k=e.groups_sync_action;g=0;!(k==null)&&b("bs_caml_obj").caml_equal(k,b("MessengerGroupsSyncStatus").OPT_IN)?Object.assign(d,{groups_sync_status:e.groups_sync_status_string}):g=1;g===1&&Object.assign(d,{groups_sync_status:e.groups_sync_status_string,work_associated_group:null});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE)){n=e.groups_sync_action;if(n==null)Object.assign(d,{work_associated_group:null});else if(b("bs_caml_obj").caml_equal(n,b("MessengerGroupsSyncStatus").OPT_IN)){p=new(b("URI"))(document.URL);o=p.getDomain();r=b("XGroupsController").getURIBuilder().setString("idorvanity",e.fb_group_id).getURI().setDomain(o==null?"":o.replace("messenger.com","facebook.com")).setPort(p.getPort()).setProtocol("https");Object.assign(d,{work_associated_group:{id:e.fb_group_id,url:r.toString(),group_saves:{count:0},group_events:{count:0}}})}else Object.assign(d,{work_associated_group:null});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").DESCRIPTION_CHANGED)){Object.assign(d,{description:e.group_thread_description_string});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_THREAD_THEME)){Object.assign(d,{solid_color:e.solid_color,header_color:e.header_color,footer_color:e.footer_color,gradient_colors:e.gradient_colors,theme_id:e.theme_id});return F(c,f)}else if(b("bs_caml_obj").caml_equal(h,b("MercuryActionType").UPDATE_JOINABLE_LINK)){Object.assign(d,{joinable_link:e.joinable_link});return F(c,f)}else return 0}function Ea(c,a,d){d=a.is_filtered_content?b("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(a):d!==undefined?d:a.body;var e=a.raw_attachments;e=!(e==null)&&e.length>0?b("MercuryAttachment").convertRaw(e):a.attachments;var f=a.log_message_type;return Object.assign(c,{snippet:d,snippet_attachments:e,snippet_sender:f==null?a.author:null})}function Fa(a,c){a=a[c];if(a!==undefined)return b("MercuryThreadInfo").isEmptyLocalThread(a);else return!1}function Ga(a,c){__p&&__p();var d=new Map();c.forEach(function(a,b){d.set(a,b);return 0});return c.sort(function(c,e){__p&&__p();var f=a[7][c],g=a[7][e];if(f!==undefined&&g!==undefined){g=g.timestamp-f.timestamp;if(g>0)return 1;else if(g<0)return-1;else return 0}else f=1;if(f===1){g=d.get(c);f=d.get(e);return b("bs_belt_Option").getExn(g==null?undefined:b("bs_js_primitive").some(g))-b("bs_belt_Option").getExn(f==null?undefined:b("bs_js_primitive").some(f))|0}})}function Ha(a,b,c,d){__p&&__p();a=a[12][c];if(a!==undefined){var e=a[d];if(e!==undefined){b.forEach(function(a){if(e.existingIDs.has(a)){e.existingIDs["delete"](a);a=e.threadlist.indexOf(a);e.threadlist.splice(a,1);return 0}else return 0});return 0}else return 0}else return 0}function Ia(a,b,c,d){__p&&__p();z.forEach(function(e){if(e!==c)return Ha(a,b,e,d);else return 0});var e=a[12][c];if(e!==undefined){e=e[d];e=e!==undefined?[e.threadlist,e.existingIDs]:[[],new Set()]}else e=[[],new Set()];var f=e[1],g=e[0];b.forEach(function(a){if(f.has(a))return 0;else{f.add(a);g.push(a);return 0}});return[Ga(a,g),f]}function Ja(a){var c=[b("MercuryFilters.bs").all];a.unread_count>0&&c.push(b("MercuryFilters.bs").unread);a.is_canonical||c.push(b("MercuryFilters.bs").groups);return c}function Ka(a,c){c=c.is_archived?b("MessagingTag").ACTION_ARCHIVED:c.folder;a=a[12][c];if(a!==undefined)return c}var La=b("MessengerFolders.bs").getSupportedFolders(0).filter(function(a){return a!==b("MessagingTag").ACTION_ARCHIVED});function Ma(a,c,d){__p&&__p();if(d!==undefined){var e=a[16][c];if(e!==undefined){e["delete"](b("bs_js_primitive").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a[0]);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a[0]);d.fetchUnreadThreadIDs(c);return 0}}else return 0}function Na(a,c,d){__p&&__p();if(d!==undefined){var e=a[16][c];if(e!==undefined){e.add(b("bs_js_primitive").valFromOption(d));e=b("MercuryThreadInformer").getForFBID(a[0]);e.updatedUnreadState();return 0}else{d=b("MercuryServerRequests").getForFBID(a[0]);d.fetchUnreadThreadIDs(c);return 0}}else return 0}function Oa(a,c){return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_primitive").undefined_to_opt(a[12][b("MessagingTag").INBOX]),function(a){return b("bs_js_primitive").undefined_to_opt(a[b("MercuryFilters.bs").all])}),function(b){if(b.threadlist.length===0)return c[7][0];else return b.threadlist.reduce(function(b,c){c=a[7][c];if(c!==undefined&&c.timestamp>a[18])return b+1|0;else return b},0)}),c[7][0])}function Pa(a,c){__p&&__p();return b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_js_primitive").undefined_to_opt(a[12][b("MessagingTag").INBOX]),function(a){return b("bs_js_primitive").undefined_to_opt(a[b("MercuryFilters.bs").all])}),function(d){__p&&__p();if(d.threadlist.length===0)return c[7][0];else return d.threadlist.reduce(function(c,d){__p&&__p();var e=a[7][d];if(e!==undefined&&e.timestamp>a[18]&&!b("MercuryThreadInfo").isMuted(e)){e=a[16][b("MessagingTag").INBOX];if(e!==undefined){e=e.has(d);if(e)return c+1|0;else return c}else return c}else return c},0)}),c[7][0])}function Qa(a,c,d){var e=b("MessengerFolders.bs").getFromMeta(c);if(d!==e){La.includes(e)&&c.unread_count>0&&Na(a,e,b("bs_js_primitive").some(c.thread_id));if(La.includes(d))return Ma(a,d,b("bs_js_primitive").some(c.thread_id));else return 0}else return 0}function Ra(a,c){__p&&__p();var d=b("MessengerFolders.bs").getFromMeta(c);if(z.includes(d)){y.forEach(function(e){var f=a[12][d][e],g=f.existingIDs.has(c.thread_id);Ia(a,[c.thread_id],d,e);var h=b("bs_caml_obj").caml_equal(b("bs_caml_array").caml_array_get(f.threadlist,f.threadlist.length-1|0),c.thread_id);if(!f.reachedEnd&&!g&&h)return Ha(a,[c.thread_id],d,e);else return 0});return 0}else return 0}function Sa(c,a,d){d=d===b("MessagingTag").PENDING;if(d)return[c[0],c[1],c[2],c[3],c[4],0,c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],c[18]];else return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15],c[16],c[17],a]}function N(a,c,d){__p&&__p();var e=[];c=b("bs_array").fold_left(function(f,g){__p&&__p();switch(g.tag|0){case 0:e.push(g[0].tag|0);break;case 1:case 2:break}switch(g.tag|0){case 0:var h=g[0];if(typeof h==="number"){var i=f,k=d;k[0][0]={};k[1][0]=k[1][0];k[6][0]={};k[2].clear();Object.keys(i[7]).forEach(function(a){return ea(i[0],a)});return[i[0],i[1],b("bs_belt_MapString").empty,i[3],i[4],i[5],i[6],{},new Set(),new Map(),new Map(),i[11],da(0),i[13],i[14],new Map(),i[16],i[17],i[18]]}else switch(h.tag|0){case 0:k=f;var l=h[0],m=[!1],n=[k[1]];Object.keys(l).forEach(function(a){var c=l[a],d=b("bs_belt_Option").getWithDefault(b("bs_belt_MapString").get(n[0],a),0);if(c>d){m[0]=!0;n[0]=b("bs_belt_MapString").set(n[0],a,c);return 0}else return 0});if(m[0])return[k[0],n[0],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9],k[10],k[11],k[12],k[13],k[14],k[15],k[16],k[17],k[18]];else return k;case 1:k=f;var o=h[0];o=o.reduce(b("bs_belt_Set").add,k[3]);if(o===k[3])return k;else return[k[0],k[1],k[2],o,k[4],k[5],k[6],k[7],k[8],k[9],k[10],k[11],k[12],k[13],k[14],k[15],k[16],k[17],k[18]];case 2:o=f;k=h[0];var p=h[1];p=p.reduce(b("bs_belt_Set").remove,k.reduce(b("bs_belt_Set").add,o[4]));if(p===o[4])return o;else return[o[0],o[1],o[2],o[3],p,o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];case 3:k=f;p=h[0];o=p.reduce(function(a,c){if(b("bs_belt_Set").has(a,c))return b("bs_belt_Set").remove(a,c);else return b("bs_belt_Set").add(a,c)},k[4]);if(o===k[4])return k;else return[k[0],k[1],k[2],k[3],o,k[5],k[6],k[7],k[8],k[9],k[10],k[11],k[12],k[13],k[14],k[15],k[16],k[17],k[18]];case 4:p=f;o=h[0];k=o.reduce(function(c,d){var a=d.is_messenger_ignored;if(a==null)return c;else if(a)return b("bs_belt_Set").add(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid));else return b("bs_belt_Set").remove(c,b("MercuryIDs").getParticipantIDFromUserID(d.fbid))},p[3]);if(k===p[3])return p;else return[p[0],p[1],p[2],k,p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]];case 5:o=f;k=h[0];return[o[0],o[1],o[2],o[3],o[4],k,o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];case 6:p=f;k=h[0];o=ca(p[0],k);if(o==null)return p;else{var q=b("FBID.bs").ofString(k.from.toString());if(q!==undefined){q=b("bs_js_primitive").valFromOption(q);b("MessengerPersonas.bs").addPersona(k.persona);var r=k.persona,s=b("gkx")("678634");s=!(r==null)&&s?b("MercuryIDs").getParticipantIDFromUserID(r.id):b("MercuryIDs").getParticipantIDFromUserID(q);if(k.st===b("TypingStates").TYPING){r=b("bs_belt_MapString").get(p[6],o);if(r!==undefined)return[p[0],p[1],p[2],p[3],p[4],p[5],b("bs_belt_MapString").set(p[6],o,b("bs_belt_Map").set(b("bs_js_primitive").valFromOption(r),s,Date.now())),p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]];else{q=b("bs_belt_Map").set(b("bs_belt_Map").make([b("ParticipantId.bs").cmp]),s,Date.now());return[p[0],p[1],p[2],p[3],p[4],p[5],b("bs_belt_MapString").set(p[6],o,q),p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]]}}else if(k.st===b("TypingStates").INACTIVE){r=aa(p[6],o,s);if(r!==p[6])return[p[0],p[1],p[2],p[3],p[4],p[5],r,p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]];else return p}else return p}else return p}case 7:q=f;var t=h[0],u=[!1],w=[q[2]];Object.keys(t).forEach(function(c){__p&&__p();Object.keys(t[c]).forEach(function(d){__p&&__p();var a=b("bs_belt_MapString").get(w[0],c);a=a!==undefined?b("bs_js_primitive").valFromOption(a):b("immutable").OrderedMap();var e=a.get(d),f=t[c][d];if(e==null||f.watermark>e.watermark)e=1;else return 0;if(e===1){u[0]=!0;w[0]=b("bs_belt_MapString").set(w[0],c,a.set(d,f));return 0}});var a=b("bs_belt_MapString").get(w[0],c);if(a!==undefined){u[0]=!0;w[0]=b("bs_belt_MapString").set(w[0],c,b("bs_js_primitive").valFromOption(a).sort(function(a,c){return b("bs_caml_primitive").caml_float_compare(a.watermark,c.watermark)}));return 0}else return 0});if(u[0])return[q[0],q[1],w[0],q[3],q[4],q[5],q[6],q[7],q[8],q[9],q[10],q[11],q[12],q[13],q[14],q[15],q[16],q[17],q[18]];else return q;case 8:var x=f;k=d;o=h[0];if(o.length===0)return x;else{var fa=x[7];o.forEach(function(a){fa[a.thread_id]=new(b("ImmutableObject"))(a);return 0});wa(fa,k[0][0]);o.forEach(function(a){return F(x[0],a.thread_id)});return[x[0],x[1],x[2],x[3],x[4],x[5],x[6],fa,x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15],x[16],x[17],x[18]]}case 9:s=f;r=h[0];if(r.length===0)return s;else{var C=s[8],ka=b("MercuryServerRequests").getForFBID(s[0]);r.forEach(function(a){__p&&__p();var b=a.thread_id;if(C.has(b)){C["delete"](b);if(a.unread_count>0){ka.changeThreadReadStatus(b,!0,null,null,null,null);return 0}else return 0}else return 0});return[s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],C,s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18]]}case 10:var D=f;p=h[0];var E=h[1];if(p.length===0)return D;else{var ma=b("bs_js_dict").fromArray(b("bs_js_dict").entries(D[7])),qa=new Set(),ua={},va={},xa={};p.forEach(function(a){__p&&__p();if(b("MessengerMessage.bs").isErrorLogMessage(a))return 0;else{var c=ya(D[0],ma,a,E);if(c!==undefined){c=b("bs_js_primitive").valFromOption(c);var e=a.offline_threading_id;e=b("bs_belt_Option").flatMap(e==null?undefined:b("bs_js_primitive").some(e),function(a){return b("bs_js_primitive").nullable_to_opt(D[10].get(a))});if(e!==undefined||za(c,a,E)||Aa(D[0],c,a,qa))return 0;else{e=a.thread_id;if(e==null)throw b("bs_caml_builtin_exceptions").not_found;else e=e;var d=ua[e];d===undefined&&(ua[e]=Object.assign({},c));d=ua[e];Da(D[0],d,a,e,D[8],E);if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)){c=va[e];c!==undefined?a.timestamp>c.timestamp&&(va[e]=a):va[e]=a}if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").LOG_MESSAGE)){d=xa[e];d!==undefined?a.timestamp>d.timestamp&&(xa[e]=a):xa[e]=a}return 0}}else return 0}});b("bs_js_dict").entries(ua).forEach(function(a){__p&&__p();var c=a[1];a=a[0];var d=xa[a],e=va[a];if(e!==undefined)Ea(c,e,undefined);else if(d!==undefined){e=d.log_message_body;e==null||Ea(c,d,e)}if(d!==undefined&&!d.skip_bump_thread){d.timestamp>c.timestamp&&Object.assign(c,{timestamp:d.timestamp});e=0;E==null?e=1:E||(e=1);e===1&&(d.timestamp>c.server_timestamp&&Object.assign(c,{server_timestamp:d.timestamp}))}e=new(b("ImmutableObject"))(c);if(e.participants.length===0&&!Fa(ma,e.thread_id))return 0;else{ma[a]=e;return 0}});return[D[0],D[1],D[2],D[3],D[4],D[5],D[6],ma,D[8],D[9],D[10],D[11],D[12],D[13],D[14],D[15],D[16],D[17],D[18]]}case 11:var G=f,Ba=h[0];z.forEach(function(a){__p&&__p();y.forEach(function(d){__p&&__p();var c=G,e=Ba,f=a,g=d,h=[];d=e.filter(function(c){var a=c.filter;a=a==null?b("MercuryFilters.bs").all:a;c=c.folder;c=c==null?f===b("MessagingTag").INBOX:c===f;if(c)return b("bs_caml_obj").caml_equal(a,g);else return!1});var i=[!1];d.forEach(function(a){a.thread_ids.forEach(function(a){h.push(a);return 0});var b=a.limit;if(a.thread_ids.length<b){i[0]=!0;return 0}else return 0});e=Ia(c,h,f,g);d=c[12][f];c=d[g];c=c!==undefined?c.reachedEnd:!1;d[g]={reachedEnd:i[0]?i[0]:c,threadlist:e[0],existingIDs:e[1]};return 0});return 0});return[G[0],G[1],G[2],G[3],G[4],G[5],G[6],G[7],G[8],G[9],G[10],G[11],G[12],G[13],G[14],G[15],G[16],G[17],G[18]];case 12:var H=f;q=h[0];var I={};z.forEach(function(a){var b={};y.forEach(function(a){b[a]=[];return 0});I[a]=b;return 0});q.forEach(function(c){__p&&__p();var d=H[7][c.thread_id];if(d!==undefined){var a=Ka(H,d);if(a!==undefined){var b=a;Ja(d).forEach(function(a){if(d.timestamp!==0){I[b][a].push(c.thread_id);return 0}else return 0});return 0}else return 0}else return 0});z.forEach(function(a){y.forEach(function(b){var c=I[a][b];Ia(H,c,a,b);return 0});return 0});return[H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15],H[16],H[17],H[18]];case 13:var J=f;k=h[0];o=k.filter(function(a){a=a.thread_id;return!(a==null)});if(o.length>0){var K={};z.forEach(function(a){var b={};y.forEach(function(a){b[a]={to_add:[],to_remove:[]};return 0});K[a]=b;return 0});o.forEach(function(a){__p&&__p();var c=a.thread_id;if(c==null)return 0;else{var d=J[7][c];if(d!==undefined){var e=Ka(J,d);if(e!==undefined){var f=e;e=Ja(d);b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").DELETE_THREAD)?e.forEach(function(a){K[f][a].to_remove.push(c);return 0}):b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").CHANGE_READ_STATUS)?e.includes(b("MercuryFilters.bs").unread)?K[f][b("MercuryFilters.bs").unread].to_add.push(c):K[f][b("MercuryFilters.bs").unread].to_remove.push(c):(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").LOG_MESSAGE))&&e.forEach(function(a){if(d.timestamp!==0){K[f][a].to_add.push(c);return 0}else return 0});z.forEach(function(a){y.forEach(function(b){var c=K[a][b];Ia(J,c.to_add,a,b);return Ha(J,c.to_remove,a,b)});return 0});return 0}else return 0}else return 0}});r=b("MercuryThreadInformer").getForFBID(J[0]);r.updatedThreadlist();return[J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15],J[16],J[17],J[18]]}else return J;case 14:var L=f,Ca=d;s=h[0];if(s.length>0){s.forEach(function(a){if(Ca[5].has(a))return 0;else{L[13].push(a);Ca[5].add(a);return 0}});p=b("MercuryThreadInformer").getForFBID(L[0]);p.updatedThreadlist();return[L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15],L[16],L[17],L[18]]}else return L;case 15:var M=f,Ga=h[0],Pa=M[7];b("bs_js_dict").entries(Pa).forEach(function(a){var c=a[1];a=a[0];if(c.folder===Ga){Pa[a]=b("ImmutableObject").set(c,{unread_count:0});return F(M[0],a)}else return 0});M[16][Ga]=new Set();q=b("MercuryThreadInformer").getForFBID(M[0]);q.updatedUnreadState();return[M[0],M[1],M[2],M[3],M[4],M[5],M[6],Pa,M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15],M[16],M[17],M[18]];case 16:var N=f,Ta=h[0];b("bs_curry")._2(sa,N[7],Ta);N[15]["delete"](Ta);N[9].forEach(function(a,c,d){__p&&__p();if(b("bs_caml_obj").caml_equal(a.thread_id,Ta)){N[9]["delete"](a.message_id);c=a.offline_threading_id;if(!(c==null)){d=N[10].get(c);d==null||(N[9]["delete"](d),N[10]["delete"](c))}N[10]["delete"](a.message_id);return 0}else return 0});ea(N[0],Ta);return[N[0],N[1],N[2],N[3],N[4],N[5],N[6],N[7],N[8],N[9],N[10],N[11],N[12],N[13],N[14],N[15],N[16],N[17],N[18]];case 17:k=h[0];return la(f,d,[k.message_id,k,h[1]]);case 18:o=f;r=[h[0],h[1],h[2]];s=r[2];p=r[1];q=r[0];if(p.length!==0){var O=oa(o,[q,p,s]);k=0;s!==undefined?b("bs_caml_obj").caml_equal(b("bs_js_primitive").valFromOption(s),b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||(k=1):k=1;k===1&&b("MercuryServerRequests").getForFBID(O[0]).deleteMessages(q,p);r=b("bs_belt_Array").keepMap(p,function(a){return B(O,a)});r.forEach(function(a){__p&&__p();var c=a.attachments;if(c==null)return 0;else{c=b("bs_belt_Array").keepMap(c,function(a){if(b("MercuryAttachment").isPhotoAttachment(a)&&b("MercuryAttachment").isVideoAttachment(a)){a=a.metadata;if(a==null)return undefined;else return b("bs_js_primitive").nullable_to_opt(a.fbid)}});b("MessengerSharedMediaActions").deletePhotos(b("MercuryIDs").getThreadFBIDFromThreadID(a.thread_id),c);return 0}});return O}else return o;case 19:s=f;k=h[0];q=h[1];p=s[7][k];if(p!==undefined){r=b("MessengerFolders.bs").getFromMeta(p);if(r!==q){o=p.comm_status;o=o==null?b("ImmutableObject").set(p,{folder:q}):q===b("MessagingTag").OTHER?b("ImmutableObject").set(p,{folder:q,comm_status:b("PageCommItemStatus").SPAM}):q===b("MessagingTag").INBOX?b("ImmutableObject").set(p,{folder:q,comm_status:b("PageCommItemStatus").TODO}):b("ImmutableObject").set(p,{folder:q});s[7][k]=o;Qa(s,o,r);Ra(s,o);F(s[0],k);return[s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18]]}else return s}else return s;case 20:p=f;q=h[0];r=h[1];o=p[7][q];if(o!==undefined&&o.is_archived!==r){k=b("MessengerFolders.bs").getFromMeta(o);s=o.comm_status;s=s==null?b("ImmutableObject").set(o,{is_archived:r}):b("ImmutableObject").set(o,{is_archived:r,comm_status:r?b("PageCommItemStatus").DONE:b("PageCommItemStatus").TODO});p[7][q]=s;Qa(p,s,k);Ra(p,s);F(p[0],q);return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15],p[16],p[17],p[18]]}else return p;case 21:o=f;r=h[0];k=b("bs_belt_Option").getWithDefault(b("bs_belt_Option").map(b("bs_js_primitive").nullable_to_opt(o[15].get(r)),function(a){return[a[0],[]]}),[0,[]]);o[15].set(r,k);return[o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15],o[16],o[17],o[18]];case 22:s=f;q=d;p=[h[0],h[1],h[2]];r=na(s,[p[0],p[1]]);k=r.thread_id;o=oa(s,[k,[r.message_id],p[2]]);s=q[2].get(k);s==null||q[2].set(k,Math.max(0,s-1|0));return o;case 23:r=f;p=[h[0],h[1]];q=na(r,[p[0],p[1]]);b("MercuryServerRequests").getForFBID(r[0]).sendNewMessage(Object.assign(q,{preview_attachments:undefined}));return r;case 24:k=f;s=[h[0],h[1],h[2],h[3]];o=s[2];p=s[1];q=s[0];r=B(k,q);if(r!==undefined){r=b("bs_js_primitive").valFromOption(r);var P=b("bs_js_dict").map(function(a){return a},b("bs_belt_Option").getWithDefault(b("bs_js_primitive").nullable_to_opt(r.reactions),{}));p!==undefined?P[o]=p:b("bs_curry")._2(ha,P,o);p=Object.assign(Object.assign({},r),{reactions:P});o=r.thread_id;o==null||A(k[0],o,q,s[3]);return ja(k,[q,p])}else return k;case 25:P=f;r=h[0];if(b("gkx")("676919")){o=B(P,r);if(o!==undefined){s=b("bs_js_primitive").valFromOption(o);q=s.attachments;if(q==null||q.length===0)return P;else{p=b("bs_caml_array").caml_array_get(q,0);k=p.share;if(k==null)return P;else{o=k.target;if(o==null)return P;else{var Q=o.message_state;if(Q==null)return P;else{Q=Object.assign(Object.assign({},s),{attachments:b("bs_caml_array").caml_array_set(b("bs_array").copy(q),0,Object.assign(Object.assign({},p),{share:Object.assign(Object.assign({},k),{target:Object.assign(Object.assign({},o),{message_state:"EXPIRED"})})}))});return ja(P,[r,Q])}}}}}else return P}else return P;case 26:s=f;q=[h[0],h[1],h[2]];p=q[0];k=B(s,p);if(k!==undefined){o=b("bs_js_primitive").valFromOption(k);r=o.attachments;if(r==null||r.length===0)return s;else{Q=b("bs_caml_array").caml_array_get(r,0);P=Q.share;if(P==null)return s;else{k=P.target;if(k==null)return s;else{r=b("bs_array").copy(r);b("bs_caml_array").caml_array_set(r,0,Object.assign(Object.assign({},Q),{share:Object.assign(Object.assign({},P),{target:Object.assign(Object.assign({},q[1]),{live_location_id:k.live_location_id})})}));Q=Object.assign(Object.assign({},o),{attachments:r});P=o.thread_id;P==null||A(s[0],P,p,q[2]);return ja(s,[p,Q])}}}}else return s;case 27:k=f;r=h[0];o=h[1];var R=r.replaced_message_id;if(R==null)return k;else{P=B(k,R);if(P!==undefined){q=r.message_id;p={timestamp:r.timestamp,profile_ranges:r.profile_ranges};Q=b("bs_js_primitive").nullable_to_opt(r.status);Q!==undefined&&(p.status=b("bs_js_primitive").valFromOption(Q));s=b("bs_js_primitive").nullable_to_opt(r.log_message_data);s!==undefined&&(p.log_message_data=b("bs_js_primitive").valFromOption(s));Q=b("bs_js_primitive").nullable_to_opt(r.meta_ranges);Q!==undefined&&(p.meta_ranges=b("bs_js_primitive").valFromOption(Q));s=b("bs_js_primitive").nullable_to_opt(r.ranges);s!==undefined&&(p.ranges=b("bs_js_primitive").valFromOption(s));Q=b("bs_js_primitive").nullable_to_opt(r.raw_attachments);Q!==undefined&&(p.raw_attachments=b("bs_js_primitive").valFromOption(Q));s=b("bs_js_primitive").nullable_to_opt(r.attachments);s!==undefined&&(p.attachments=b("bs_js_primitive").valFromOption(s));Q=b("bs_js_primitive").nullable_to_opt(r.body);Q!==undefined&&(p.body=b("bs_js_primitive").valFromOption(Q));s=b("bs_js_primitive").nullable_to_opt(r.platform_xmd);s!==undefined&&(p.platform_xmd=b("bs_js_primitive").valFromOption(s));Q=p;s=Object.assign(Object.assign({},b("bs_js_primitive").valFromOption(P)),Q);b("MercuryMessageIDs.bs").addServerID(q,q);var S=ja(k,[q,s]);if(q!==R){S[9]["delete"](R);S[10].set(R,q);p=b("bs_belt_Option").flatMap(b("bs_js_primitive").nullable_to_opt(r.thread_id),function(a){return b("bs_js_primitive").nullable_to_opt(S[15].get(a))});P=r.thread_id;if(p!==undefined&&!(P==null)){Q=p;s=ia(S,[q].concat(Q[1].filter(function(a){return a!==R})));S[15].set(P,[Q[0],s])}}p=r.message_id;q=r.thread_id;q==null||(A(S[0],q,R,o),A(S[0],q,p,o));return[S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15],S[16],S[17],S[18]]}else return k}case 28:P=f;Q=d;s=[h[0],h[1]];r=s[0];q=B(P,s[1]);if(q!==undefined&&b("MessengerMessage.bs").isTitanMessage(b("bs_js_primitive").valFromOption(q))){p=Q[2].get(r);p==null?Q[2].set(r,1):Q[2].set(r,1+p|0)}return P;case 29:return pa(f,d,h[0],h[1]);case 30:o=f;k=d;s=h[0];q=h[1];Q=ra(o,k,s,q);r=ba(Q,s);if(s.folder===b("MessagingTag").PENDING&&b("bs_caml_obj").caml_equal(q,b("bs_js_primitive").some(b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)))return[r[0],r[1],r[2],r[3],r[4],r[5]+1|0,r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15],r[16],r[17],r[18]];else return r;case 31:p=f;P=d;o=h[0];k=h[1];return ra(p,P,o,k);case 32:Q=f;s=d;q=h[0];r=h[1];p=Q[7][q];P=!1;if(r&&!s[5].has(q))Q[13].push(q),s[5].add(q),P=!0;else if(!r&&s[5].has(q)){o=Q[13].indexOf(q);o>-1&&Q[13].splice(o,1);s[5]["delete"](q);P=!0}if(p!==undefined&&p.is_pinned!==r){k=b("ImmutableObject").set(p,{is_pinned:r});Q[7][q]=k;F(Q[0],q);P=!0}if(P)return[Q[0],Q[1],Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[8],Q[9],Q[10],Q[11],Q[12],Q[13],Q[14],Q[15],Q[16],Q[17],Q[18]];else return Q;case 33:o=f;s=h[0];p=b("bs_js_dict").fromArray(b("bs_js_dict").entries(o[14]));p[s]=[];return[o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],p,o[15],o[16],o[17],o[18]];case 34:r=f;k=h[0];q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(r[14]));P=k.actor.id;Q=q[P];Q!==undefined?(Q.push(k),q[P]=Q):q[P]=[k];return[r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],q,r[15],r[16],r[17],r[18]];case 35:s=f;p=h[0];o=b("bs_js_dict").fromArray(b("bs_js_dict").entries(s[14]));Q=o[p];Q===undefined&&(o[p]=[]);return[s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],o,s[15],s[16],s[17],s[18]];case 36:P=f;var Ua=h[0],T=b("bs_js_dict").fromArray(b("bs_js_dict").entries(P[14]));k=Object.keys(T);k.forEach(function(b){var a=T[b];if(a!==undefined){a=a.filter(function(a){return a.id!==Ua.messageFBID});T[b]=a;return 0}else return 0});return[P[0],P[1],P[2],P[3],P[4],P[5],P[6],P[7],P[8],P[9],P[10],P[11],P[12],P[13],T,P[15],P[16],P[17],P[18]];case 37:var U=f;q=[h[0],h[1]];var Va=q[1];q[0].forEach(function(b){var a=U[15].get(b);a==null?U[15].set(b,[1,[]]):U[15].set(b,[1,a[1]]);return ga(U[0],b,Va)});return[U[0],U[1],U[2],U[3],U[4],U[5],U[6],U[7],U[8],U[9],U[10],U[11],U[12],U[13],U[14],U[15],U[16],U[17],U[18]];case 38:var V=f;r=h[0];r.forEach(function(c){__p&&__p();var a=c.folder;if(La.includes(a)){c=c.thread_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromThreadFBID(a)}).concat(c.other_user_fbids.map(function(a){return b("MercuryIDs").getThreadIDFromUserID(a)}));V[16][a]=new Set(c);a=b("MercuryThreadInformer").getForFBID(V[0]);a.updatedUnreadState();return 0}else return 0});return[V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7],V[8],V[9],V[10],V[11],V[12],V[13],V[14],V[15],V[16],V[17],V[18]];case 39:var W=f,Wa=d;Q=h[0];var c=[W[18]];Q.forEach(function(a){W[17][a.folder]=a.unread_count;a.unread_count===0&&(W[16][a.folder]=new Set());a.folder===b("MessagingTag").INBOX&&(c[0]=b("bs_belt_Option").getWithDefault(b("bs_js_primitive").nullable_to_opt(a.seen_timestamp),c[0]),Wa[7][0]=a.unseen_count);a=b("MercuryThreadInformer").getForFBID(W[0]);a.updatedUnreadState();a.updatedUnseenState();return 0});return[W[0],W[1],W[2],W[3],W[4],W[5],W[6],W[7],W[8],W[9],W[10],W[11],W[12],W[13],W[14],W[15],W[16],W[17],c[0]];case 40:var X=f;p=h[0];p.forEach(function(a){__p&&__p();var c=a.other_user_fbid;if(c==null){var d=a.thread_fbid;d=d==null?undefined:b("bs_js_primitive").some(b("MercuryIDs").getThreadIDFromThreadFBID(d))}else d=b("bs_js_primitive").some(b("MercuryIDs").getThreadIDFromUserID(c));c=a.thread_id;var e=c==null?d:c==null?undefined:b("bs_js_primitive").some(c);if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").DELETE_THREAD)){La.forEach(function(a){return Ma(X,a,e)});return 0}else{d=a.thread_id;if(d==null)c="";else{d=X[7][d];c=d!==undefined?b("MessengerFolders.bs").getFromMeta(d):a.folder}if(La.includes(c))if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").CHANGE_READ_STATUS))if(a.mark_as_read)return Ma(X,c,e);else return Na(X,c,e);else if((b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").USER_GENERATED_MESSAGE)||b("bs_caml_obj").caml_equal(a.action_type,b("MercuryActionType").LOG_MESSAGE))&&a.is_unread)return Na(X,c,e);else return 0;else return 0}});return[X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7],X[8],X[9],X[10],X[11],X[12],X[13],X[14],X[15],X[16],X[17],X[18]];case 41:var Y=f,Xa=h[0];La.forEach(function(c){__p&&__p();var a=Y[16][c];if(a!==undefined){b("bs_js_dict").entries(Xa).forEach(function(b){var c=b[0];if(a.has(c)){a.add(b[1]);a["delete"](c);return 0}else return 0});return 0}else return 0});return[Y[0],Y[1],Y[2],Y[3],Y[4],Y[5],Y[6],Y[7],Y[8],Y[9],Y[10],Y[11],Y[12],Y[13],Y[14],Y[15],Y[16],Y[17],Y[18]];case 42:return Sa(f,h[0],h[1])}case 1:o=g[0];if(typeof o==="number")if(o===0){s=f;var Ya=[];b("bs_belt_MapString").forEach(s[6],function(a,c){return b("bs_belt_Map").forEach(c,function(b,c){if(c<Date.now()-3e4){Ya.push([a,b]);return 0}else return 0})});if(Ya.length===0)return s;else{var a=[s[6]];Ya.forEach(function(b){a[0]=aa(a[0],b[0],b[1]);return 0});return[s[0],s[1],s[2],s[3],s[4],s[5],a[0],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18]]}}else{k=f;P=d;if(Oa(k,P)>0){q=b("MercuryServerRequests").getForFBID(k[0]);q.markSeen();return Sa(k,q.getLastActionTimestamp(),b("MessagingTag").INBOX)}else return k}else switch(o.tag|0){case 0:var Z=f,Za=d;r=o[0];Q=o[1];p=o[2];h=o[3];var $a=Z[7],ab={},bb=[];r.forEach(function(b){var a=$a[b];if(a!==undefined){ab[b]=a;return 0}else{bb.push(b);return 0}});if(bb.length===0){b("bs_curry")._1(p,ab);return Z}else{s=Za[1];P=s[0].toString();Za[1][0]=s[0]+1|0;Za[0][0][P]=[r,p];q=b("MercuryServerRequests").getForFBID(Z[0]);bb.forEach(function(c){__p&&__p();var d=b("MercuryIDs").tokenize(c),e=d.type;d=d.value;if(e==="user"){e=b("MercuryIDs").getParticipantIDFromUserID(b("FBID.bs").ofStringExn(d));d=b("MercuryIDs").getParticipantIDFromUserID(Z[0]);var a=b("bs_caml_obj").caml_equal(e,d);a=b("MessengerThreadUtils.bs").createNewLocalThread(d,c,a?[d]:[d,e],null);Z[7][c]=a;return wa(Z[7],Za[0][0])}else return 0});q.fetchThreadData(bb,h);b("bs_curry")._1(Q,P);return Z}case 1:k=d[0][0];b("bs_curry")._2(ta,k,o[0]);d[0][0]=k;return f;case 2:var $=f;s=o[0];r=b("bs_belt_Array").keepMap(s,function(a){a=B($,a);if(a!==undefined)return b("bs_js_primitive").nullable_to_opt(b("bs_js_primitive").valFromOption(a).offline_threading_id)});r.forEach(function(a){$[10]["delete"](a);return 0});return[$[0],$[1],$[2],$[3],$[4],$[5],$[6],$[7],$[8],$[9],$[10],$[11],$[12],$[13],$[14],$[15],$[16],$[17],$[18]];case 3:p=f;var cb=o[0];q=b("bs_js_dict").fromArray(b("bs_js_dict").entries(p[14]));h=cb.montageActorID;Q=q[h];if(Q!==undefined){P=Q.map(function(a){__p&&__p();var c=b("bs_caml_obj").caml_equal(cb.montageMessageID,a.id);if(c){c=a;var d=cb,e=c.montage_overlays.map(function(a){__p&&__p();if(b("bs_caml_obj").caml_equal(a.poll.id,d.pollID)){var c=a.poll.poll_options.map(function(a,c){c=c===d.optionVotedIndex;if(c)return new(b("ImmutableObject"))({text:a.text,vote_count:a.vote_count+1|0});else return a});c=new(b("ImmutableObject"))({can_viewer_vote:a.poll.can_viewer_vote,id:a.poll.id,poll_options:c,viewer_vote_index:d.optionVotedIndex});return b("ImmutableObject").set(new(b("ImmutableObject"))(a),{poll:c})}else return a});return b("ImmutableObject").set(new(b("ImmutableObject"))(c),{montage_overlays:e})}else return a});q[h]=P}return[p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],q,p[15],p[16],p[17],p[18]];case 4:f[7][o[0]]=o[1];return f}case 2:k=g[0];switch(k.tag|0){case 0:b("bs_curry")._1(k[0],{blocked_ids:f[4]});break;case 1:b("bs_curry")._1(k[1],b("bs_js_primitive").undefined_to_opt(f[7][k[0]]));break;case 2:b("bs_curry")._1(k[0],f[13].concat([]));break;case 3:b("bs_curry")._2(k[0],f,d);break}return f}},c,a);e.length>0&&b("LogHistory").getInstance("messenger_state").debug("actions",b("bs_belt_Option").getWithDefault(b("bs_js_primitive").undefined_to_opt(JSON.stringify(e)),""));return c}function Ta(a){var c=[b("MercurySyncEventsProxy").getArbiterTypeForFBID(a,"TYP")];b("FBIDCheck").isUser_deprecated(a)||c.push(b("ChannelConstants").getArbiterType("page_typing"));return c}var O={},P=b("ReasonReact.bs").reducerComponent("MessengerStateProvider");function Q(a,c){b("ReasonReact.bs").RemoteAction[3](a,[b("bs_block").__(0,[b("bs_block").__(6,[c])])]);b("setTimeoutAcrossTransitions")(function(){return b("ReasonReact.bs").RemoteAction[3](a,[b("bs_block").__(1,[0])])},3e4);return 0}function R(a,c,d){__p&&__p();var e=c!==undefined?b("bs_js_primitive").valFromOption(c):b("ReasonReact.bs").RemoteAction[0](0),f=[0],g=[[a,b("bs_belt_MapString").empty,b("bs_belt_MapString").empty,b("bs_belt_Set").make([b("ParticipantId.bs").cmp]),b("bs_belt_Set").make([b("ParticipantId.bs").cmp]),0,b("bs_belt_MapString").empty,{},new Set(),new Map(),new Map(),new Map(),da(0),[],{},new Map(),{},{},0]];d=[{}];c=[0];var h=new Map(),i=[{}],j=[0],k=new Set(),l=[{}],m=[0],n=[d,c,h,i,j,k,l,m];b("ReasonReact.bs").RemoteAction[1](function(a){var c=g[0];g[0]=N(a,c,n);if(g[0]!==c)return b("bs_list").iter(function(a){return b("bs_curry")._1(a,g[0])},f[0]);else return 0},e);b("Arbiter").subscribe(Ta(a),function(b,c){b=c.obj;c=b.to;if(!(c==null)&&c.toString()!==a)return 0;else{Q(e,b);return 0}});b("Arbiter").subscribe(b("JSLogger").DUMP_EVENT,function(c,d){__p&&__p();var e={};b("bs_belt_MapString").toArray(g[0][2]).forEach(function(a){var b={};a[1].forEach(function(c,d,a){b[d]=c.watermark;return 0});e[a[0]]=b;return 0});c="read_receipts:"+a;d[c]=e;return 0});d=function(a){return[P[0],P[1],P[2],P[3],function(a){f[0]=[a[3],f[0]];return b("bs_curry")._1(a[4],function(){f[0]=b("bs_list").filter(function(b){return b!==a[3]})(f[0]);return 0})},P[5],P[6],P[7],function(c){return b("bs_curry")._1(a,c[1])},function(){return g[0]},P[10],function(c,a){return b("bs_block").__(0,[c])},P[12]]};c=[e,d];O[a]=c;return c}function S(a,c){c=c!==undefined?b("bs_js_primitive").valFromOption(c):b("CurrentUser").getID();var d=O[c];if(d!==undefined)return d[1];else return R(c,a,0)[1]}function Ua(a,c){a=a!==undefined?b("bs_js_primitive").valFromOption(a):b("CurrentUser").getID();var d=O[a];if(d!==undefined)return b("ReasonReact.bs").RemoteAction[3](d[0],c);else{d=R(a,undefined,0);return b("ReasonReact.bs").RemoteAction[3](d[0],c)}}function T(a){var b=O[a];if(b!==undefined)return b[0];else return R(a,undefined,0)[0]}function U(a,c){return b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(0,[c])])])}function Va(a,c){b("MercuryAssert").isThreadID(c);var d=[undefined],e=function(a){d[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);return b("bs_js_null_undefined").fromOption(d[0])}function V(a,c,d,e){__p&&__p();if(c.length===0){b("bs_curry")._1(d,{});return null}else{b("MercuryAssert").allThreadID(c);var f=[null],g=function(a){f[0]=a;return 0};a=T(a);b("ReasonReact.bs").RemoteAction[3](a,[b("bs_block").__(1,[b("bs_block").__(0,[c,g,d,e])])]);return f[0]}}function W(a,c,d,e){return V(a,[c],function(a){return b("bs_curry")._1(d,a[c])},e)}function Wa(a,c,d,e){__p&&__p();var f=[undefined],g=function(a){f[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==undefined)return b("bs_js_primitive").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function X(a){var c=b("MercuryLocalIDs").generateThreadID(null);Wa(a,c,[],null);return c}function Y(a,c,d,e){__p&&__p();var f=[undefined],g=function(a){f[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,g])])]);g=f[0];if(g!==undefined)return b("bs_js_primitive").valFromOption(g);else{g=b("MessengerThreadUtils.bs").createNewLocalGroupGeneralThread(b("MercuryIDs").getParticipantIDFromUserID(a),c,d,e);b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(1,[b("bs_block").__(4,[c,g])])]);return g}}function Xa(a,c,d){var e=b("MercuryLocalIDs").generateThreadID(null);Y(a,e,c,d);return e}function Ya(a,c){var d=[undefined],e=function(a){d[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==undefined)return b("MercuryThreadInfo").isEmptyLocalThread(b("bs_js_primitive").valFromOption(a));else return!1}function Z(a,c){var d=[undefined],e=function(a){d[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(1,[c,e])])]);a=d[0];if(a!==undefined)return b("MercuryThreadInfo").isNewEmptyLocalThread(b("bs_js_primitive").valFromOption(a));else return!1}function Za(c){var a=[[]],d=function(b){a[0]=b;return 0};b("ReasonReact.bs").RemoteAction[3](T(c),[b("bs_block").__(2,[b("bs_block").__(2,[d])])]);return a[0]}function $a(a,c){return b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(1,[b("bs_block").__(1,[c])])])}function ab(a){__p&&__p();var c=a.payload_source;if(c==null)return!1;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_PAGE_FOLLOW_UP_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANGE_FOLDER)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_DELETE_MESSAGES)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_DELETE_THREAD)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_SEND_MESSAGE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_FETCH_THREADLIST_INFO)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_THREAD_SYNC)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)||b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS))return!0;else if(b("bs_caml_obj").caml_equal(c,b("MercuryPayloadSource").SERVER_INITIAL_DATA)){c=a.ordered_threadlists;return!(c==null)}else return!1}function bb(a,c){c=b("bs_block").__(1,[b("bs_block").__(3,[c])]);return b("ReasonReact.bs").RemoteAction[3](T(a),[c])}function $(a,c){return Ua(a==null?undefined:b("bs_js_primitive").some(a),c)}function cb(a){__p&&__p();var c=[],d=!1;if(!(a==null)){var e=a.payload_source;e==null||b("bs_caml_obj").caml_equal(e,b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)&&(d=!0);e=a.newlyAddedClientIDs;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(41,[e])]));e=a.delivery_receipts;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(0,[e])]));e=a.message_ignored_ids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(1,[e])]));e=a.threads;if(!(e==null)){var f=a.payload_source;f==null||(b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)&&c.push(b("bs_block").__(0,[b("bs_block").__(9,[e])])),b("bs_caml_obj").caml_equal(f,b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE)&&(e.length>0&&c.unshift(b("bs_block").__(0,[b("bs_block").__(16,[b("bs_caml_array").caml_array_get(e,0).thread_id])]))));c.push(b("bs_block").__(0,[b("bs_block").__(8,[e])]))}f=a.participants;if(!(f==null)){c.push(b("bs_block").__(0,[b("bs_block").__(4,[f])]));var g=[],h=[];f.forEach(function(a){if(a.is_messenger_blocked){g.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}else{h.push(b("MercuryIDs").getParticipantIDFromUserID(a.fbid));return 0}});(g.length>0||h.length>0)&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[g,h])]))}e=a.message_blocked_ids;e==null||e.length>0&&c.push(b("bs_block").__(0,[b("bs_block").__(2,[e,[]])]));f=a.pending_folder_unseen_count;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(5,[f])]));e=a.global_actions;e==null||e.forEach(function(a){b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_READ)&&c.push(b("bs_block").__(0,[b("bs_block").__(15,[a.folder])]));if(b("bs_caml_obj").caml_equal(a.action_type,b("MercuryGlobalActionType").MARK_ALL_SEEN)){c.push(b("bs_block").__(0,[b("bs_block").__(42,[a.timestamp,a.folder])]));return 0}else return 0});if(ab(a)){f=a.ordered_threadlists;e=0;!(f==null)&&f.length>0?c.push(b("bs_block").__(0,[b("bs_block").__(11,[f])])):e=1;if(e===1){f=a.threads;e=a.payload_source;f==null||!(e==null)&&f.length>0&&e!==b("MercuryPayloadSource").SERVER_CHANGE_PINNED_STATUS&&c.push(b("bs_block").__(0,[b("bs_block").__(12,[f])]))}}e=a.pinned_thread_ids;e==null||ab(a)&&c.push(b("bs_block").__(0,[b("bs_block").__(14,[e])]));f=a.roger;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(7,[f])]));e=a.montage_delete_message_delta;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(36,[e])]));f=a.montage_new_message_delta;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(34,[f])]));e=a.montage_poll_sticker_vote;e==null||e.forEach(function(a){c.push(b("bs_block").__(1,[b("bs_block").__(3,[a])]));return 0});f=a.current_montage_thread;if(!(f==null)){e=f.user;if(!(e==null)){f=e.messenger_montage_thread;f==null||(c.push(b("bs_block").__(0,[b("bs_block").__(35,[e.id])])),f.montage_messages.edges.forEach(function(a){c.push(b("bs_block").__(0,[b("bs_block").__(34,[a.node])]));return 0}))}}e=a.unread_thread_fbids;e==null||c.push(b("bs_block").__(0,[b("bs_block").__(38,[e])]));f=a.message_counts;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(39,[f])]));e=a.actions;if(!(e==null)){c.push(b("bs_block").__(0,[b("bs_block").__(10,[e,a.from_client])]));if(ab(a)){f=a.actions;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(13,[f])]))}c.push(b("bs_block").__(0,[b("bs_block").__(40,[e])]));f=a.payload_source;var i=f==null?undefined:b("bs_js_primitive").some(f);e.forEach(function(a){__p&&__p();var d=a.action_type;if(b("bs_caml_obj").caml_equal(i,b("bs_js_primitive").some(b("MercuryPayloadSource").SERVER_SEARCH))){c.push(b("bs_block").__(0,[b("bs_block").__(17,[a,0])]));return 0}else if(b("bs_caml_obj").caml_equal(b("bs_js_primitive").nullable_to_opt(a.client_state),b("bs_js_primitive").some(b("MercuryMessageClientState").SEND_TO_SERVER))){c.push(b("bs_block").__(0,[b("bs_block").__(17,[a,0])]));return 0}else{var e=a.thread_id,f=a.upload_id,g=a.upload_data,h=a.message_ids;w(a);if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").DELETE_MESSAGES))if(!(e==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(18,[e,h,i])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").CHANGE_FOLDER)){h=a.new_folder;if(!(e==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(19,[e,h])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").CHANGE_ARCHIVED_STATUS))if(e==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(20,[e,a.archived])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").BLOCK_STATUS_CHANGED)){c.push(b("bs_block").__(0,[b("bs_block").__(3,[b("bs_belt_Option").getWithDefault(b("bs_js_primitive").nullable_to_opt(a.message_blocked_ids),[])])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").DELETE_THREAD))if(e==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(21,[e])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").REACTION_UPDATE)){h=a.messageId;var j=a.userId;if(!(h==null)&&!(j==null)){c.push(b("bs_block").__(0,[b("bs_block").__(24,[h,b("bs_js_primitive").nullable_to_opt(a.reaction),j,i])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").MONTAGE_DIRECT_EXPIRE)){h=a.messageId;if(h==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(25,[h,i])]));return 0}}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").LIVE_LOCATION_UPDATE)){j=a.messageId;h=a.liveLocation;if(!(j==null)&&!(h==null)){c.push(b("bs_block").__(0,[b("bs_block").__(26,[j,h,i])]));return 0}else return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").REPLACE_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(27,[a,i])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER))if(!(f==null)&&!(g==null)){c.push(b("bs_block").__(0,[b("bs_block").__(23,[f,g])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER))if(!(f==null)&&!(g==null)){c.push(b("bs_block").__(0,[b("bs_block").__(22,[f,g,i])]));return 0}else return 0;else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").SEND_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(29,[a,i])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").USER_GENERATED_MESSAGE)){c.push(b("bs_block").__(0,[b("bs_block").__(30,[a,i])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").LOG_MESSAGE))if(b("MessengerMessage.bs").isLocalMessage(a))return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(31,[a,i])]));return 0}else if(b("bs_caml_obj").caml_equal(d,b("MercuryActionType").CHANGE_PINNED_STATUS)&&!(e==null)){c.push(b("bs_block").__(0,[b("bs_block").__(32,[e,a.is_pinned])]));return 0}else return 0}});b("Utils.bs").isTruthy(a.from_client)&&e.forEach(function(d){var a=d.thread_id;if(a==null)return 0;else{c.push(b("bs_block").__(0,[b("bs_block").__(28,[a,d.message_id])]));return 0}})}f=a.end_of_history;f==null||c.push(b("bs_block").__(0,[b("bs_block").__(37,[f,a.payload_source])]))}d&&c.unshift(b("bs_block").__(0,[0]));return c}function db(c,d){var a=[[]],e=function(b,c){c=b[15].get(d);if(c==null)return 0;else{a[0]=C(!0,b,c[1]);return 0}};b("ReasonReact.bs").RemoteAction[3](T(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function eb(c,d){var a=[d],e=function(b,c){c=b[10].get(d);if(c==null)return 0;else{a[0]=c;return 0}};b("ReasonReact.bs").RemoteAction[3](T(c),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return a[0]}function fb(a,c){var d=[undefined],e=function(a,b){d[0]=a;return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);a=d[0];if(a!==undefined)return C(!1,a,c);else return[]}function gb(a,c,d){__p&&__p();var e=[!1],f=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];b=b[1].length;if(a){e[0]=!0;return 0}else{e[0]=b>=d;return 0}}};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[f])])]);return e[0]}function hb(a,c){__p&&__p();var d=[!1],e=function(a,b){__p&&__p();b=a[15].get(c);if(b==null)return 0;else{a=b[0];if(a){d[0]=!0;return 0}else{d[0]=!1;return 0}}};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[e])])]);return d[0]}function ib(a,c){return b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(1,[b("bs_block").__(2,[c])])])}function jb(a,c,d,e){__p&&__p();var f=[],g=function(g,h){__p&&__p();h=g[15].get(c);if(h==null)return 0;else{h=h[1];for(var i=d,j=d+e|0;i<=j;++i){var a=b("bs_belt_Option").flatMap(b("bs_belt_Array").get(h,i),function(a){return B(g,a)});a!==undefined&&f.push(b("bs_js_primitive").valFromOption(a))}return 0}};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[g])])]);return f}var kb=[undefined];function lb(a,c,d,e,f,g,h){__p&&__p();var i=function(i,j){__p&&__p();kb[0]=[c,d,e];var k=i[15].get(c);k=k==null?[[],undefined]:[k[1],k[0]];var l=k[0];if(b("Utils.bs").isSomeTrue(b("bs_js_primitive").undefined_to_opt(j[6][0][c]))){kb[0]=undefined;j[6][0][c]=!1;return 0}else{var m=j[2];m=l.length-b("bs_belt_Option").getWithDefault(b("bs_js_primitive").nullable_to_opt(m.get(c)),0)|0;var n=m-d|0;n=e-n|0;if(n>0&&b("bs_caml_obj").caml_notequal(k[1],1)){k=b("MercuryServerRequests").getForFBID(a);var o=b("bs_js_null_undefined").fromOption(b("bs_belt_Option").map(b("bs_belt_Option").flatMap(b("bs_belt_Array").get(l,m-1|0),function(a){return B(i,a)}),function(a){return a.timestamp})),p=j[4][0];j[4][0]=p+1|0;j[3][0][String(p)]=[[c,d,e],f];if(b("bs_caml_obj").caml_equal([c,d,e],kb[0])){k.fetchThreadMessages(c,m,n,o,g,h);return 0}else return 0}else return b("bs_curry")._1(f,b("bs_belt_Array").keepMap(l,function(a){return B(i,a)}).slice(d,e))}};return b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[i])])])}function mb(a){var c=[0],d=function(a,d){c[0]=b("bs_caml_primitive").caml_int_min(Pa(a,d),b("MercuryThreadlistConstants").MAX_UNSEEN_COUNT);return 0};b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(2,[b("bs_block").__(3,[d])])]);return c[0]}function nb(a){return b("ReasonReact.bs").RemoteAction[3](T(a),[b("bs_block").__(1,[1])])}var ob=b("ReasonReact.bs").wrapReasonForJs(P,function(a){return b("bs_curry")._1(S(undefined,b("bs_js_primitive").nullable_to_opt(a.fbid)),a.children)}),pb=[S];f.fbid=a;f.deliveryReceipts=c;f.readReceiptsPerThread=d;f.ignoredIds=e;f.blockedIds=h;f.pendingFolderUnseenCount=i;f.typing=j;f.threads=k;f.pendingReadStatusThreads=l;f.messages=m;f.localIDsMap=n;f.messagesWithUploadsInFlight=o;f.threadlistOrderMap=p;f.pinnedThreads=q;f.montage=r;f.orderedMessageLists=s;f.unreadCounts=t;f.initialUnreadCounts=u;f.unseenTimestamp=v;f.send=Ua;f.compute=U;f.getThreadMetaNow=Va;f.getMultiThreadMeta=V;f.getThreadMeta=W;f.createNewLocalThread=Wa;f.createNewLocalThreadGenerateID=X;f.createNewLocalGroupGeneralThreadGenerateID=Xa;f.isEmptyLocalThread=Ya;f.isNewEmptyLocalThread=Z;f.getPinnedThreadlist=Za;f.unsubscribeThread=$a;f.sendJS=$;f.invalidateSearchedMessages=ib;f.hasLoadedNMessages=gb;f.hasLoadedAllMessages=hb;f.getCurrentlyLoadedMessages=db;f.getServerMessageID=eb;f.getMessagesFromIDs=fb;f.getThreadMessagesRange=lb;f.getThreadMessagesRangeNow=jb;f.processPollStickerVoted=bb;f.getUnseenUnreadCount=mb;f.markAsSeen=nb;f.processJSActions=cb;f.Provider=pb;f.jsComponent=ob}),null);
__d("MessagingTagUtils",["MercuryMessageSourceTags","MessagingSourceEnum","MessagingTagConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=new Set(Object.values(b("MessagingSourceEnum")));function a(a){__p&&__p();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;if(g.has(e))return e}return b("MessagingSourceEnum").UNKNOWN}function h(a){__p&&__p();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=e.split(b("MessagingTagConstants").app_id_root);if(e.length>1)return e[1].trim()}return null}function c(a,c){var d=[],e=h(a);e&&b("MessagingTagConstants").orca_app_ids.indexOf(e)!==-1&&d.push(b("MercuryMessageSourceTags").MESSENGER);b("MessagingTagConstants").chat_sources.indexOf(c)!==-1&&d.push(b("MercuryMessageSourceTags").CHAT);b("MessagingTagConstants").email_source===c&&d.push(b("MercuryMessageSourceTags").EMAIL);b("MessagingTagConstants").mobile_sources.indexOf(c)!==-1&&d.push(b("MercuryMessageSourceTags").MOBILE);a.indexOf(b("MessagingSourceEnum").WORKPLACE_CHAT_DESKTOP)!==-1&&d.push(b("MercuryMessageSourceTags").WORK_DESKTOP);return d}e.exports={getSourceFromTags:a,getSourceTags:c}}),null);
__d("MessengerStateProcessor",["CurrentUser","MercuryAPIArgsSource","MercuryIDs","MercuryParticipantTypes","MercuryThreadIDMap","MercuryVanityIDMap.bs","MessengerParticipants.bs","MessengerState.bs","MessengerURIConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={preprocess:function(a){__p&&__p();var c=a.activeThreadID;if(c){var d=b("MercuryIDs").getUserIDFromThreadID(c),e=d&&b("MessengerParticipants.bs").getNow(b("MercuryIDs").getParticipantIDFromUserID(d));if(e&&e.type!==b("MercuryParticipantTypes").EVENT)a.threadKey=e.vanity||d;else if(d&&!e){e=b("MercuryIDs").getParticipantIDFromUserID(d);a.threadKey=b("MercuryVanityIDMap.bs").hasID(e)?b("MercuryVanityIDMap.bs").getVanity(e):d}else{e=b("MercuryThreadIDMap").get();d=e.getServerIDFromClientIDNow(c);a.threadKey=d||b("MercuryIDs").tokenize(c).value}}delete a.activeThreadID;return a},postprocess:function(a){var c=b("MercuryThreadIDMap").get(),d=g(a.threadKey),e;e=b("MercuryIDs").isValid(d)?d:c.getClientIDFromServerIDNow(d);if(!e){d=b("MessengerParticipants.bs").getIDFromVanityOrFBID(d);d&&(e=b("MercuryIDs").getThreadIDFromParticipantID(d))}e&&(a.activeThreadID=e,a.serverThreadID=c.getServerIDFromClientIDNow(e));delete a.threadKey;return a},supportInboxPostprocess:function(a){a.threadKey&&(a.activeThreadID=b("MercuryIDs").getThreadIDFromSupportInboxItemID(a.threadKey));delete a.threadKey;return a},supportFacebarTypeaheadPostprocess:function(a){a.threadKey&&(a.activeThreadID=b("MercuryIDs").getThreadIDFromThreadFBID(a.threadKey));delete a.threadKey;return a}};function g(a){return!a?null:a.startsWith(b("MessengerURIConstants").GROUP_PREFIX)?a.substr(b("MessengerURIConstants").GROUP_PREFIX.length):a}e.exports=a}),null);
__d("MessengerURISerializer",["CurrentEnvironment","CurrentUser","MercuryFilters.bs","MercuryIDs","MessagingTag","MessengerStateProcessor","MessengerURIConstants","MessengerView","URI","WWWBase","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="/?$",h=function(a,c){a.setPath(b("CurrentEnvironment").facebookdotcom?b("MessengerURIConstants").FACEBOOK_PREFIX+c:c)},i=function(a,c){var d=a.getPath();b("CurrentEnvironment").facebookdotcom&&!d.startsWith(b("MessengerURIConstants").FACEBOOK_PREFIX)&&(c=b("MessengerURIConstants").FACEBOOK_PREFIX+c);a.setPath(a.getPath()+c)};a={serialize:function(a){__p&&__p();var c=new(b("URI"))(b("WWWBase").uri);a=b("MessengerStateProcessor").preprocess(a);switch(a.masterView){case b("MessengerView").MASTER.PAYMENT:h(c,b("MessengerURIConstants").PAYMENT_PATH);break;case b("MessengerView").MASTER.PEOPLE:h(c,b("MessengerURIConstants").PEOPLE_PATH);break;case b("MessengerView").MASTER.SUPPORT:h(c,b("MessengerURIConstants").SUPPORT_PATH);break;case b("MessengerView").MASTER.WORK_NEW_CHAT:i(c,b("MessengerURIConstants").COMPOSE_SUBPATH);break}switch(a.folder){case b("MessagingTag").OTHER:h(c,b("MessengerURIConstants").FILTERED_REQUESTS_PATH);break;case b("MessagingTag").ACTION_ARCHIVED:h(c,b("MessengerURIConstants").ARCHIVED_PATH);break;case b("MessagingTag").PENDING:h(c,b("MessengerURIConstants").MESSAGE_REQUESTS_PATH);break}a.detailView===b("MessengerView").DETAIL.PAYTHREAD?(i(c,b("MessengerURIConstants").PAYMENT_PAY_PATH),a.threadKey&&c.addQueryData("id",a.threadKey)):a.detailView===b("MessengerView").DETAIL.PAYFRIENDPICKER?i(c,b("MessengerURIConstants").PAYMENT_PAY_PATH):a.detailView===b("MessengerView").DETAIL.COMPOSE?i(c,b("MessengerURIConstants").COMPOSE_SUBPATH):a.threadKey?a.masterView===b("MessengerView").MASTER.PAYMENT?(h(c,b("MessengerURIConstants").THREAD_PREFIX+a.threadKey),delete a.extraQueryParams.id,delete a.extraQueryParams.a,delete a.extraQueryParams.m):i(c,b("MessengerURIConstants").THREAD_PREFIX+a.threadKey):a.masterView===b("MessengerView").MASTER.PAYMENT?(h(c,""),delete a.extraQueryParams.id,delete a.extraQueryParams.a,delete a.extraQueryParams.m):i(c,"");a.extraQueryParams&&c.addQueryData(a.extraQueryParams);b("MercuryFilters.bs").isSupportedFilter(a.filter)&&c.addQueryData({filter:a.filter});if(a.query!=null){var d;c.addQueryData((d={},d[a.masterView===b("MessengerView").MASTER.SEARCH?"qa":"q"]=a.query,d))}a.threadIDs&&c.addQueryData({threadIDs:JSON.stringify(a.threadIDs)});a.mid&&c.addQueryData({mid:a.mid});return c},deserialize:function(a){__p&&__p();var c={},d=a.getPath();b("CurrentEnvironment").facebookdotcom&&!d.startsWith(b("MessengerURIConstants").FACEBOOK_PREFIX)&&(c.notMessenger=!0);d=d.replace(b("MessengerURIConstants").FACEBOOK_PREFIX,"");var e;a=a.getQueryData();var f=a.filter,h=a.mid,i=a.q,k=a.qa,l=a.threadIDs;a=babelHelpers.objectWithoutProperties(a,["filter","mid","q","qa","threadIDs"]);if(l)try{e=JSON.parse(l)}catch(a){}e?c.threadIDs=e.filter(function(a){return b("MercuryIDs").isValidThreadID(a)}):c.threadIDs=null;d.match("^"+b("MessengerURIConstants").PEOPLE_PATH)?c.masterView=b("MessengerView").MASTER.PEOPLE:d.match("^"+b("MessengerURIConstants").SUPPORT_PATH)?c.masterView=b("MessengerView").MASTER.SUPPORT:d.match("^"+b("MessengerURIConstants").PAYMENT_PATH)?c.masterView=b("MessengerView").MASTER.PAYMENT:k?c.masterView=b("MessengerView").MASTER.SEARCH:b("CurrentUser").isWorkUser()&&b("gkx")("678583")&&d.match("^"+b("MessengerURIConstants").COMPOSE_SUBPATH)?c.masterView=b("MessengerView").MASTER.WORK_NEW_CHAT:c.masterView=b("MessengerView").MASTER.RECENT;d.match("^"+b("MessengerURIConstants").FILTERED_REQUESTS_PATH)?c.folder=b("MessagingTag").OTHER:d.match("^"+b("MessengerURIConstants").ARCHIVED_PATH)?c.folder=b("MessagingTag").ACTION_ARCHIVED:d.match("^"+b("MessengerURIConstants").MESSAGE_REQUESTS_PATH)?c.folder=b("MessagingTag").PENDING:c.folder=b("MessagingTag").INBOX;if(d.match(b("MessengerURIConstants").COMPOSE_SUBPATH+g))c.detailView=b("MessengerView").DETAIL.COMPOSE;else if(d.match("^"+b("MessengerURIConstants").PAYMENT_PATH+b("MessengerURIConstants").PAYMENT_PAY_PATH))a&&a.id?(c.threadKey=a.id,c.detailView=b("MessengerView").DETAIL.PAYTHREAD):c.detailView=b("MessengerView").DETAIL.PAYFRIENDPICKER;else{l=j(d);l&&(c.threadKey=l,c.detailView=b("MessengerView").DETAIL.THREAD)}b("MercuryFilters.bs").isSupportedFilter(f)?c.filter=f:c.filter=b("MercuryFilters.bs").all;c.mid=h;c.query=k||i;c.extraQueryParams=a;if(c.masterView===b("MessengerView").MASTER.SUPPORT)return b("MessengerStateProcessor").supportInboxPostprocess(c);return((d=c.extraQueryParams)==null?void 0:d.fref)==="ts"?b("MessengerStateProcessor").supportFacebarTypeaheadPostprocess(c):b("MessengerStateProcessor").postprocess(c)}};function j(a){a=a.match(b("MessengerURIConstants").THREAD_PREFIX+"([^/]+)"+g);return a&&decodeURIComponent(a[1])}e.exports=a}),null);
__d("MercurySingletonMixin",["CurrentUser"],(function(a,b,c,d,e,f){a={_getInstances:function(){this._instances||(this._instances={});return this._instances},get:function(){return this.getForFBID(b("CurrentUser").getID())},getForFBID:function(a){var b=this._getInstances();b[a]||(b[a]=new this(a));return b[a]}};e.exports=a}),null);
__d("MercuryMessageActions",["MercuryActionType","MercuryDispatcher","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=b("MercuryMessageObject").getForFBID(this.$1),this.__serverRequests=b("MercuryServerRequests").getForFBID(this.$1),this.__dispatcher=b("MercuryDispatcher").getForFBID(this.$1)}a.prototype.send=function(a,c,d){c=c||Function.prototype,this.$2.normalizeNewMessage(a),this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},a),b("MercuryPayloadSource").CLIENT_SEND_MESSAGE)),this.__serverRequests.sendNewMessage(a,d),c(a.thread_id)};a.prototype.resend=function(a,b){a=babelHelpers["extends"]({},a);this.$2.normalizeResendMessage(a);this.send(a,undefined,b)};a.prototype.addAttachmentPlaceholder=function(a,c,d){this.$2.normalizeAddAttachmentPlaceholder(a,c,d),this.$2.normalizeNewMessage(a),this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers["extends"]({},a),b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};a.prototype.cancelAttachmentPlaceholder=function(a,c){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:a,upload_data:c,action_type:b("MercuryActionType").CANCEL_ATTACHMENT_PLACEHOLDER},b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};a.prototype.confirmAttachmentPlaceholder=function(a,c){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:a,upload_data:c,action_type:b("MercuryActionType").CONFIRM_ATTACHMENT_PLACEHOLDER},b("MercuryPayloadSource").CLIENT_SEND_MESSAGE))};a.prototype["delete"]=function(a,c,d){this.__dispatcher.handleUpdate(this.$3(a,c,b("MercuryActionType").DELETE_MESSAGES,d||b("MercuryPayloadSource").CLIENT_DELETE_MESSAGES))};a.prototype.__constructClientSingleMessagePayload=function(a,b){return{actions:[a],from_client:!0,payload_source:b}};a.prototype.$4=function(a,b){return{actions:[a],from_client:!1,payload_source:b}};a.prototype.$3=function(a,b,c,d){return{actions:[{action_type:c,thread_id:a,message_ids:b}],from_client:!0,payload_source:d}};Object.assign(a,b("MercurySingletonMixin"));e.exports=a}),null);
__d("MercuryThreadActions",["codedError","cssVar","fbt","invariant","AsyncDialog","AsyncRequest","AsyncResponse","Bootloader","CurrentUser","EmojiLikeConstants","IgnoreMessagesTypedLogger","JSResource","MercuryActionType","MercuryAPIArgsSource","MercuryDispatcher","MercuryIDs","MercuryLogMessageType","MercuryMessengerBlockingUtils","MercuryPayloadSource","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonMixin","MercurySourceType","MercuryThreadlistConstants","MessengerConfig","MessengerGroupLinkActionType","MessengerParticipants.bs","MessengerState.bs","MercuryThreadIDMap","MercuryViewer","MercuryMessageActions","MessengerActions","MercuryMessageObject","MessagingTag","MessengerEmojiTransitionMapping.bs","MessengerGroupsSyncStatus","MessengerGroupsSyncStatusChangeMutationWebGraphQLMutation","MessengerThreadThemeUpdateWebGraphQLMutation","PageCommItemStatus","Placeholder.react","React","ReloadPage","URI","WebGraphQL","XChatRemoveParticipantAsyncController","XGroupsJoinChatController","XMercuryThreadLikeIconController","XMessagingGroupJoinableAcceptController","XMessagingGroupJoinableInviteController","XMessagingGroupJoinableRejectController","XMessagingGroupJoinThroughHashController","XMessagingGroupJoinThroughPrivateLinkController","XMessagingGroupSetApprovalController","XMessagingJoinableLinkController","XMessagingSaveAdminsController","XMessagingSaveGroupThreadDescriptionController","XMessagingSaveNicknameController","XMessagingSaveThreadColorController","XMessagingSaveThreadEmojiController","XNFXMessengerBlockActionController","XMessagingBlockMessagesController","XMessagingUnblockMessagesController","XNFXIgnoreMessagesActionController","ex","lazyLoadComponent"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k=b("MercuryThreadIDMap").get(),l=b("MercuryMessageActions").get(),m=b("MercuryMessageObject").get(),n=b("lazyLoadComponent")(b("JSResource")("MessengerSimpleDialogReact").__setRef("MercuryThreadActions"));function a(a){this.$1=a,this.__serverRequests=b("MercuryServerRequests").getForFBID(this.$1),this.__dispatcher=b("MercuryDispatcher").getForFBID(this.$1),this.__payloadPreprocessor=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1)}a.prototype.markRead=function(a,b){this.batchMarkRead([a],b)};a.prototype.batchMarkRead=function(a,b){this.__dispatcher.handleUpdate(this.$2(a,!0,b))};a.prototype.markUnread=function(a,b){this.batchMarkUnread([a],b)};a.prototype.batchMarkUnread=function(a,b){this.__dispatcher.handleUpdate(this.$2(a,!1,b))};a.prototype.markSeen=function(a,c){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").MARK_THREAD_SEEN,b("MercuryPayloadSource").CLIENT_MARK_THREAD_SEEN,{persistent:c}))};a.prototype.archive=function(a,b){this.batchArchive([a],b)};a.prototype.batchArchive=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadArchivedStatus(a,!0,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$3(a,!0))};a.prototype.unarchive=function(a,b){this.batchUnarchive([a],b)};a.prototype.batchUnarchive=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadArchivedStatus(a,!1,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$3(a,!1))};a.prototype.pin=function(a,c,d){__p&&__p();var e=b("MessengerState.bs").getPinnedThreadlist(b("CurrentUser").getID()),f=b("CurrentUser").isWorkUser(),h=f?b("MercuryThreadlistConstants").MAX_PINNED_THREADS:b("MessengerConfig").MPT;e=e.length>=h;if(e){e=g._(1545078,function(a){return a._("Impossible d\u2019\u00e9pingler la discussion")},function(a,b){return a._("Vous pouvez \u00e9pingler jusqu\u2019\u00e0 {max_threads} discussions. Pour \u00e9pingler cette discussion, d\u00e9tachez-en une autre et r\u00e9essayez.",[a._param("max_threads",b.max_threads)])},{max_threads:h});var j=f?i._("Vous ne pouvez plus \u00e9pingler de discussions"):e.summary,k=f?i._("Vous ne pouvez pas \u00e9pingler plus de 15 discussions sur Workplace. Pour \u00e9pingler celle-ci, essayez d\u2019en d\u00e9tacher une autre."):e.description;b("Bootloader").loadModules(["MessengerDialogs.bs"],function(a){a.showDialog(function(){return b("React").createElement(b("Placeholder.react"),{fallback:b("React").createElement("div",null)},b("React").createElement(n,{title:j,body:k}))})},"MercuryThreadActions")}else this.batchPin([a],d),this.$4(a,!0,c)};a.prototype.batchPin=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadPinnedStatus(a,!0,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$5(a,!0))};a.prototype.unpin=function(a,b,c){this.batchUnpin([a],c),this.$4(a,!1,b)};a.prototype.batchUnpin=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadPinnedStatus(a,!1,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$5(a,!1))};a.prototype.markPageFollowUp=function(a,b){this.batchMarkPageFollowUp([a],b)};a.prototype.batchMarkPageFollowUp=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadPageFollowUpStatus(a,!0,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$6(a,!0))};a.prototype.unmarkPageFollowUp=function(a,b){this.batchUnmarkPageFollowUp([a],b)};a.prototype.batchUnmarkPageFollowUp=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadPageFollowUpStatus(a,!1,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$6(a,!1))};a.prototype.markSpam=function(a,b){this.batchMarkSpam([a],b)};a.prototype.batchMarkSpam=function(a,c){a.forEach(function(a){this.__serverRequests.markThreadSpam(a,c)}.bind(this)),this.__dispatcher.handleUpdate(this.$7(a,b("MessagingTag").SPAM))};a.prototype.unmarkSpam=function(a,b){this.batchUnmarkSpam([a],b)};a.prototype.batchUnmarkSpam=function(a,c){a.forEach(function(a){this.__serverRequests.unmarkThreadSpam(a,c)}.bind(this)),this.__dispatcher.handleUpdate(this.$7(a,b("MessagingTag").INBOX))};a.prototype.changeFolder=function(a,b){this.batchChangeFolder([a],b)};a.prototype.batchChangeFolder=function(a,b){a.forEach(function(a){this.__serverRequests.changeThreadFolder(a,b)}.bind(this)),this.__dispatcher.handleUpdate(this.$7(a,b))};a.prototype["delete"]=function(a,b){this.batchDelete([a],b),this.batchUnpin([a],b)};a.prototype.batchDelete=function(a,c){this.__serverRequests.deleteThreads(a,c),this.__dispatcher.handleUpdate(this.__constructClientPayload(a,b("MercuryActionType").DELETE_THREAD,b("MercuryPayloadSource").CLIENT_DELETE_THREAD))};a.prototype.unmute=function(a){this.updateMuteSetting(a,0)};a.prototype.updateMuteSetting=function(a,c){this.__serverRequests.changeMutingOnThread(a,c),this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").CHANGE_MUTE_SETTINGS,b("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:c}))};a.prototype.updateMentionsMuteSetting=function(a,c){c=c?1:0;this.__serverRequests.changeMentionsMutingOnThread(a,c);this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").CHANGE_MUTE_SETTINGS,b("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:c}))};a.prototype.updateReactionsMuteSetting=function(a,c){c=c?1:0;this.__serverRequests.changeReactionsMutingOnThread(a,c);this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").CHANGE_MUTE_SETTINGS,b("MercuryPayloadSource").CLIENT_CHANGE_MUTE_SETTINGS,{reactions_mute_mode:c}))};a.prototype.blockMessages=function(a,c){var d="",e=b("MercuryIDs").getUserIDFromThreadID(a);e!==null||j(0,400);var f=b("MessengerParticipants.bs").getNow(b("MercuryIDs").getParticipantIDFromUserID(e));d=f&&f.short_name;f=b("XNFXMessengerBlockActionController").getURIBuilder().setInt("thread_fbid",e).setEnum("location","www_chat_head").getURI();b("AsyncDialog").send(new(b("AsyncRequest"))(f),function(e){e.subscribe("confirm",function(){e.hide(),c&&c(d),this.changeFolder(a,b("MessagingTag").OTHER)}.bind(this))}.bind(this))};a.prototype.unblockMessages=function(a){var c=b("MercuryIDs").getUserIDFromThreadID(a);if(c===null)throw new Error(b("ex")("Expected user ID to unblock messages for, got null"));c=JSON.stringify({reportable_ent_token:c,initial_action_name:b("MercuryMessengerBlockingUtils").block_messages});new(b("AsyncRequest"))(new(b("URI"))("/ajax/nfx/messenger_undo_block").addQueryData({story_location:"messenger",context:c})).setHandler(function(){return this.changeFolder(a,b("MessagingTag").INBOX)}.bind(this)).send()};a.prototype.ignoreMessages=function(a,c){c=b("XNFXIgnoreMessagesActionController").getURIBuilder().setInt("thread_fbid",a).setEnum("location","www_chat_head").getURI();b("AsyncDialog").send(new(b("AsyncRequest"))(c))};a.prototype.blockOnMessengerDotCom=function(a){var c=b("XMessagingBlockMessagesController").getURIBuilder().getURI();new(b("IgnoreMessagesTypedLogger"))().setEvent("block_confirmed").setThreadID(b("MercuryIDs").getThreadFBIDFromThreadID(a)).setPlatform("messengerdotcom").log();new(b("AsyncRequest"))(c).setMethod("POST").setData({fbid:b("MercuryIDs").getUserIDFromThreadID(a)}).send()};a.prototype.blockIgnoreOnMessengerDotCom=function(a,c,d){a&&b("MessengerActions").selectThread(null),this.changeFolder(c,b("MessagingTag").OTHER),this.blockOnMessengerDotCom(c),d&&d()};a.prototype.unblockOnMessengerDotCom=function(a){var c=b("XMessagingUnblockMessagesController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData({fbid:b("MercuryIDs").getUserIDFromThreadID(a)}).setHandler(function(){return this.changeFolder(a,b("MessagingTag").INBOX)}.bind(this)).send()};a.prototype.leaveGroup=function(a){l.send(m.constructLogMessageObject(b("MercurySourceType").TITAN_WEB,a,b("MercuryLogMessageType").UNSUBSCRIBE,{removed_participants:[b("MercuryViewer").getID()]}),null,b("MercuryAPIArgsSource").WEBMESSENGER)};a.prototype.deleteSyncedGroup=function(a){if(!a)return;if(a.groups_sync_status!=b("MessengerGroupsSyncStatus").OPT_IN)return;k.getServerIDFromClientID(a.thread_id,function(a){a={client_mutation_id:"0",actor_id:b("CurrentUser").getID(),thread_fbid:a,groups_sync_status:b("MessengerGroupsSyncStatus").OPT_OUT};b("WebGraphQL").exec(new(b("MessengerGroupsSyncStatusChangeMutationWebGraphQLMutation"))({data:a}))})};a.prototype.removeFromGroup=function(a,c){var d=b("XChatRemoveParticipantAsyncController").getURIBuilder().getURI();a={tid:a,uid:c};new(b("AsyncRequest"))(d).setMethod("POST").setData(a).send()};a.prototype.changeThreadTheme=function(a,c,d){k.getServerIDFromClientID(a,function(a){b("WebGraphQL").exec(new(b("MessengerThreadThemeUpdateWebGraphQLMutation"))({data:{client_mutation_id:0,actor_id:b("CurrentUser").getID(),thread_id:a,theme_id:c,source:d}}))})};a.prototype.changeThreadColor=function(a,c,d){k.getServerIDFromClientID(a,function(a){var e={};c!="#0084ff"&&(e.color_choice=c);e.thread_or_other_fbid=a;a=b("XMessagingSaveThreadColorController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(a).setMethod("POST").setData(e).send()})};a.prototype.changeThreadEmoji=function(a,c,d){k.getServerIDFromClientID(a,function(a){var e={},f=String.fromCodePoint.apply(String,c);b("MessengerEmojiTransitionMapping.bs").hasGender(c)&&(f=String.fromCodePoint.apply(String,b("MessengerEmojiTransitionMapping.bs").removeAllModifiers(c)));f!==String.fromCodePoint(b("EmojiLikeConstants").FB_THUMBS_UP_EMOJI)&&f!==String.fromCodePoint(b("EmojiLikeConstants").THUMBS_UP_EMOJI_CODES)&&(e.emoji_choice=f);e.thread_or_other_fbid=a;f=b("XMessagingSaveThreadEmojiController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(e).send()})};a.prototype.changeThreadNicknames=function(a,c,d,e){k.getServerIDFromClientID(a,function(a){a={thread_or_other_fbid:a,participant_id:c,nickname:d};var f=b("XMessagingSaveNicknameController").getURIBuilder().setEnum("source",e).getURI();new(b("AsyncRequest"))(f).setMethod("POST").setData(a).send()})};a.prototype.changeGroupThreadDescription=function(a,c,d){k.getServerIDFromClientID(a,function(a){a={thread_fbid:a,description:c};var e=b("XMessagingSaveGroupThreadDescriptionController").getURIBuilder().setEnum("source",d).getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(a).send()})};a.prototype.setApprovalMode=function(a,c){var d=b("XMessagingGroupSetApprovalController").getURIBuilder().getURI();new(b("AsyncRequest"))(d).setMethod("POST").setData({set_mode:a,thread_fbid:c.thread_fbid}).send()};a.prototype.changeGroupAdmins=function(a,c,d){a={thread_fbid:a,admin_ids:c,add:d};c=b("XMessagingSaveAdminsController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};a.prototype.joinThroughHash=function(a,c,d){a={link_hash:a};var e=b("XMessagingGroupJoinThroughHashController").getURIBuilder().getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(a).setHandler(function(){return c()}).setErrorHandler(function(a){d()||b("AsyncResponse").defaultErrorHandler(a)}).setTransportErrorHandler(function(){return d()}).send()};a.prototype.joinThroughPrivateLink=function(a){a={link_hash:a};var c=b("XMessagingGroupJoinThroughPrivateLinkController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};a.prototype.chatJoinThroughHash=function(a){a={link_hash:a};var c=b("XGroupsJoinChatController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).setHandler(function(a){return b("ReloadPage").now()}).send()};a.prototype.createJoinableLink=function(a,c){if(b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),a))return;k.getServerIDFromClientID(a,function(a){a={thread_fbid:a};var d=b("XMessagingJoinableLinkController").getURIBuilder().setEnum("action",b("MessengerGroupLinkActionType").CREATE_LINK).getURI();new(b("AsyncRequest"))(d).setMethod("POST").setData(a).setHandler(function(a){a=a.getPayload();a&&c(a)}).send()})};a.prototype.revokeAndRegenerateJoinableLink=function(a,c){if(b("MessengerState.bs").isEmptyLocalThread(b("CurrentUser").getID(),a))return;k.getServerIDFromClientID(a,function(d){d={thread_fbid:d};var e=b("XMessagingJoinableLinkController").getURIBuilder().setEnum("action",b("MessengerGroupLinkActionType").REVOKE_LINK).getURI();new(b("AsyncRequest"))(e).setMethod("POST").setData(d).setHandler(function(b){return this.createJoinableLink(a,c)}.bind(this)).send()}.bind(this))};a.prototype.inviteToJoinableGroup=function(a,c){a={thread_fbid:a,user_ids:c};c=b("XMessagingGroupJoinableInviteController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};a.prototype.acceptToJoinableGroup=function(a,c){a={thread_fbid:a,user_id:c};c=b("XMessagingGroupJoinableAcceptController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};a.prototype.rejectToJoinableGroup=function(a,c){a={thread_fbid:a,user_id:c};c=b("XMessagingGroupJoinableRejectController").getURIBuilder().getURI();new(b("AsyncRequest"))(c).setMethod("POST").setData(a).send()};a.prototype.addParticipants=function(a,c){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").ADD_PARTICIPANTS,b("MercuryPayloadSource").CLIENT_ADD_PARTICIPANTS,{participants:c}))};a.prototype.updateCustomLike=function(a,c){c=b("XMercuryThreadLikeIconController").getURIBuilder().setString("emoji",c).getURI();new(b("AsyncRequest"))().setURI(c).setHandler(function(c){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").UPDATE_CUSTOM_LIKE,b("MercuryPayloadSource").CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:c.getPayload()}))}.bind(this)).send()};a.prototype.movePendingToInbox=function(a){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").MOVE_PENDING_TO_INBOX,b("MercuryPayloadSource").CLIENT_MOVE_PENDING_TO_INBOX))};a.prototype.updateSnippet=function(a,c){this.__dispatcher.handleUpdate(this.__constructClientPayload([a],b("MercuryActionType").UPDATE_SNIPPET,b("MercuryPayloadSource").CLIENT_UPDATE_SNIPPET,{deleted_ids:c}))};a.prototype.updateCommStatus=function(a,c){this.__dispatcher.handleUpdate(this.$8(a,c));c=c===b("PageCommItemStatus").DONE;this.__dispatcher.handleUpdate(this.$3(a,c))};a.prototype.updateCommItemOwner=function(a,b,c,d){this.__dispatcher.handleUpdate(this.$9(a,b,c,d))};a.prototype.$2=function(a,c,d){return this.__constructClientPayload(a,b("MercuryActionType").CHANGE_READ_STATUS,b("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS,{mark_as_read:c,source:d,timestamp:0})};a.prototype.$9=function(a,c,d,e){return this.__constructClientPayload(a,b("MercuryActionType").UPDATE_COMM_ITEM_OWNER,b("MercuryPayloadSource").UPDATE_COMM_ITEM_OWNER,{id:d,name:c,profile_pic_uri:e})};a.prototype.$3=function(a,c){return this.__constructClientPayload(a,b("MercuryActionType").CHANGE_ARCHIVED_STATUS,b("MercuryPayloadSource").CLIENT_CHANGE_ARCHIVED_STATUS,{archived:c})};a.prototype.$5=function(a,c){return this.__constructClientPayload(a,b("MercuryActionType").CHANGE_PINNED_STATUS,b("MercuryPayloadSource").CLIENT_CHANGE_PINNED_STATUS,{is_pinned:c})};a.prototype.$6=function(a,c){return this.__constructClientPayload(a,b("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS,b("MercuryPayloadSource").CLIENT_CHANGE_PAGE_FOLLOW_UP_STATUS,{is_page_follow_up:c})};a.prototype.$8=function(a,c){return this.__constructClientPayload(a,b("MercuryActionType").UPDATE_COMM_STATUS,b("MercuryPayloadSource").CLIENT_UPDATE_COMM_STATUS,{comm_status:c})};a.prototype.$7=function(a,c){return this.__constructClientPayload(a,b("MercuryActionType").CHANGE_FOLDER,b("MercuryPayloadSource").CLIENT_CHANGE_FOLDER,{new_folder:c})};a.prototype.__constructClientPayload=function(a,b,c,d){return{actions:a.map(function(a){return babelHelpers["extends"]({action_type:b,thread_id:a},d)}),from_client:!0,payload_source:c}};a.prototype.$4=function(a,c,d){b("Bootloader").loadModules(["ChatPinnedThreadsTypedLogger","ChatPinnedThreadsEvent"],function(e,f){new e().setEvent(c?f.PIN_THREAD:f.UNPIN_THREAD).setIsWorkplace(b("CurrentUser").isWorkUser()).setThreadID(a).setEntryPoint(d).log()},"MercuryThreadActions")};Object.assign(a,b("MercurySingletonMixin"));e.exports=a}),null);
__d("MercuryDelayedDispatcher",["MercuryDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=[],this.$3=b("MercuryThreadIDMap").getForFBID(this.$1),this.$4=b("MercuryDispatcher").getForFBID(this.$1),this.$5=b("MercuryServerRequests").getForFBID(this.$1),this.$6=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.$4.subscribe("model-update-completed",function(a,b){return this.$7()}.bind(this))}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.handleUpdateWaitForThread=function(a,b){var c=this.$3.getClientIDFromServerIDNow(b);if(c){this.$8(a);return}this.$3.getClientIDFromServerID(b,function(){return this.$2.push({thread_fbid:b,payload:a})}.bind(this));this.$5.ensureThreadIsFetched(b)};a.prototype.$7=function(){if(this.$2&&this.$2.length){var a=this.$2.shift(),b=a.thread_fbid;a=a.payload;this.handleUpdateWaitForThread(a,b)}};a.prototype.$8=function(a){a.from_client?this.$4.handleUpdate(a):this.$6.handleUpdate(a)};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryDispatcher",["invariant","ArbiterMixin","LogHistory","MercuryActionType","MercuryPayloadSource","MercurySingletonProvider","MercuryThreadInformer","MessengerParticipants.bs","MessengerState.bs","isEmpty","mixin"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("LogHistory").getInstance("mercury_dispatcher");c=babelHelpers.inherits(a,b("mixin")(b("ArbiterMixin")));h=c&&c.prototype;a.getForFBID=function(a){return j.getForFBID(a)};a.get=function(){return j.get()};function a(a){h.constructor.call(this),this.$MercuryDispatcher1=a}a.prototype.handleUpdate=function(a){__p&&__p();this.$MercuryDispatcher2(a),!!a.from_client!==!!a.preprocessed||g(0,5757),delete a.preprocessed,b("isEmpty")(a)||b("MercuryThreadInformer").getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){__p&&__p();a.payload_source===b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE&&(this.inform("invalidate-global-state",{}),b("MessengerParticipants.bs").reset());if(a.payload_source===b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE){var c=a.threads&&a.threads.length>0&&a.threads[0]&&a.threads[0].thread_id;c&&this.inform("invalidate-thread-state",c)}this.inform("update-thread-ids",a.newlyAddedClientIDs);b("MessengerParticipants.bs").addParticipants(a);b("MessengerState.bs").sendJS(this.$MercuryDispatcher1,b("MessengerState.bs").processJSActions(a));this.inform("update-unread",a);this.inform("update-threadlist",a);this.inform("update-messages",a);this.inform("update-unseen",a);this.inform("model-update-completed",null)}.bind(this))};a.prototype.$MercuryDispatcher2=function(a){__p&&__p();var c=a.payload_source;if(c===b("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS||c===b("MercuryPayloadSource").CLIENT_MARK_THREAD_SEEN)return;var d={from_client:a.from_client,messages:null};if(a.actions){a=a.actions.filter(function(a){return a.action_type===b("MercuryActionType").USER_GENERATED_MESSAGE||a.action_type===b("MercuryActionType").LOG_MESSAGE}).map(function(a){return{action_type:a.action_type,other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,message_id:a.message_id}});a.length&&(d.messages=a)}i.debug("update:"+c,JSON.stringify(d))};var j=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryMessageObject",["BanzaiODS","MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySendMessageFields","MercurySingletonProvider","MercurySourceType","MessengerObjectAssociationType","MessengerState.bs"],(function(a,b,c,d,e,f){__p&&__p();a.getForFBID=function(a){"use strict";return i.getForFBID(a)};a.get=function(){"use strict";return i.get()};function a(a){"use strict";this.$1=a}a.prototype.constructUserGeneratedMessageObject=function(a,c,d,e,f,h){__p&&__p();h===void 0&&(h=null);c=g(this.$1,b("MercuryActionType").USER_GENERATED_MESSAGE,c,d);typeof a==="string"&&(a=a.replace(/^\s+/,"").replace(/\s+$/,""));c.body=a;c.has_attachment=!1;c.html_body=!1;c.attachments=[];c.specific_to_list=e||[];c.creator_info=f;h&&h.length>0&&(c.tags=h);return c};a.prototype.constructStickerMessageObject=function(a,c,d,e){e===void 0&&(e=null);c=g(this.$1,b("MercuryActionType").USER_GENERATED_MESSAGE,c,d);c.has_attachment=!0;c.html_body=!1;c.attachments=[];c.sticker_id=a;c.specific_to_list=[];e&&e.length>0&&(c.tags=e);return c};a.prototype.constructAttachmentMessageObject=function(a,c){"use strict";a=g(this.$1,b("MercuryActionType").USER_GENERATED_MESSAGE,a,c);a.attachments=[];a.specific_to_list=[];return a};a.prototype.constructLogMessageObject=function(a,c,d,e){"use strict";a=g(this.$1,b("MercuryActionType").LOG_MESSAGE,a,c);a.log_message_type=d;a.log_message_data=e;e&&e.untypedData&&e.untypedData.ttl&&(a.ephemeral_ttl_mode=e.untypedData.ttl);return a};a.prototype.constructCTAConfirmationMessageObject=function(a,b,c,d,e){e===void 0&&(e=null);a=this.constructUserGeneratedMessageObject(a,b,c,null,null);({});d?b={quick_replies:d,ignore_for_webhook:!1}:b={ignore_for_webhook:!0};a.platform_xmd=JSON.stringify(b);e&&e.length>0&&(a.tags=e);return a};a.prototype.normalizeNewMessage=function(a){"use strict";__p&&__p();a.status===undefined&&(a.status=b("MercuryActionStatus").UNSENT);a.offline_threading_id=a.offline_threading_id||b("MercuryLocalIDs").generateOfflineThreadingID(a.timestamp);a.offline_threading_id||b("BanzaiODS").bumpEntityKey("chat.web","invalid_otid_generated");a.message_id=a.message_id||a.offline_threading_id;var c=b("MercuryIDs").getParticipantIDFromUserID(this.$1);a.specific_to_list=a.specific_to_list||[];a.specific_to_list.length&&a.specific_to_list.indexOf(c)===-1&&a.specific_to_list.push(c);var d=!1;if(!a.thread_id)a.thread_id="root:"+a.offline_threading_id;else{var e,f=b("MessengerState.bs").getThreadMetaNow(this.$1,a.thread_id);f&&f.ephemeral_ttl_mode!==null&&a.ephemeral_ttl_mode===undefined&&(a.ephemeral_ttl_mode=f.ephemeral_ttl_mode);((e=f)!=null?(e=e.associated_object)!=null?e.name:e:e)&&((e=f)!=null?e.object_association_type:e)===b("MessengerObjectAssociationType").GENERAL_CHAT&&(d=!0)}if(!d)if(a.specific_to_list.length==1)a.thread_id="user:"+this.$1;else if(a.specific_to_list.length==2){f=a.specific_to_list[0]==c?a.specific_to_list[1]:a.specific_to_list[0];a.thread_id=b("MercuryIDs").getThreadIDFromParticipantID(f)}if(!a.specific_to_list.length){e=b("MercuryIDs").tokenize(a.thread_id);d=e.type;f=e.value;d=="user"&&(a.specific_to_list=["fbid:"+f,c])}a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]||(a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]=0)};a.prototype.normalizeResendMessage=function(a){"use strict";a.status=b("MercuryActionStatus").RESENDING,a.timestamp=Date.now(),a[b("MercurySendMessageFields").MANUAL_RETRY_CNT]+=1};a.prototype.normalizeAddAttachmentPlaceholder=function(a,c,d){"use strict";d.preview_attachments.length>0&&(a.has_attachment=!0,a.preview_attachments=d.preview_attachments),a.client_state=b("MercuryMessageClientState").DO_NOT_SEND_TO_SERVER,a.status=b("MercuryActionStatus").RESENDING,a.upload_id=c};function g(a,c,d,e){var f=h(d)?[b("MercuryMessageSourceTags").CHAT]:[],g=Date.now();c={action_type:c,thread_id:e,author:b("MercuryIDs").getParticipantIDFromUserID(a),author_email:null,timestamp:g,is_unread:!1,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_spoof_warning:!1,source:d,source_tags:f};return c}function h(a){switch(a){case b("MercurySourceType").CHAT_WEB:case b("MercurySourceType").CHAT_JABBER:case b("MercurySourceType").CHAT_IPHONE:case b("MercurySourceType").CHAT_MEEBO:case b("MercurySourceType").CHAT_ORCA:case b("MercurySourceType").CHAT_TEST:case b("MercurySourceType").CHAT:return!0;default:return!1}}var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],(function(a,b,c,d,e,f){var g=b("BanzaiLogger").create({retry:!0}),h=b("Banzai").isEnabled("mercury_send_error_logging");a={log:function(a){if(!h)return;a={message_id:a.message_id,timestamp_client:Date.now(),error_type:a.error_data.type,error_code:a.error_data.code,error_description:a.error_data.description,is_transient:a.error_data.is_transient};g.log("MercurySendErrorLoggerConfig",a)}};e.exports=a}),null);
__d("MercuryServerPayloadPreprocessor",["invariant","MercuryActionStatus","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercuryIDs","MercurySendErrorLogger","MercurySingletonProvider","MercuryThreadIDMap","MessengerEnvironment","URI"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=b("MercuryThreadIDMap").getForFBID(this.$1),this.$3=b("MercuryDispatcher").getForFBID(this.$1)}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};a.prototype.handleUpdate=function(a){__p&&__p();var c={};a.from_client&&g(0,2150);(a.threads||[]).forEach(function(a){this.$4(a,c);var b=this.$2.getServerIDFromClientIDNow(a.thread_id);d(["MercuryServerRequests"],function(c){c=c.getForFBID(this.$1);c.markThreadFetched(a.thread_id);b&&c.markThreadFetched(b);c.updateLastActionTimestamp(a.timestamp)}.bind(this))}.bind(this));a.pinned_thread_ids=(a.pinned_thread_ids||[]).map(function(a){return this.$2.getClientIDFromServerIDNow(a)}.bind(this));(a.ordered_threadlists||[]).forEach(function(a){var b=a.thread_fbids||[];b=b.concat(a.other_user_fbids||[]);a.thread_ids=b.map(function(a){return this.$2.getClientIDFromServerIDNow(a.toString())}.bind(this))}.bind(this));if(a.delivery_receipts){var e={};for(var f=a.delivery_receipts,h=Array.isArray(f),i=0,f=h?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=f.length)break;j=f[i++]}else{i=f.next();if(i.done)break;j=i.value}j=j;var k=j.other_user_fbid?b("MercuryIDs").getThreadIDFromUserID(j.other_user_fbid):this.$2.getClientIDFromServerIDNow(j.thread_fbid);k&&(e[k]=j.time)}a.delivery_receipts=e}a.actions=a.actions||[];a.actions.forEach(function(e){e.action_type===b("MercuryActionType").SEND_MESSAGE&&e.status===b("MercuryActionStatus").ERROR&&b("MercurySendErrorLogger").log(e);var f=null,h=null;e.other_user_fbid?(h=b("MercuryIDs").getThreadIDFromUserID(e.other_user_fbid),f=e.other_user_fbid):e.thread_fbid?(h=b("MercuryIDs").getThreadIDFromThreadFBID(e.thread_fbid),f=e.thread_fbid):e.thread_id?(h=b("MercuryIDs").getThreadIDFromThreadFBID(e.thread_id),f=e.thread_id):e.status&&e.status!=b("MercuryActionStatus").SUCCESS&&e.client_thread_id?h=e.client_thread_id:g(0,2151,e.action_type,e.status);f=f&&f.toString();e.thread_id=this.$2.hasClientIDForServerID(f)?this.$2.getClientIDFromServerIDNow(f):h;e.action_type==b("MercuryActionType").SEND_MESSAGE&&e.client_thread_id&&f&&(e.thread_id=e.client_thread_id,this.$2.forceSetServerIDToClientID(f,e.client_thread_id),c[f]=e.client_thread_id);e.thread_id||g(0,2152,e.action_type);(!a.payload_source||!a.payload_source.startsWith("server"))&&d(["MercuryServerRequests"],function(a){a.getForFBID(this.$1).updateLastActionTimestamp(e.timestamp)}.bind(this))}.bind(this));this.$5(a);this.$6(a);if(a.end_of_history){k=[];for(var j=0;j<a.end_of_history.length;j++){i=a.end_of_history[j];i.type=="user"?k.push("user:"+i.fbid):i.type=="thread"&&this.$2.hasClientIDForServerID(i.fbid)&&k.push(this.$2.getClientIDFromServerIDNow(i.fbid))}a.end_of_history=k}if(a.roger){var l={};Object.keys(a.roger).forEach(function(c){__p&&__p();var d=Object.keys(a.roger[c]),e;c?e=this.$2.getClientIDFromServerIDNow(c):d.length===1&&(e=b("MercuryIDs").getThreadIDFromUserID(d[0]));if(e){d=a.roger[c];l[e]={};for(var f in d)if(Object.prototype.hasOwnProperty.call(d,f)){c=b("MercuryIDs").getParticipantIDFromUserID(f);l[e][c]=d[f]}}}.bind(this));a.roger=l}a.newlyAddedClientIDs=c;a.preprocessed=!0;this.$3.handleUpdate(a)};a.prototype.$4=function(a,c){var d=a.other_user_fbid?a.other_user_fbid:a.thread_fbid;d||g(0,2153);var e=this.$2.getClientIDFromServerIDNow(d);e||(e=a.other_user_fbid?b("MercuryIDs").getThreadIDFromUserID(a.other_user_fbid):b("MercuryIDs").getThreadIDFromThreadFBID(a.thread_fbid),this.$2.setServerIDToClientID(d,e),this.$2.setDeprecatedServerIDToClientID(a.thread_id,e),c[d]=e);a.thread_id=e};a.prototype.$5=function(a){a.actions.forEach(function(a){a.action_type===b("MercuryActionType").USER_GENERATED_MESSAGE&&(a.attachments=a.attachments||[],a.attachments.forEach(function(a){if(b("MercuryAttachment").isShareAttachment(a)&&a.share&&b("MessengerEnvironment").messengerui){var c=new(b("URI"))(a.share.uri);c.getDomain()||(a.share.uri=c.setDomain("facebook.com").setSubdomain(b("URI").getRequestURI().getSubdomain()).setProtocol("https").toString())}}))})};a.prototype.$6=function(a){__p&&__p();a.actions.forEach(function(a){__p&&__p();if(a.action_type!==b("MercuryActionType").USER_GENERATED_MESSAGE)return;a=a;if(!a.has_attachment||!a.attachments)return;for(var c=a.attachments.length-1;c>=0;c-=1){var d=a.attachments[c];if(!d.share||!d.share.style_list||d.share.style_list[0]!="genie_message")continue;d.share.target.genie_id&&(a.author=b("MercuryIDs").getParticipantIDFromUserID(d.share.target.genie_id));d.share.target&&!d.share.target.attachment&&(a.attachments.splice(c,1),a.has_attachment=a.attachments.length>0)}})};var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryServerSendMessageQueueOptions",[],(function(a,b,c,d,e,f){function a(a,b,c,d,e,f){"use strict";this.success_handler=a,this.error_handler=b,this.transport_error_handler=c,this.timeout_handler=d,this.timeout=e,this.connection_retries=f}e.exports=a}),null);
__d("MercurySyncConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({ARBITER_EVENT_INVALID_STATE:"SYNC:INVALID_STATE",ARBITER_EVENT_INVALID_STATE_RETRY:"SYNC:INVALID_STATE_RETRY",ARBITER_EVENT_INVALID_STATE_RECOVER:"SYNC:INVALID_STATE_RECOVER",ARBITER_EVENT_SERVER_REQUESTS_FAIL:"NET:SERVER_REQUESTS_FAIL",ARBITER_EVENT_SERVER_REQUESTS_RECOVER:"NET:SERVER_REQUESTS_RECOVER"});e.exports=a}),null);
__d("MercurySyncDeltaHolder",["MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$2=new Map(),this.$3=[],this.$1=0}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.peek=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3[0]};a.prototype.getTop=function(){this.$3=this.$3.sort(function(a,b){return a-b});return this.$3.reverse()[0]};a.prototype.pop=function(){this.$3=this.$3.sort(function(a,b){return a-b});if(this.$3.length===0)return undefined;var a=this.$3.shift(),b=this.$2.get(a);this.$2["delete"](a);return{seqID:a,delta:b}};a.prototype.push=function(a,b){if(this.$2.has(a))return;this.$2.set(a,b);this.$3.push(a)};a.prototype.getLastSeqID=function(){return this.$1};a.prototype.updateLastSeqID=function(a){this.$1=a};a.prototype.updateLastSeqIDAndClearHistory=function(a){this.$2=new Map(),this.$3=[],this.$1=a};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryServerRequests",["errorCode","invariant","Promise","Arbiter","AsyncResponse","BanzaiODS","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","EventProfiler","FBJSON","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryDispatcher","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageIDs.bs","MercuryPayloadSource","MercurySendErrorLogger","MercuryServerDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueOptions","MercuryServerSendMessageQueueRouter","MercuryServerURIs","MercurySingletonProvider","MercurySourceType","MercurySyncConstants","MercurySyncDeltaHolder","MercuryThreadIDMap","MessagingConfig","MessagingTag","XMercuryUnseenThreadIDsController","XMessagingChangeMentionsMuteModeController","XMessagingChangeReactionsMuteModeController","createObjectFrom","gkx","promiseDone","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("LogHistory").getInstance("mercury_server"),j=b("MercuryAPIArgsSource").MERCURY,k=30*1e3,l=!0;function m(a){return a.getError()?"_"+a.getError():""}function n(a,c){__p&&__p();var d=babelHelpers["extends"]({},a),e;if(c.threads){d.threads||(d.threads={});for(e in c.threads)d.threads[e]=Object.keys(b("createObjectFrom")((d.threads[e]||[]).concat(c.threads[e]||[])))}if(c.messages){d.messages||(d.messages={});for(e in c.messages){d.messages[e]||(d.messages[e]={});for(var f in c.messages[e])d.messages[e][f]?d.messages[e][f]=r(d.messages[e][f],c.messages[e][f]):d.messages[e][f]=c.messages[e][f]}}d.client=a.client||c.client;return d}function o(a,c){var d=Object.assign(b("createObjectFrom")(a.folders,!0),b("createObjectFrom")(c.folders,!0));a=a.client||c.client;return{folders:Object.keys(d),client:a}}function p(a,b){for(var c in b)if(a[c]&&typeof a[c]==="object")a[c]=r(a[c],b[c]);else if(b[c]&&typeof b[c]==="object"){var d={};Object.assign(d,b[c]);a[c]=d}return a}function q(a,b){return b}function r(a,b){var c=Math.max(a.limit,b.limit),d;!a.timestamp?d=b.timestamp:!b.timestamp?d=a.timestamp:d=Math.min(a.timestamp,b.timestamp);return{limit:c,timestamp:d}}function s(a,b){var c=a.client||b.client;c={ids:{},client:c};Object.assign(c.ids,a.ids,b.ids);return c}function t(a,c){__p&&__p();var d={},e,f=a.client||c.client;delete a.client;delete c.client;for(e in a)Object.assign(d,b("createObjectFrom")(a[e],e));for(e in c)Object.assign(d,b("createObjectFrom")(c[e],e));a={client:f};for(var g in d)e=d[g],a[e]||(a[e]=[]),a[e].push(g);return a}function u(a,c){var d=a.client||c.client;a=b("createObjectFrom")(a.ids,!0);c=b("createObjectFrom")(c.ids,!0);a=Object.assign(a,c);return{ids:Object.keys(a),client:d}}function v(a){this.$1=a,this.$2=0,this.$3={},this.$4={},this.$9=new Set(),this.__threadIDMap=b("MercuryThreadIDMap").getForFBID(this.$1),this.$5=b("MercuryDispatcher").getForFBID(this.$1),this.$6=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.$7=new(b("MercuryServerSendMessageQueueOptions"))(function(a,b){this.__handleUpdate(a,b)}.bind(this),function(a){return this.$10(a)}.bind(this),function(a){this.$11(a)}.bind(this),function(a){return this.$12(a)}.bind(this),b("MercuryServerRequestsConfig").sendMessageTimeout,b("MessagingConfig").SEND_CONNECTION_RETRIES),this.$8=b("MercurySyncDeltaHolder").getForFBID(this.$1),this.$13()}v.getForFBID=function(a){return w.getForFBID(a)};v.get=function(){return w.get()};v.prototype.fetchThreadlistInfo=function(a,c,d,e,f,g){d===void 0&&(d=b("MessagingTag").INBOX);f===void 0&&(f=j);l&&(l=!1,b("EventProfiler").tagCurrentActiveInteractionsAs("FirstMercuryThreadFetch"));var h=e?b("MercuryServerDispatcher").IMMEDIATE:null;f={client:f};f[d]={offset:a,limit:c,filter:e,before:g};this.__sendRequest(b("MercuryServerURIs").THREADLIST_INFO,f,h)};v.prototype.fetchPinnedThreadlistInfo=function(){var a={};a.onlyPinnedThreads=!0;this.__sendRequest(b("MercuryServerURIs").THREADLIST_INFO,a,null)};v.prototype.fetchUnseenThreadIDs=function(a,c){a===void 0&&b("MessagingTag").INBOX,c===void 0&&(c=j),this.__sendRequest(b("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString(),{})};v.prototype.fetchUnreadThreadIDs=function(a,c){c===void 0&&(c=j),this.__sendRequest(b("MercuryServerURIs").UNREAD_THREADS,{folders:[a],client:c})};v.prototype.fetchThreadData=function(a,c){__p&&__p();c===void 0&&(c=j);b("MercuryAssert").allThreadID(a);var d={threads:{},client:c},e=[],f=[];a.forEach(function(a){__p&&__p();if(this.$3[a])return;this.$3[a]=!0;var c=this.__threadIDMap.getServerIDFromClientIDNow(a);a=b("MercuryIDs").tokenize(a);if(a.type=="user")e.push(a.value),d.threads.user_ids=e;else if(a.type=="thread")c?f.push(c):f.push(a.value),d.threads.thread_fbids=f;else if(a.type=="root")c&&(f.push(c),d.threads.thread_fbids=f);else if(a.type!="pending")throw new Error("Unknown thread type",a)}.bind(this));this.$5.inform("fetch-thread-data",d);d.threads.user_ids&&d.threads.user_ids.forEach(function(a){a||(i.error("empty user id",JSON.stringify(e)),b("ChatReliabilityInstrumentation").logERROR("Invalid user ID sent to thread_info.php: "+JSON.stringify(e)))});d.threads.thread_fbids&&d.threads.thread_fbids.forEach(function(c){c||b("ChatReliabilityInstrumentation").logERROR("Invalid FBID sent to thread_info.php: "+JSON.stringify(a))});for(var g in d.threads){this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,d);break}};v.prototype.ensureThreadIsFetched=function(a,c){__p&&__p();c===void 0&&(c=j);if(!this.__threadIDMap.getClientIDFromServerIDNow(a)&&!this.$3[a]){if(!a){b("ChatReliabilityInstrumentation").logERROR("Ensure invalid FBID sent to thread_info.php");i.error("attempting to fetch empty thread_fbid. Bad idea!");return}this.$3[a]=!0;this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,{threads:{thread_fbids:[a]},client:c})}};v.prototype.fetchThreadMessages=function(a,c,d,e,f,g){__p&&__p();g===void 0&&(g=j);b("MercuryAssert").isThreadID(a);var h;c=b("MercuryIDs").tokenize(a);var i=this.__threadIDMap.getServerIDFromClientIDNow(a),k=!1;if(i)i=i,h=c.type=="user"?"user_ids":"thread_fbids";else{i=c.value;switch(c.type){case"user":h="user_ids";k=!0;break;case"thread":h="thread_fbids";break}}var l={messages:{},threads:{},client:g};h?(l.messages[h]={},l.messages[h][i]={timestamp:e,limit:d},k&&(l.threads[h]=[i]),this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,l,f)):this.__threadIDMap.getServerIDFromClientID(a,function(a){l.messages.thread_fbids={},l.messages.thread_fbids[a]={timestamp:e,limit:d},this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,l,f)}.bind(this))};v.prototype.handleThreadInfoError=function(a,c){__p&&__p();var d=a.getData();a=[];if(d.messages){for(var e in d.messages.thread_fbids){var f=this.__threadIDMap.getClientIDFromServerIDNow(e);f&&a.push(this.$14(f))}for(var g in d.messages.user_ids)a.push(this.$14("user:"+g));for(var h in d.messages.group_ids)a.push(this.$14("group:"+h))}a.length&&this.$5.handleUpdate({actions:a,from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});if(d.threads&&(d.threads.user_ids||d.threads.thread_fbids||d.threads.group_ids||d.threads.thread_ids)){f=5;a=!0;!d.retry_count?(d.retry_count=0,d.messages&&delete d.messages):d.retry_count>=f&&(!c||!b("gkx")("678666"))&&(a=!1,(d.threads.thread_ids||[]).concat(d.threads.thread_fbids||[]).forEach(function(a){a in this.$3&&delete this.$3[a]},this));[].concat(d.threads.thread_ids||[],d.threads.thread_fbids||[],d.threads.user_ids||[],d.threads.group_ids||[]).forEach(function(a){a?this.$9.add(a):b("ChatReliabilityInstrumentation").logERROR("lost a thread id somehow")}.bind(this));if(a){c=Math.pow(2,Math.min(d.retry_count,f))*1e3;b("setTimeoutAcrossTransitions")(function(){i.log("retry_thread","{}"),this.__sendRequest(b("MercuryServerURIs").THREAD_INFO,d)}.bind(this),c);d.retry_count++}if(this.$9.size){var j=[];this.$9.forEach(function(a){return j.push(a)});i.debug("failed threads",JSON.stringify(j));b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_FAIL,j)}}};v.prototype.markFolderAsRead=function(a){this.__sendRequest(b("MercuryServerURIs").MARK_FOLDER_READ,{folder:a});a=[{action_type:b("MercuryGlobalActionType").MARK_ALL_READ,folder:a}];this.$5.handleUpdate({global_actions:a,from_client:!0,payload_source:b("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS})};v.prototype.changeThreadReadStatus=function(a,c,d,e,f,g){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(h){var j;j={ids:(j={},j[h]=c,j),source:d,watermarkTimestamp:e,shouldSendReadReceipt:f,commerce_last_message_type:g};i.log("initiate_change_read_status",JSON.stringify({thread_id:a,thread_fbid:h,mark_as_read:c,watermarkTimestamp:e}));this.__sendRequest(b("MercuryServerURIs").CHANGE_READ_STATUS,j)}.bind(this))};v.prototype.changeThreadArchivedStatus=function(a,c,d){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){var e={ids:{},source:d};e.ids[a]=c;this.__sendRequest(b("MercuryServerURIs").CHANGE_ARCHIVED_STATUS,e)}.bind(this))};v.prototype.changeThreadPinnedStatus=function(a,c,d){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){var e={ids:{},source:d};e.ids[a]=c;this.__sendRequest(b("MercuryServerURIs").CHANGE_PINNED_STATUS,e)}.bind(this))};v.prototype.changeThreadPageFollowUpStatus=function(a,c,d){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){var e={ids:{},source:d};e.ids[a]=c;this.__sendRequest(b("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS,e)}.bind(this))};v.prototype.changeThreadFolder=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){var d={};d[c]=[a];this.__sendRequest(b("MercuryServerURIs").MOVE_THREAD,d)}.bind(this))};v.prototype.changeMutingOnThread=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){this.__sendRequest(b("MercuryServerURIs").CHANGE_MUTE_THREAD,{thread_fbid:a,mute_settings:c,payload_source:j})}.bind(this))};v.prototype.changeMentionsMutingOnThread=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){this.__sendRequest(b("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,mentions_mute_mode:c,payload_source:j})}.bind(this))};v.prototype.changeReactionsMutingOnThread=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){this.__sendRequest(b("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:a,reactions_mute_mode:c,payload_source:j})}.bind(this))};v.prototype.markThreadSpam=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){this.__sendRequest(b("MercuryServerURIs").MARK_SPAM,{id:a,source:c})}.bind(this))};v.prototype.unmarkThreadSpam=function(a,c){b("MercuryAssert").isThreadID(a),this.__threadIDMap.getServerIDFromClientID(a,function(a){this.__sendRequest(b("MercuryServerURIs").UNMARK_SPAM,{id:a,source:c})}.bind(this))};v.prototype.deleteThread=function(a,b){this.deleteThreads([a],b)};v.prototype.deleteThreads=function(a,c){b("promiseDone")(b("Promise").all(a.map(function(a){b("MercuryAssert").isThreadID(a);return new(b("Promise"))(function(b){return this.__threadIDMap.getServerIDFromClientID(a,b)}.bind(this))}.bind(this))).then(function(a){this.__sendRequest(b("MercuryServerURIs").DELETE_THREAD,{ids:a,source:c})}.bind(this)))};v.prototype.deleteMessages=function(a,c){b("MercuryMessageIDs.bs").getServerIDs(c||[],function(a){this.__sendRequest(b("MercuryServerURIs").DELETE_MESSAGES,{message_ids:a})}.bind(this))};v.prototype.sendDeliveryReceipts=function(a,c){b("MercuryMessageIDs.bs").getServerIDs(a||[],function(a){this.__sendRequest(b("MercuryServerURIs").DELIVERY_RECEIPTS,{message_ids:a,thread_ids:c})}.bind(this))};v.prototype.sendNewMessage=function(a,c){c===void 0&&(c=j);a.offline_threading_id||b("BanzaiODS").bumpEntityKey("chat.web","missing_otid_on_send");if(a.client_state&&a.client_state!==b("MercuryMessageClientState").SEND_TO_SERVER)return;var d=b("MercuryIDs").tokenize(a.thread_id),e=d.type,f=babelHelpers["extends"]({},a);f.thread_id=null;e=="user"?(f.other_user_fbid=d.value,this.$15(f,c)):e=="thread"?(f.thread_fbid=d.value,this.$15(f,c)):e=="root"&&d.value==f.offline_threading_id?(f.client_thread_id=a.thread_id,this.$15(f,c)):(b("MercuryIDs").isLocalThread(a.thread_id)||h(0,5587,a.thread_id),this.__threadIDMap.getServerIDFromClientID(a.thread_id,function(a){f.thread_fbid=a,this.$15(f,c)}.bind(this)));b("ChatReliabilityInstrumentation").logMESSAGE_SEND_START(b("FBJSON").stringify({otid:f.offline_threading_id,message_id:f.message_id,other_user_fbid:f.other_user_fbid,viewer_page_fbid:f.creator_info?f.creator_info.pageID:null}))};v.prototype.$15=function(a,c){b("Arbiter").inform(b("ChannelConstants").ATTEMPT_RECONNECT),this.$4[a.message_id]=Date.now(),b("MercuryServerSendMessageQueueRouter").getForFBID(this.$1).enqueue(a.other_user_fbid||a.thread_fbid||a.client_thread_id,this.$7,c,a)};v.prototype.__getSendMessageQueueOptions=function(){return this.$7};v.prototype.markSeen=function(){var a=this.$2;this.__sendRequest(b("MercuryServerURIs").MARK_SEEN,{seen_timestamp:a})};v.prototype.$16=function(a,c,d,e){__p&&__p();a=a.getData();a=a.message_batch||[a];i.debug("handle_send_message_error_common",JSON.stringify({reliability_error_status:d,request_error_status:c,error_data:e,message_list:a}));d=a.map(function(a){a={action_type:b("MercuryActionType").SEND_MESSAGE,other_user_fbid:a.other_user_fbid,thread_fbid:a.thread_fbid,client_message_id:a.message_id,message_id:a.message_id,client_thread_id:a.client_thread_id,status:c,error_data:e};return a});d.forEach(function(a){a.action_type===b("MercuryActionType").SEND_MESSAGE&&a.status===b("MercuryActionStatus").ERROR&&this.__logMercurySendError(a)},this);a={actions:d,payload_source:b("MercuryPayloadSource").CLIENT_HANDLE_ERROR};this.$6.handleUpdate(a)};v.prototype.handleSendMessageError=function(a){var c=a.getPayload(),d=null,e=null;c&&c.error_payload?(d=b("MercuryActionStatus").UNCONFIRMED,e="send_error"):(d=b("MercuryActionStatus").ERROR,e="request_error"+m(a));c=a.error;c===1404102&&b("AsyncResponse").verboseErrorHandler(a);c=/<.*>/.test(a.getErrorDescription())?a.getErrorSummary():a.getErrorDescription();this.$16(a.getRequest(),d,e,{type:b("MercuryErrorType").SERVER,code:a.getError(),description:c,is_transient:a.isTransient()})};v.prototype.handleSendMessageTransportError=function(a){this.$16(a.getRequest(),b("MercuryActionStatus").ERROR,"transport_error"+m(a),{type:b("MercuryErrorType").TRANSPORT,code:a.getError(),is_transient:!0})};v.prototype.handleSendMessageTimeout=function(a){this.$16(a,b("MercuryActionStatus").ERROR,"transport_timeout",{type:b("MercuryErrorType").TIMEOUT,is_transient:!0})};v.prototype.getLastActionTimestamp=function(){return this.$2};v.prototype.__logMercurySendError=function(a){b("MercurySendErrorLogger").log(a)};v.prototype.updateLastActionTimestamp=function(a){var b=Date.now()-1e3*60*60*24;a&&a>b&&(this.$2=Math.max(this.$2,a))};v.prototype.markThreadFetched=function(a){delete this.$3[a],this.$9["delete"](a)&&!this.$9.size&&(i.debug("no_failed_threads","{}"),b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_RECOVER))};v.prototype.$14=function(a){return{action_type:b("MercuryActionType").LOG_MESSAGE,thread_id:a,message_id:a,timestamp:Date.now(),is_unread:!1,source:b("MercurySourceType").UNKNOWN,log_message_body:"",log_message_type:b("MercuryLogMessageType").SERVER_ERROR,log_message_data:{}}};v.prototype.__getForAsyncRequest=function(a){a=a.getData();a=a.request_user_id?a.request_user_id:b("CurrentUser").getID();return v.getForFBID(a)};v.prototype.__handleUpdate=function(a,b){this.__getForAsyncRequest(b).$6.handleUpdate(a)};v.prototype.$17=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a)};v.prototype.$18=function(a){var b=this.__getForAsyncRequest(a);b.handleThreadInfoError(a,!0)};v.prototype.$10=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageError(a)};v.prototype.$11=function(a){var b=this.__getForAsyncRequest(a.getRequest());b.handleSendMessageTransportError(a)};v.prototype.$12=function(a){var b=this.__getForAsyncRequest(a);b.handleSendMessageTimeout(a)};v.prototype.$13=function(){__p&&__p();var a,c=null;b("MercuryServerRequestsConfig").msgrRegion&&(c={name:"X-MSGR-Region",value:b("MercuryServerRequestsConfig").msgrRegion});a=(a={},a[b("MercuryServerURIs").THREAD_INFO]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,customHeader:c,batch_function:n,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this),error_handler:function(a){return this.$17(a.getRequest())}.bind(this),timeout_handler:function(a){return this.$18(a)}.bind(this),timeout:k},a[b("MercuryServerURIs").MARK_FOLDER_READ]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").CHANGE_READ_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){this.__handleUpdate(a,b);b=(a.threads||[]).map(function(a){return a&&a.thread_id});i.log("response_change_read_status",JSON.stringify({threads:b}))}.bind(this)},a[b("MercuryServerURIs").MARK_SEEN]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:q,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").THREADLIST_INFO]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:c,batch_function:p,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").MARK_SPAM]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").UNMARK_SPAM]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").UNREAD_THREADS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:c,batch_function:o,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").CHANGE_ARCHIVED_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:s,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").CHANGE_PINNED_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:s,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:s,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").DELETE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:u,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").DELETE_MESSAGES]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").DELIVERY_RECEIPTS]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").MOVE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:c,batch_function:t,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a[b("MercuryServerURIs").CHANGE_MUTE_THREAD]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)},a);var d=b("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString();a[d]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)};d=b("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI().toString();a[d]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)};d=b("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI().toString();a[d]={request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:c,handler:function(a,b){return this.__handleUpdate(a,b)}.bind(this)};b("MercuryServerDispatcher").registerEndpoints(a)};v.prototype.__sendRequest=function(a,c,d){if(this.$8)switch(a){case b("MercuryServerURIs").THREADLIST_INFO:case b("MercuryServerURIs").THREAD_INFO:c.cachius_min_seq_id=this.$8.getLastSeqID();break;default:break}b("MercuryServerDispatcher").trySend(a,c,d,this.$1)};v.prototype.__getFBID=function(){return this.$1};var w=new(b("MercurySingletonProvider"))(v);e.exports=v}),null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=new(b("KeyedCallbackManager"))(),this.$3=new(b("KeyedCallbackManager"))()}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.setServerIDToClientID=function(a,b){var c=this.getClientIDFromServerIDNow(a);if(c){c!==b;return}this.forceSetServerIDToClientID(a,b)};a.prototype.forceSetServerIDToClientID=function(a,b){this.$2.setResource(a,b),this.$3.setResource(b,a)};a.prototype.setDeprecatedServerIDToClientID=function(a,b){a&&this.$2.setResource(a,b)};a.prototype.getClientIDFromServerIDNow=function(a){return this.$2.getResource(a)};a.prototype.getClientIDFromServerID=function(a,b){this.$2.executeOrEnqueue(a,b),d(["MercuryServerRequests"],function(b){b.getForFBID(this.$1).ensureThreadIsFetched(a)}.bind(this))};a.prototype.getServerIDFromClientIDNow=function(a){return this.$3.getResource(a)};a.prototype.getServerIDFromClientID=function(a,c){b("MercuryAssert").isThreadID(a);var e=this.$3.executeOrEnqueue(a,c);d(["MercuryServerRequests"],function(c){var d=this.$3.getUnavailableResources(e),f=b("MercuryIDs").tokenize(a);d.length&&f.type!="root"&&c.getForFBID(this.$1).fetchThreadData(d)}.bind(this))};a.prototype.hasClientIDForServerID=function(a){return!!this.getClientIDFromServerIDNow(a)};a.prototype.convertThreadIDIfAvailable=function(a){var b=this.getClientIDFromServerIDNow(a);return b||a};a.prototype.canLinkExternally=function(a){b("MercuryAssert").isThreadID(a);var c=b("MercuryIDs").tokenize(a);return c.type=="user"||!!this.getServerIDFromClientIDNow(a)};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryLoggingHelper",[],(function(a,b,c,d,e,f){__p&&__p();function g(a){return Array.from(a).slice(0,6).join("")}a={obfuscateThread:function(a){var b=babelHelpers["extends"]({},a);a&&a.snippet&&a.snippet.length>9&&(b.snippet=g(a.snippet)+"...");return b},obfuscateMessage:function(a){var b=babelHelpers["extends"]({},a);a&&a.body&&a.body.length>9&&(b.body=g(a.body)+"...");return b}};e.exports=a}),null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],(function(a,b,c,d,e,f){var g=9999;a={create:function(a){a=new(b("AsyncRequest"))(this.endpoint_uri).setData({message_batch:[a],client:this.client});var c=new(b("AsyncResponse"))(a,{});Object.assign(c,{error:g,silentError:!1,transientError:!0,request:a});return c}};e.exports=a}),null);
__d("MercuryServerSendMessageQueue",["fbt","BanzaiODS","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryIDs","MercuryLoggingHelper","MercuryServerDispatcher","MercuryServerRequestsConfig","MercuryServerSendMessageQueueSimulatedError","MercurySyncDeltaHandler","MessengerAttachmentTransformerForSend.bs","MessengerObjectAssociationType","MessengerState.bs","Run","XMessagingSendController"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("LogHistory").getInstance("mercury_server_send_message_queue");function a(a,c,d,e){__p&&__p();this.pending_message=null;this.queue=[];this.$6=function(){return this.queue.length||this.pending_message?g._("Vous n\u2019avez pas encore envoy\u00e9 votre message. Voulez-vous quitter sans envoyer\u00a0?"):undefined}.bind(this);this.sender_id=a;this.queue_id=c;this.$2=d.success_handler;this.$1=d.error_handler;this.$4=d.transport_error_handler;this.$3=d.timeout_handler;this.$5=b("MercurySyncDeltaHandler").getForFBID(this.sender_id);this.client=e;b("Run").onBeforeUnload(this.$6,!1);a=null;b("MercuryServerRequestsConfig").msgrRegion&&(a={name:"X-MSGR-Region",value:b("MercuryServerRequestsConfig").msgrRegion});c=this.__getSendURI();c=(e={},e[c]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:b("MercuryServerDispatcher").IMMEDIATE,customHeader:a,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:d.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:d.connection_retries},e);b("MercuryServerDispatcher").registerEndpoints(c)}a.prototype.__getSendURI=function(){return b("XMessagingSendController").getURIBuilder().getURI().toString()};a.prototype.__preparePayload=function(a){__p&&__p();var c;c=(c=a)!=null?(c=c.replied_to_message)!=null?(c=c.message)!=null?c.message_id:c:c:c;var d=null,e=a.client_thread_id;if(b("MercuryIDs").isLocalThread(e)){e=b("MessengerState.bs").getThreadMetaNow(b("CurrentUser").getID(),e);if(e&&e.message_count===1&&e.object_association_type===b("MessengerObjectAssociationType").GENERAL_CHAT){d=(e=e)!=null?(e=e.associated_object)!=null?e.id:e:e}}e=c?b("MessengerState.bs").getServerMessageID(b("CurrentUser").getID(),c):null;return{client:this.client,action_type:a.action_type,app_id:a.app_id,audio_ids:a.audio_ids,body:a.body,client_thread_id:a.client_thread_id,content_attachment:a.content_attachment,ephemeral_ttl_mode:a.ephemeral_ttl_mode,file_ids:a.file_ids,gif_ids:a.gif_ids,has_attachment:a.has_attachment,image_ids:a.image_ids,location_attachment:a.location_attachment,lightweight_action_attachment:a.lightweight_action_attachment,log_message_data:a.log_message_data,log_message_type:a.log_message_type,message_id:a.message_id,message_source_data:a.message_source_data,montage_reply_data:a.montage_reply_data,offline_threading_id:a.offline_threading_id,other_user_fbid:a.other_user_fbid,photo_fbids:a.photo_fbids,shareable_attachment:a.shareable_attachment,signature_id:a.signatureID,source:a.source,specific_to_list:a.specific_to_list,sticker_id:a.sticker_id,tags:a.tags,thread_fbid:a.thread_fbid,timestamp:a.timestamp,ui_push_phase:a.ui_push_phase,video_ids:a.video_ids,platform_xmd:a.platform_xmd,profile_xmd:a.profile_xmd,replied_to_message_id:e,work_synced_group_id:d}};a.prototype.enqueue=function(a){this.queue.push(a),this.$7()};a.prototype.$7=function(){__p&&__p();if(this.pending_message||!this.queue.length){this.pending_message&&this.$8();return}this.pending_message=this.queue.shift();var a=this.__preparePayload(this.pending_message);for(var c in a)(a[c]===undefined||a[c]===null)&&delete a[c];if(!a.action_type){var d=b("MercuryLoggingHelper").obfuscateMessage(a);b("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller");h.debug("missing_action_type",JSON.stringify(d))}if(!a.message_id){d=b("MercuryLoggingHelper").obfuscateMessage(a);b("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller"+JSON.stringify(d));h.debug("missing_message_id",JSON.stringify(d))}this.$9();b("MercuryServerDispatcher").trySend(this.__getSendURI(),a,null,this.sender_id,this.queue_id)};a.prototype.$10=function(){while(this.queue.length)this.$11(this.queue.shift())};a.prototype.$11=function(a){this.$1(b("MercuryServerSendMessageQueueSimulatedError").create(a)),h.error("mark_as_failed",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:b("MercuryLoggingHelper").obfuscateMessage(a)}))};a.prototype.handleSuccess=function(a,c){__p&&__p();var d=(a.actions||[]).map(function(a){__p&&__p();var c=babelHelpers["extends"]({},a);if(a.graphql_payload&&a.graphql_payload.length>0){var d=b("MessengerAttachmentTransformerForSend.bs").transform(this.sender_id,a.graphql_payload,a.for_page);c=Object.assign(c,{attachments:d})}d=(d=a)!=null?(d=d.log_message_data)!=null?d.graphql_image:d:d;if(d){d=b("MessengerAttachmentTransformerForSend.bs").transform(this.sender_id,[d],a.for_page);c=Object.assign(c,{log_message_data:{image:d[0]}})}return c}.bind(this));a.actions=d;this.resumeAfterSuccess(a,c)};a.prototype.resumeAfterSuccess=function(a,b){this.$2(a,b),this.$12(),this.pending_message=null,this.$7()};a.prototype.handleError=function(a){this.$12(),this.$1(a),this.$10(),this.pending_message=null};a.prototype.handleTransportError=function(a){this.$12(),this.$4(a),this.$10(),this.pending_message=null};a.prototype.handleTimeout=function(a){this.$12(),this.$3(a),this.$10(),this.pending_message=null};a.prototype.$9=function(){this.$5.pause()};a.prototype.$12=function(){this.$5.resume()};a.prototype.$8=function(){h.debug("maybe_send_next_pending_message",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:b("MercuryLoggingHelper").obfuscateMessage(this.pending_message),queue:this.queue.map(function(a){return b("MercuryLoggingHelper").obfuscateMessage(a)})}));var a="send_queue.delayed.queue_length."+this.queue.length.toString();b("BanzaiODS").bumpEntityKey("chat.web",a)};e.exports=a}),null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","MercuryServerSendMessageQueue","MercurySingletonMixin"],(function(a,b,c,d,e,f){__p&&__p();var g=b("LogHistory").getInstance("mercury_server_send_message_queue_router"),h="chat.web.send_queue_router";b("BanzaiODS").setEntitySample(h,.1);function a(a){"use strict";this.queues=new Map(),this.fbid=a}a.prototype.enqueue=function(a,c,d,e){"use strict";var f=this.queues.get(a);f===undefined&&(f=new(b("MercuryServerSendMessageQueue"))(this.fbid,a,c,d),this.queues.set(a,f),g.debug("added queue",JSON.stringify({fbid:this.fbid,queue_id:a})),b("BanzaiODS").bumpEntityKey(h,"new_queue"));f.enqueue(e)};Object.assign(a,b("MercurySingletonMixin"));e.exports=a}),null);
__d("MercurySyncDataFetcherImpl",["invariant","Promise","AsyncResponse","Bootloader","CurrentUser","FBIDCheck","MercuryConfig","MercuryPayloadSource","MercuryThreadlistConstants","MessagingConfig","QE2Logger","UserActivity","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=null,i=null,j=null,k={limit:b("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1,folder:"inbox",tags:["INBOX"],timestamp:null,filter:null,includeDeliveryReceipts:!1,includeSeqID:!0},l={};function a(a){return new(b("Promise"))(function(b,c){m(a,b,c,0)})}function m(a,c,d,e){__p&&__p();if(!b("CurrentUser").isLoggedInNow()||e>b("MessagingConfig").syncFetchRetries){b("clearTimeout")(l[a]);d();return}var f=e===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,e);b("UserActivity").isOnTab()||(b("QE2Logger").logExposureForUser("mercury_dff_fetch_delay",a),f+=b("MercuryConfig").DFFD*Math.random());b("clearTimeout")(l[a]);l[a]=b("setTimeoutAcrossTransitions")(function(){__p&&__p();var f=!1,n=function(h){__p&&__p();if(f)return;if(h.errors&&h.errors.length>0){var k=h.errors[0].message;if(k){var l=function(){j&&i||g(0,3650),new j().setErrorMessage(k).setEvent(i.DFF_FAILURE).setQueryParams(a).log()};j&&i?l():b("Bootloader").loadModules(["MessengerWebGraphQLTypedLogger","MessengerWebGraphQLEvent"],function(a,b){j=a,i=b,l()},"MercurySyncDataFetcherImpl")}}f=!0;m(a,c,d,e+1)},o=function(){if(!b("CurrentUser").isLoggedInNow())return;h||g(0,3651);h.fetchAll(a,[k],!b("FBIDCheck").isUser_deprecated(a),"dff").then(function(d){f=!0,c(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},d,{payload_source:b("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE}))),b("clearTimeout")(l[a])},n)};h?o():b("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs"],function(a){h=a,o()},"MercurySyncDataFetcherImpl")},f)}function c(a,c,d){return new(b("Promise"))(function(b,e){n(a,c,d,b,e,0)})}function n(a,c,d,e,f,g){__p&&__p();if(g>b("MessagingConfig").syncFetchRetries){f();return}var h=g===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,g);b("setTimeoutAcrossTransitions")(function(){var h=!1,i=function(b){if(h)return;h=!0;n(a,c,d,e,f,g+1)};b("Bootloader").loadModules(["MessengerThreadDFFFetcher.bs"],function(f){return f.fetch(a,{id:c,limit:d},!b("FBIDCheck").isUser_deprecated(a)).then(function(a){h=!0,e(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},a,{payload_source:b("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE})))},i)},"MercurySyncDataFetcherImpl")},h)}function d(a,c,d){return new(b("Promise"))(function(b,e){o(a,c,d,b,e,0)})}function o(a,c,d,e,f,g){__p&&__p();if(g>b("MessagingConfig").syncFetchRetries){f();return}var h=g===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,g);b("setTimeoutAcrossTransitions")(function(){var h=!1,i=function(b){if(h)return;h=!0;o(a,c,d,e,f,g+1)};b("Bootloader").loadModules(["MessengerMessageDFFFetcher.bs"],function(f){return f.fetch(a,{thread_id:c,message_id:d},!b("FBIDCheck").isUser_deprecated(a)).then(function(a){h=!0,e(new(b("AsyncResponse"))(null,babelHelpers["extends"]({},a)))},i)},"MercurySyncDataFetcherImpl")},h)}e.exports={fetchThreadlistFromGraphQL:a,fetchThreadFromGraphQL:c,fetchMessageFromGraphQL:d}}),null);
__d("MercurySyncDataFetcher",["Promise","LogHistory","MercurySyncDataFetcherImpl","MessagingConfig","WebGraphQLConfig","clearTimeout","promiseDone","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("LogHistory").getInstance("mercury_sync_data_fetcher");function a(){var a=0;for(var c=0;c<b("MessagingConfig").syncFetchRetries;c++){var d=c===0?0:b("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(b("MessagingConfig").syncFetchTimeoutMultiplier,c);a+=d+b("MessagingConfig").syncFetchRequestTimeoutMs}return a}var h=a();function c(a){var c=null;return new(b("Promise"))(function(d,e){var f=function(a){g.error("fetch_threadlist_graphql_timeout",JSON.stringify({timeout:h})),b("clearTimeout")(c),e(a)};c=b("setTimeoutAcrossTransitions")(f,Math.max(h,b("WebGraphQLConfig").timeout*b("MessagingConfig").syncFetchRetries));b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchThreadlistFromGraphQL(a),function(a){b("clearTimeout")(c),d(a)},f)})}function d(a,c,d){return new(b("Promise"))(function(e,f){var i=function(a){g.error("fetch_thread_graphql_timeout",JSON.stringify({timeout:h})),f(a)},j=b("setTimeoutAcrossTransitions")(i,h);b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchThreadFromGraphQL(a,c,d),function(a){b("clearTimeout")(j),e(a)},i)})}function f(a,c,d){return new(b("Promise"))(function(e,f){var i=function(a){g.error("fetch_message_graphql_timeout",JSON.stringify({timeout:h})),f(a)},j=b("setTimeoutAcrossTransitions")(i,h);b("promiseDone")(b("MercurySyncDataFetcherImpl").fetchMessageFromGraphQL(a,c,d),function(a){b("clearTimeout")(j),e(a)},i)})}e.exports={fetchThreadlistFromGraphQL:c,fetchThreadFromGraphQL:d,fetchMessageFromGraphQL:f,getMaxTimeoutMs:a}}),null);
__d("MercurySyncDFFDataFetcher",["Promise","CurrentUser","MercurySingletonProvider","MercurySyncDataFetcher","MercuryThreadIDMap","MessengerState.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=a,this.__threadIDMap=b("MercuryThreadIDMap").getForFBID(this.$1)}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.fetchInvalidateGlobalStateForGraphQL=function(){return this.$1&&this.$1!=="0"&&b("CurrentUser").isLoggedIn()?b("MercurySyncDataFetcher").fetchThreadlistFromGraphQL(this.$1):new(b("Promise"))(function(a,b){return b(!0)})};a.prototype.fetchInvalidateThreadState=function(a,c){var d=11,e=3;a=a||c;c=this.__threadIDMap.getClientIDFromServerIDNow(a);if(!c)return b("Promise").resolve({getPayload:function(){return{}}});e=e+b("MessengerState.bs").getCurrentlyLoadedMessages(this.$1,c).length;return!a?b("Promise").resolve({getPayload:function(){return{}}}):b("MercurySyncDataFetcher").fetchThreadFromGraphQL(this.$1,a,Math.max(e,d))};a.prototype.fetchInvalidateMessage=function(a,c,d){a=a||c;return!a?b("Promise").resolve({getPayload:function(){return{}}}):b("MercurySyncDataFetcher").fetchMessageFromGraphQL(this.$1,a,d)};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncFakeDFFSender",["Arbiter","ChannelConstants","LogHistory","MercurySingletonProvider","MercurySyncDeltaTypes"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ChannelConstants").getArbiterType(b("ChannelConstants").FAKE_DFF),h=b("LogHistory").getInstance("dff_sender");a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};function a(a){this.$1=a}a.prototype.sendGlobalDFF=function(){h.debug("sendGlobalDFF",JSON.stringify({fbid:this.$1})),b("Arbiter").inform(g,{obj:{delta:{"class":b("MercurySyncDeltaTypes").ForcedFetch},queue:this.$1}})};a.prototype.sendThreadDFF=function(a,c){h.debug("sendThreadDFF",JSON.stringify({fbid:this.$1,otherUserFBID:a,threadFBID:c})),b("Arbiter").inform(g,{obj:{delta:{"class":b("MercurySyncDeltaTypes").ForcedFetch,threadKey:{otherUserFbId:a,threadFbId:c}},queue:this.$1}})};a.prototype.sendMessageDFF=function(a,c,d){h.debug("sendMessageDFF",JSON.stringify({fbid:this.$1,otherUserFBID:a,threadFBID:c,messageID:d})),b("Arbiter").inform(g,{obj:{delta:{"class":b("MercurySyncDeltaTypes").ForcedFetch,threadKey:{otherUserFbId:a,threadFbId:c},messageId:d},queue:this.$1}})};var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncChannelMonitor",["Arbiter","ChannelConstants","CurrentUser","MercurySingletonProvider","MercurySyncFakeDFFSender","MessengerMQTTGating"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.handleAwfulChannelEvent=function(){if(!b("CurrentUser").isLoggedInNow()){this.killSubscriptions();return}b("MercurySyncFakeDFFSender").getForFBID(this.$1).sendGlobalDFF()}.bind(this),this.$1=a,this.$2=!1}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.setupSubscriptions=function(){if(b("MessengerMQTTGating").isEnabled())return;this.$2||(this.$4=b("Arbiter").subscribe(b("ChannelConstants").JUMPSTART,this.handleAwfulChannelEvent),this.$3=b("Arbiter").subscribe(b("ChannelConstants").THROTTLED,this.handleAwfulChannelEvent),this.$2=!0)};a.prototype.killSubscriptions=function(){this.$2&&(b("Arbiter").unsubscribe(this.$4),b("Arbiter").unsubscribe(this.$3),this.$2=!1)};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncDeltaHandler",["invariant","Arbiter","Bootloader","ChatReliabilityInstrumentation","CurrentUser","LogHistory","MercuryDelayedDispatcher","MercuryPayloadSource","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MercurySyncChannelMonitor","MercurySyncConstants","MercurySyncDeltaHolder","MercurySyncDeltaTypes","MercurySyncDispatcher","MercurySyncEventsProxy","MercurySyncForcedFetchHandler","MercurySyncHolesTypedLogger","MercurySyncTopicType","gkx","onAfterLoadSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("LogHistory").getInstance("mercury_sync_delta_handler");a.getForFBID=function(a){return i.getForFBID(a)};a.get=function(){return i.get()};function a(a){__p&&__p();this.$1=a,this.$2=b("MercurySyncDispatcher").getForFBID(this.$1),this.$3=b("MercurySyncForcedFetchHandler").getForFBID(this.$1),this.__payloadPreprocessor=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.__delayedDispatcher=b("MercuryDelayedDispatcher").getForFBID(this.$1),this.$4=b("MercurySyncDeltaHolder").getForFBID(this.$1),this.$5=0,this.$11=b("MercurySyncChannelMonitor").getForFBID(this.$1),this.$6=[],this.$14=b("MercurySyncEventsProxy").getForFBID(this.$1),h.debug("constructor",JSON.stringify({fbid:this.$1})),b("Arbiter").subscribe(b("MercurySyncEventsProxy").Events.INIT,function(a,c){__p&&__p();h.debug("initSeqID",JSON.stringify(c));a=c&&c.seqID;c=c&&c.fbid;if(!c)return;if(c!==this.$1)return;a?this.$4.updateLastSeqID(a):this.$4.updateLastSeqID(0);this.$16();this.$15=b("Arbiter").subscribe("messenger-mqtt-drop-down-to-channel",function(){this.$17(!0),this.$8&&b("Arbiter").unsubscribe(this.$8),this.$18(),this.$16()}.bind(this));b("gkx")("678667")&&b("onAfterLoadSafe")(function(){b("Bootloader").loadModules(["MessengerSyncSeqIDSanityCheck"],function(a){a.getForFBID(this.$1).init()}.bind(this),"MercurySyncDeltaHandler")}.bind(this))}.bind(this))}a.prototype.$18=function(){this.$8=b("Arbiter").subscribe(this.$14.getArbiterType(b("MercurySyncEventsProxy").Events.FLOW),function(a,b){this.$13||this.$16()}.bind(this))};a.prototype.$16=function(){__p&&__p();h.debug("setUpSubscriptionsToRealTimeUpdates",JSON.stringify({fbid:this.$1})),this.$7=b("Arbiter").subscribe(this.$14.getArbiterType(b("MercurySyncEventsProxy").Events.DELTA),function(a,c){__p&&__p();a=c&&c.obj&&c.obj.queue;if(a&&a.toString()!==this.$1)return;a=c&&c.obj&&c.obj.delta;c=c&&c.obj&&c.obj.iseq;if(!a||!c)return;this.$19(c,b("MercurySyncTopicType").DELTA);this.$20(c,a);this.$4.push(c,a);this.$21()}.bind(this)),this.$12=b("Arbiter").subscribe(this.$14.getArbiterType(b("MercurySyncEventsProxy").Events.FLOW_REJECT),function(a,b){a=b&&b.obj&&b.obj.queue;if(a&&a.toString()!==this.$1)return;this.$13&&this.$17()}.bind(this)),this.$9=b("Arbiter").subscribe(this.$14.getArbiterType(b("MercurySyncEventsProxy").Events.FAKE_DFF),function(a,b){__p&&__p();a=b&&b.obj&&b.obj.queue;if(a&&a.toString()!==this.$1)return;a=b&&b.obj&&b.obj.delta;if(!a)return;if(this.$22(a))if(this.$6.some(function(a){return this.$22(a)}.bind(this)))return;else this.$6.push(a);else this.$6.push(a);this.$21()}.bind(this)),this.$11.setupSubscriptions(),this.$13=!0};a.prototype.$22=function(a){return a["class"]===b("MercurySyncDeltaTypes").ForcedFetch&&!a.threadKey&&!a.messageId};a.prototype.$21=function(){__p&&__p();if(this.$5>0)return;if(this.$6.length>0){var a=this.$6.shift();this.$23(this.$4.getLastSeqID(),a);this.$21()}a=this.$4.peek();if(!a)return;a=a-this.$4.getLastSeqID();if(a===1){var b=this.$4.pop();if(!b)return;var c=b.seqID;b=b.delta;this.$23(c,b);this.$21()}else a>1?this.$24():(this.$4.pop(),this.$21())};a.prototype.$23=function(a,c){this.$4.updateLastSeqID(a),c["class"]===b("MercurySyncDeltaTypes").ForcedFetch?(h.debug("DFF",JSON.stringify(c)),c.threadKey!==undefined&&c.messageId===undefined?this.$25(a,c):c.threadKey!==undefined&&c.messageId!==undefined?this.$26(a,c):(b("ChatReliabilityInstrumentation").logDFF_DELTA_INIT(JSON.stringify(c)),this.$27(a))):this.$2.process(c)};a.prototype.$24=function(){var a=JSON.stringify({$28:this.$4.getLastSeqID(),nextSeqID:this.$4.peek()});h.warn("hole",a);var c=this.$4.peek();!c&&g(0,5132);c=c-1;b("ChatReliabilityInstrumentation").logDFF_HOLE_INIT(a);this.$27(c)};a.prototype.$29=function(a,c,d,e){this.$5&&g(0,5134),this.$5++,h.debug("_scheduleDataFetch:start",JSON.stringify({seqID:a})),b("promiseDone")(c(),function(b){h.debug("_scheduleDataFetch:success",JSON.stringify({seqID:a})),this.$5--,d(a,b),this.$21()}.bind(this),function(b){h.error("_scheduleDataFetch:failure",JSON.stringify({seqID:a})),this.$5--,e(a,b),this.$21()}.bind(this))};a.prototype.$27=function(a){if(!b("CurrentUser").isLoggedInNow())return;this.$29(undefined,function(){return this.$3.processGlobalDFFForGraphQL()}.bind(this),function(a,c){a=c.getPayload();this.__payloadPreprocessor.handleUpdate(a);a.sequence_id&&(h.debug("_initiateGlobalDFF:success",JSON.stringify({seqID:a.sequence_id})),b("gkx")("678668")?this.$4.updateLastSeqIDAndClearHistory(a.sequence_id):this.$4.updateLastSeqID(a.sequence_id));b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RECOVER)}.bind(this),function(c,d){h.error("_initiateGlobalDFF:failure",""),d?this.$13&&this.$17():(b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RETRY),h.debug("_initiateGlobalDFF:retry",""),this.$27(a))}.bind(this))};a.prototype.$25=function(a,b){this.$29(a,function(){return this.$3.processThreadDFF(a,b.threadKey,b.isLazy)}.bind(this),function(a,b){this.__payloadPreprocessor.handleUpdate(b.getPayload()),this.$4.updateLastSeqID(a)}.bind(this),function(){h.error("_initiateThreadDFF:failure",JSON.stringify(b));var c=babelHelpers["extends"]({},b);delete c.threadKey;this.$4.updateLastSeqID(a-1);this.$4.push(a,c)}.bind(this))};a.prototype.$26=function(a,c){__p&&__p();this.$29(a,function(){return this.$3.processMessageDFF(a,c.threadKey,c.messageId,c.isLazy)}.bind(this),function(a,c){c=c.getPayload();var d=c.other_user_fbid?c.other_user_fbid:c.thread_fbid;c=[babelHelpers["extends"]({},c)];var e=b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:c,payload_source:e},d);this.$4.updateLastSeqID(a)}.bind(this),function(){h.error("_initiateMessageDFF:failure",JSON.stringify(c));var b=babelHelpers["extends"]({},c);delete b.messageId;this.$4.updateLastSeqID(a-1);this.$4.push(a,b)}.bind(this))};a.prototype.$19=function(a,c){var d=a-this.$4.getLastSeqID();if(d!==1&&d!==0){if(!b("CurrentUser").isEmployee())return;new(b("MercurySyncHolesTypedLogger"))().setSeqID(a).setDifference(d).setTopicType(c).log()}};a.prototype.$20=function(a,c){switch(c["class"]){case b("MercurySyncDeltaTypes").NewMessage:h.debug("message_delta",JSON.stringify({seqID:a,threadKey:c.messageMetadata.threadKey,messageId:c.messageMetadata.messageId}));break;case b("MercurySyncDeltaTypes").ReadReceipt:h.debug("read_receipt_delta",JSON.stringify({seqID:a,threadKey:c.threadKey,actionTimestampMs:c.actionTimestampMs,watermarkTimestampMs:c.watermarkTimestampMs}));break;case b("MercurySyncDeltaTypes").DeliveryReceipt:h.debug("delivery_receipt_delta",JSON.stringify({seqID:a,deliveredWatermarkTimestampMs:c.deliveredWatermarkTimestampMs,messageIds:c.messageIds}));break}};a.prototype.pause=function(){this.$5++};a.prototype.resume=function(){this.$5--,this.$21()};a.prototype.$17=function(a){a===void 0&&(a=!1),this.$13=!1,b("Arbiter").unsubscribe(this.$7),b("Arbiter").unsubscribe(this.$9),b("Arbiter").unsubscribe(this.$12),this.$11.killSubscriptions(),a||b("Arbiter").inform(b("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE)};var i=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncNewMessageTransformer",["Bootloader","FBIDCheck","IrisProtocolMessageLifetime","MercuryActionType","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MessageThreadReadStateEffect","MessagingTag","MessengerRealtimeAttachmentTransformer.bs","PageCommItemStatus","PagesCommsInboxTypedLogger"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MessageThreadReadStateEffect").MessageThreadReadStateEffectType,h=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta,i=function(a){var b={};try{b=JSON.parse(a)}catch(a){}return b};function a(a,c){__p&&__p();var d=parseInt(c.messageMetadata.timestamp,10),e=c.messageMetadata.skipBumpThread,f=h(a,c),j=f===g.MARK_UNREAD&&a!==c.messageMetadata.actorFbId.toString(),k=[];c.attachments&&(k=c.attachments.map(function(c){__p&&__p();var d;c.mercury?d=c.mercury:d=i(c.mercuryJSON);if(!d)return null;c=d.extensible_attachment;var e=d.blob_attachment;d=d.sticker_attachment;if(!c&&!e&&!d)return null;var f=b("FBIDCheck").isUser_deprecated(a);[];c?c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{extensible_attachment:c},f):e?c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{blob_attachments:[e]},f):c=b("MessengerRealtimeAttachmentTransformer.bs").transform(a,{sticker:d});return c.length>0?c[0]:null}));var l=!b("FBIDCheck").isUser_deprecated(a);if(l&&c.messageMetadata.actorFbId!=a){var m=b("PagesCommsInboxTypedLogger");b("Bootloader").loadModules(["PagesCommsInboxFunnel","PagesCommsInboxLoggerEvent","PagesCommsInboxLoggerPlatform"],function(b,e,f){new m().setFunnel(b.USER_SEND_TO_PAGE).setCustomerID(c.messageMetadata.threadKey.otherUserFbId).setMessageID(c.messageMetadata.messageId).setEvent(e.CLIENT_RECEIVED_NEW_DELTA).setClientTime(d).setPageID(a).setMessagingPlatform(f.MESSENGER).log()},"MercurySyncNewMessageTransformer")}k=k.filter(Boolean);var n=c.messageMetadata.tags?c.messageMetadata.tags[0]:undefined,o=null;if(c.data&&c.data.adminSignatureCreatorID){var p=c.data;o={creatorID:p.adminSignatureCreatorID||null,creatorName:p.adminSignatureCreatorName||null,creatorType:p.adminSignatureCreatorType||null,labelType:p.adminSignatureLabelType||null,pageID:p.adminSignaturePageID||null,profileURI:p.adminSignatureProfileURI||null}}return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(c.messageMetadata.actorFbId),author_email:c.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:c.ttl?b("IrisProtocolMessageLifetime")[c.ttl]:0,timestamp:d,is_unread:j,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,source:n,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:b("MessagingTag").INBOX,thread_fbid:c.messageMetadata.threadKey.threadFbId,other_user_fbid:c.messageMetadata.threadKey.otherUserFbId,body:c.body!==undefined?c.body:"",html_body:null,subject:null,has_attachment:k.length>0,attachments:k,ranges:undefined,thread_id:null,action_type:b("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:!0,is_sponsored:!!(c.data&&c.data.is_sponsored&&c.data.is_sponsored==="true")||!!(c.untypedData&&c.untypedData.is_sponsored&&c.untypedData.is_sponsored==="true"),commerce_message_type:c.data?c.data.commerce_message_type:null,customizations:c.data&&c.data.customization?b("MercuryMessageCustomizations").parseCustomizations(c.data.customization):null,platform_xmd:c.data&&c.data.platform_xmd?c.data.platform_xmd:null,profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),message_source:c.data&&c.data.message_source_data?i(c.data.message_source_data).message_source:null,skip_bump_thread:e,thread_read_state_effect:f,montage_reply_data:c.data&&c.data.montage_reply_data?i(c.data.montage_reply_data):null,meta_ranges:c.data&&c.data.meta_ranges?i(c.data.meta_ranges):null,creator_info:o,comm_status:l?b("PageCommItemStatus").TODO:null}}e.exports={transform:a}}),null);
__d("MercurySyncAdminTextMessageTransformer",["MercuryActionType","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){a=b("MercurySyncNewMessageTransformer").transform(a,c);a.action_type=b("MercuryActionType").LOG_MESSAGE;a.log_message_body=c.messageMetadata.adminText;a.log_message_data={message_type:c.type,untypedData:c.untypedData};a.log_message_type=b("MercuryLogMessageType").GENERIC_ADMIN_TEXT;return a}e.exports={transform:a}}),null);
__d("MercurySyncClientPayloadTransformer",["invariant","ClientSyncProtocol_GroupsSyncAction","DateConsts","LiveLocationStopReason","MercuryActionType","MercuryIDs","MercuryParticipantTypes","MercurySyncNewMessageTransformer","MessageLiveLocationClientSyncProtocolStopReason","MessengerGroupsSyncStatus","MessengerParticipants.bs","PageCommItemStatus","RepliedToMessageStatusForGraphQL","keyMirror"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("keyMirror")(b("LiveLocationStopReason")),i=8;function a(a,b){__p&&__p();a=a.payload;a=JSON.parse(String.fromCharCode.apply(null,a));a=a&&a.deltas;a=a[0];if(a.deltaMessageReaction)return t(a.deltaMessageReaction);else if(a.liveLocationData)return v(a.liveLocationData);else if(a.deltaUpdateGroupEventRSVPStatus){var c=a.deltaUpdateGroupEventRSVPStatus;return u(c)}else if(a.deltaPageThreadFollowUpData)return z(a.deltaPageThreadFollowUpData);else if(a.deltaChangeViewerStatus)return r(a.deltaChangeViewerStatus,b);else if(a.deltaMontageDirectExpire)return s(a.deltaMontageDirectExpire);else if(a.deltaMessageReply)return o(a.deltaMessageReply,b);else if(a.deltaUpdateGroupsSyncStatus)return p(a.deltaUpdateGroupsSyncStatus);else if(a.deltaUpdateGroupsSyncMetadata)return q(a.deltaUpdateGroupsSyncMetadata);else if(a.deltaGroupThreadDescription)return w(a.deltaGroupThreadDescription);else if(a.deltaUpdateThreadTheme)return n(a.deltaUpdateThreadTheme);else if(a.deltaUpdatePinnedThread)return x(a.deltaUpdatePinnedThread);else if(a.deltaUpdatePrivateGroupJoinableLink)return A(a.deltaUpdatePrivateGroupJoinableLink);else if(a.deltaOmniMDirectivesV2)return l(a.deltaOmniMDirectivesV2);else if(a.deltaMontageMessageDelete)return j(a.deltaMontageMessageDelete);else if(a.deltaNewMontageMessage)return k(a.deltaNewMontageMessage);else if(a.deltaPromoteGroupThreadAdmin)return B(a.deltaPromoteGroupThreadAdmin);else return y(a)}function j(a){var c=a.threadFbid;a=a.messageFbid;return{action_type:b("MercuryActionType").DELETE_MONTAGE_MESSAGES,threadFBID:c.toString(),messageFBID:a.toString()}}function k(a){return{action_type:b("MercuryActionType").NEW_MONTAGE_MESSAGE,thread_fbid:a.messageMetadata.threadFbid.toString(),actor_fbid:a.messageMetadata.actorFbid.toString(),message_fbid:a.messageMetadata.messageFbid.toString()}}function l(a){__p&&__p();if(a.directives&&a.directives[0]){a=(a=a.directives[0])!=null?(a=a.data)!=null?(a=a.add_actions)!=null?a.actions:a:a:a;if(a&&a[0]&&a[0].thread_key){var c=a[0].thread_key,d,e;if(c.thread_fbid)d=c.thread_fbid,e=b("MercuryIDs").getThreadIDFromThreadFBID(d);else if(c.other_user_fbid)d=c.other_user_fbid,e=b("MercuryIDs").getThreadIDFromUserID(d);else return null;return{action_type:b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS,thread_fbid:d,thread_id:e,suggestions:a}}}return null}function m(a){return"#"+a.slice(2)}function n(a){__p&&__p();var c=a.themeId,d=a.threadKey,e=a.fallbackColor;a=a.gradientColors;d=d.threadFbId||d.otherUserFbId;if(!d)return null;e=e&&m(e);var f=a&&a.length>0;if(f){f=a.map(m);return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),theme_id:c,solid_color:e,header_color:f[0],footer_color:f[f.length-1],gradient_colors:f}}else return{action_type:b("MercuryActionType").UPDATE_THREAD_THEME,thread_fbid:d.toString(),theme_id:c,solid_color:e,header_color:e,footer_color:e,gradient_colors:[]}}function o(a,c){__p&&__p();var d=a.message,e=a.repliedToMessage;d=b("MercurySyncNewMessageTransformer").transform(c,d);if(e){c=b("MercurySyncNewMessageTransformer").transform(c,e);e=null;if(a.status!==undefined&&a.status!==null)switch(a.status){case 0:e=b("RepliedToMessageStatusForGraphQL").VALID;break;case 1:e=b("RepliedToMessageStatusForGraphQL").DELETED;break;case 2:e=b("RepliedToMessageStatusForGraphQL").TEMPORARILY_UNAVAILABLE;break;default:g(0,3333)}d.replied_to_message={status:e,message:c}}return d}function p(a){var c=a.threadKey,d=a.actorFbid;a=a.groupsSyncStatus;c=c.threadFbId||c.otherUserFbId;if(!c)return null;a=b("MessengerGroupsSyncStatus")[a];return{action_type:b("MercuryActionType").GROUPS_SYNC_STATUS_CHANGED,thread_fbid:c.toString(),actor_fbid:d.toString(),groups_sync_status_string:a}}function q(a){__p&&__p();var c=a.threadKey,d=a.actorFbid,e=a.syncAction,f=a.sourceSurface;a=a.syncedFbGroupId;c=c.threadFbId||c.otherUserFbId;if(!c)return null;var g;switch(e){case b("ClientSyncProtocol_GroupsSyncAction").OPT_IN:g=b("MessengerGroupsSyncStatus").OPT_IN;break;case b("ClientSyncProtocol_GroupsSyncAction").OPT_OUT:g=b("MessengerGroupsSyncStatus").OPT_OUT;break;default:return null}return{action_type:b("MercuryActionType").GROUPS_SYNC_METADATA_UPDATE,thread_fbid:c.toString(),actor_fbid:d.toString(),groups_sync_action:g,source_surface:f,fb_group_id:a.toString()}}function r(a,c){var d=a.actorFbid,e=a.canViewerReply,f=a.reason;a=a.threadKey;if(!d)return null;var g=d.toString();g=b("MercuryIDs").getParticipantIDFromUserID(g===c?a.otherUserFbId:c);return b("MercuryParticipantTypes").PAGE==b("MessengerParticipants.bs").getNow(g).type?null:{action_type:b("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:d,canViewerReply:e,reason:f,message_blocked_ids:[g],other_user_fbid:a.otherUserFbId.toString()}}function s(a){var c=a.threadKey.threadFbId||a.threadKey.otherUserFbId;return{action_type:b("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:a.messageId,timestamp:a.timestamp,thread_fbid:c.toString(),keep_expiry_timestamp:a.keepExpiryTimestamp}}function t(a){var c=a.messageId,d=a.offlineThreadingId,e=a.reaction,f=a.senderId,g=a.userId;a=a.threadKey.threadFbId||a.threadKey.otherUserFbId;return{action_type:b("MercuryActionType").REACTION_UPDATE,messageId:c,offlineThreadingId:d,reaction:e,senderId:f,thread_fbid:a.toString(),userId:g}}function u(a){var c=a.threadKey&&a.threadKey.threadFbId;if(!c)return null;var d=a.actorFbId;a=a.rsvpStatus;return!d?null:{action_type:b("MercuryActionType").EVENT_RSVP_CHANGED,thread_fbid:c.toString(),actor_fbid:d.toString(),rsvp_status:a}}function v(a){__p&&__p();var c=a.threadKey;if(!c)return null;c=c.threadFbId||c.otherUserFbId;if(!c)return null;if(!a.messageLiveLocations||a.messageLiveLocations.length!==1)return null;a=a.messageLiveLocations[0];var d=a.expirationTime,e=a.stopReason!=null||Date.now()/b("DateConsts").MS_PER_SEC>d,f=function(a){return a/Math.pow(10,i)},g=a.coordinate?{latitude:f(a.coordinate.latitude),longitude:f(a.coordinate.longitude)}:null,j=null;a.destination&&(j={latitude:f(a.destination.latitude),longitude:f(a.destination.longitude),label:a.destination.label});f=null;switch(a.stopReason){case b("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED:f=h.EXPIRED;break;case b("MessageLiveLocationClientSyncProtocolStopReason").CANCELED:f=h.CANCELED;break;case b("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED:f=h.ARRIVED;break}return{action_type:b("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:c.toString(),messageId:a.messageId,liveLocation:{live_location_id:a.id.toString(),is_expired:e,expiration_time:d,sender:{id:a.senderId.toString()},coordinate:g,location_title:a.locationTitle,sender_destination:j,stop_reason:f}}}function w(a){var c=a.threadKey;a=a.threadDescription;c=c.threadFbId;return!c?null:{action_type:b("MercuryActionType").DESCRIPTION_CHANGED,thread_fbid:c.toString(),group_thread_description_string:a}}function x(a){var c=a.threadKey;a=a.isPinned;c=c.threadFbId||c.otherUserFbId;return{action_type:b("MercuryActionType").CHANGE_PINNED_STATUS,thread_fbid:c.toString(),is_pinned:a}}function y(a){a=a&&a.deltaPaymentPinProtectionStatusData;var c=a&&a.threadKey&&a.threadKey.otherUserFbId;a=a&&a.isPinProtected;if(!c)return null;c=c.toString();return{action_type:b("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:c,is_pin_protected:a}}function z(a){var c=a.threadKey.otherUserFbId;return{action_type:b("MercuryActionType").UPDATE_COMM_STATUS,comm_status:a.isFollowUp?b("PageCommItemStatus").FOLLOW_UP:b("PageCommItemStatus").TODO,thread_fbid:c.toString()}}function A(a){var c=a.threadKey;a=a.privateGroupLink;c=c.threadFbId;return{action_type:b("MercuryActionType").UPDATE_JOINABLE_LINK,joinable_link:a,thread_fbid:c.toString()}}function B(a){return{action_type:b("MercuryActionType").PROMOTE_GROUP_ADMINS,thread_fbid:a.threadKey.threadFbId.toString(),promoted_admins:a.promotedAdmins.map(function(a){return{admin_fbid:a.adminFbId.toString(),admin_type:a.adminType}})}}e.exports={transform:a}}),null);
__d("MercurySyncParticipantLeftGroupThreadTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){a=b("MercurySyncNewMessageTransformer").transform(a,c);a.action_type=b("MercuryActionType").LOG_MESSAGE;a.log_message_body=c.messageMetadata.adminText;a.log_message_data={removed_participants:[b("MercuryIDs").getParticipantIDFromUserID(c.leftParticipantFbId)]};a.log_message_type=b("MercuryLogMessageType").UNSUBSCRIBE;return a}e.exports={transform:a}}),null);
__d("MercurySyncParticipantsAddedToGroupThreadTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){a=b("MercurySyncNewMessageTransformer").transform(a,c);a.action_type=b("MercuryActionType").LOG_MESSAGE;a.log_message_body=c.messageMetadata.adminText;a.log_message_data={added_participants:c.addedParticipants.map(function(a){return b("MercuryIDs").getParticipantIDFromUserID(a.userFbId)})};a.log_message_type=b("MercuryLogMessageType").SUBSCRIBE;return a}e.exports={transform:a}}),null);
__d("MercurySyncReplaceMessageTransformer",["MercuryActionType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=Object.assign({},c.newMessage,c);return Object.assign(b("MercurySyncNewMessageTransformer").transform(a,c),{action_type:b("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:c.replacedMessageId})}e.exports={transform:a}}),null);
__d("MercurySyncThreadNameTransformer",["MercuryActionType","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){a=b("MercurySyncNewMessageTransformer").transform(a,c);a.action_type=b("MercuryActionType").LOG_MESSAGE;a.log_message_body=c.messageMetadata.adminText;a.log_message_data={name:c.name};a.log_message_type=b("MercuryLogMessageType").THREAD_NAME;return a}e.exports={transform:a}}),null);
__d("MercurySyncDispatcher",["Bootloader","MercuryActionType","MercuryDelayedDispatcher","MercuryGlobalActionType","MercuryPayloadSource","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MercurySyncAdminTextMessageTransformer","MercurySyncClientPayloadTransformer","MercurySyncDeliveryReceiptTransformer","MercurySyncDeltaTypes","MercurySyncMarkFolderChangeTransformer","MercurySyncMarkFolderSeenTransformer","MercurySyncMarkReadTransformer","MercurySyncMarkUnreadTransformer","MercurySyncMessageDeleteTransformer","MercurySyncNewMessageTransformer","MercurySyncPagesManagerEventTransformer","MercurySyncParticipantLeftGroupThreadTransformer","MercurySyncParticipantsAddedToGroupThreadTransformer","MercurySyncReadReceiptTransformer","MercurySyncReplaceMessageTransformer","MercurySyncRtcCallDataTransformer","MercurySyncRTCEventLogTransformer","MercurySyncThreadActionTransformer","MercurySyncThreadAdminsAddToGroupTransformer","MercurySyncThreadAdminsRemovedFromGroupTransformer","MercurySyncThreadApprovalModeTransformer","MercurySyncThreadApprovalQueueTransformer","MercurySyncThreadDeleteTransformer","MercurySyncThreadJoinableModeTransformer","MercurySyncThreadMuteSettingsTransformer","MercurySyncThreadNameTransformer","MontageActions","MSuggestionActions","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g="FOLDER_MONTAGE";a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};function a(a){this.$1=a,this.$2=b("MercuryDelayedDispatcher").getForFBID(this.$1),this.$3=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1)}a.prototype.process=function(a){__p&&__p();var c,d;switch(a["class"]){case b("MercurySyncDeltaTypes").NewMessage:c=b("MercurySyncNewMessageTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").ReplaceMessage:c=b("MercurySyncReplaceMessageTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").DeliveryReceipt:c=b("MercurySyncDeliveryReceiptTransformer").transform(a);this.$3.handleUpdate(c);break;case b("MercurySyncDeltaTypes").MarkRead:c=b("MercurySyncMarkReadTransformer").transform(a);var e=[],f=[];c.forEach(function(a){a.action_type===b("MercuryGlobalActionType").MARK_ALL_READ?e.push(a):f.push(a)});e.length&&this.$5(e);f.length&&this.$6(f);break;case b("MercurySyncDeltaTypes").MarkUnread:c=b("MercurySyncMarkUnreadTransformer").transform(a);this.$6(c);break;case b("MercurySyncDeltaTypes").ParticipantLeftGroupThread:c=b("MercurySyncParticipantLeftGroupThreadTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread:c=b("MercurySyncParticipantsAddedToGroupThreadTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").RTCEventLog:c=b("MercurySyncRTCEventLogTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").ThreadName:c=b("MercurySyncThreadNameTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").ReadReceipt:c=b("MercurySyncReadReceiptTransformer").transform(a);this.$3.handleUpdate(c);break;case b("MercurySyncDeltaTypes").AdminTextMessage:c=b("MercurySyncAdminTextMessageTransformer").transform(this.$1,a);this.$4(c);break;case b("MercurySyncDeltaTypes").MessageDelete:d=a.threadKey.threadFbId;c=b("MercurySyncMessageDeleteTransformer").transform(a);d&&a.folder&&a.folder===g?b("MontageActions").requestUpdate(d):this.$4(c);break;case b("MercurySyncDeltaTypes").ThreadAction:c=b("MercurySyncThreadActionTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").ThreadDelete:c=b("MercurySyncThreadDeleteTransformer").transform(a);this.$6(c);break;case b("MercurySyncDeltaTypes").AdminAddedToGroupThread:c=b("MercurySyncThreadAdminsAddToGroupTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").AdminRemovedFromGroupThread:c=b("MercurySyncThreadAdminsRemovedFromGroupTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").ThreadMuteSettings:c=b("MercurySyncThreadMuteSettingsTransformer").transform(a);this.$6([c]);break;case b("MercurySyncDeltaTypes").PagesManagerEvent:c=b("MercurySyncPagesManagerEventTransformer").transform(a);if(!c)return;this.$6([c]);break;case b("MercurySyncDeltaTypes").JoinableMode:c=b("MercurySyncThreadJoinableModeTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").ApprovalMode:c=b("MercurySyncThreadApprovalModeTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").ApprovalQueue:c=b("MercurySyncThreadApprovalQueueTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").ClientPayload:c=b("MercurySyncClientPayloadTransformer").transform(a,this.$1);if(!c)return;switch(c.action_type){case b("MercuryActionType").DELETE_MONTAGE_MESSAGES:b("gkx")("678586")&&b("MontageActions").deleteMontage(this.$1,c);b("MontageActions").requestUpdate(c.threadFBID);break;case b("MercuryActionType").NEW_MONTAGE_MESSAGE:b("gkx")("678586")&&b("MontageActions").handleNewMontageDelta(this.$1,c);b("MontageActions").requestUpdate(c.thread_fbid);break;case b("MercuryActionType").CREATE_OMNI_M_SUGGESTIONS:b("MSuggestionActions").saveAllSuggestions(c.thread_id,c.suggestions);var h=c.suggestions;b("gkx")("678669")&&b("Bootloader").loadModules(["OmniMEventTypedLoggerUtils","OmniMLoggerEvents"],function(a,b){a.logOmniMBar(h.map(function(a){return a.id}),b.SUGGESTIONS_RECEIVED)},"MercurySyncDispatcher");break;default:this.$4(c);break}break;case b("MercurySyncDeltaTypes").GenieMessage:c=b("MercurySyncNewMessageTransformer").transform(this.$1,a.deltaNewMessage);this.$4(c);break;case b("MercurySyncDeltaTypes").MontageMessage:d=a.newMessage.messageMetadata.actorFbId;d&&b("MontageActions").requestUpdate(d);break;case b("MercurySyncDeltaTypes").RtcCallData:c=b("MercurySyncRtcCallDataTransformer").transform(a);this.$4(c);break;case b("MercurySyncDeltaTypes").MarkFolderSeen:c=b("MercurySyncMarkFolderSeenTransformer").transform(a);this.$5(c);break;case b("MercurySyncDeltaTypes").ThreadFolder:c=b("MercurySyncMarkFolderChangeTransformer").transform(a);this.$6([c]);break;default:break}};a.prototype.$4=function(a){var c=a.other_user_fbid||a.thread_fbid;this.$2.handleUpdateWaitForThread({actions:[a],payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE},c)};a.prototype.$5=function(a){this.$3.handleUpdate({global_actions:a,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE})};a.prototype.$6=function(a){this.$3.handleUpdate({actions:a,payload_source:b("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE})};var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncForcedFetchHandler",["Promise","MercurySingletonProvider","MercurySyncDFFDataFetcher","MercuryThreadIDMap","MessengerState.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return{getPayload:function(){return{sequence_id:a}}}}a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};function a(a){this.$1=a,this.$2=b("MercuryThreadIDMap").getForFBID(this.$1),this.$3=b("MercurySyncDFFDataFetcher").getForFBID(this.$1)}a.prototype.processMessageDFF=function(a,c,d,e){__p&&__p();if(e){e=c.otherUserFbId!==undefined?c.otherUserFbId.toString():c.threadFbId.toString();e=this.$2.getClientIDFromServerIDNow(e);if(e===undefined)return b("Promise").resolve(g(a));e=b("MessengerState.bs").getMessagesFromIDs(this.$1,[d]);if(e.length===0)return b("Promise").resolve(g(a))}return this.$3.fetchInvalidateMessage(c.otherUserFbId,c.threadFbId,d)};a.prototype.processThreadDFF=function(a,c,d){if(d){d=c.otherUserFbId!==undefined?c.otherUserFbId.toString():c.threadFbId.toString();d=this.$2.getClientIDFromServerIDNow(d);if(d===undefined)return b("Promise").resolve(g(a))}return this.$3.fetchInvalidateThreadState(c.otherUserFbId,c.threadFbId)};a.prototype.processGlobalDFFForGraphQL=function(){return this.$3.fetchInvalidateGlobalStateForGraphQL()};var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MontageDispatcher",["ExplicitRegistrationDispatcher"],(function(a,b,c,d,e,f){"use strict";var g;g=babelHelpers.inherits(a,b("ExplicitRegistrationDispatcher"));g&&g.prototype;function a(){g.apply(this,arguments)}e.exports=new a({strict:!1})}),null);
__d("MontageActions",["Bootloader","CurrentUser","MercuryServerPayloadPreprocessor","MontageDispatcher","WebGraphQL","keyMirror","promiseDone","uniqueID"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("keyMirror")({REQUEST_UPDATE:null,HAS_UPDATED:null,HANDLE_ACTION:null}),h=new Set();a={Types:g,requestUpdate:function(a){b("MontageDispatcher").dispatch({type:g.REQUEST_UPDATE,threadFBID:a})},montageThreadChanged:function(a,c){b("MontageDispatcher").dispatch({type:g.REQUEST_UPDATE,threadFBID:a})},hasUpdated:function(a){b("MontageDispatcher").dispatch({type:g.HAS_UPDATED,threadFBID:a})},loadMontageThreadForActor:function(a){if(h.has(a))return;h.add(a);b("Bootloader").loadModules(["MessengerMontageThreadQueryWebGraphQLQuery"],function(c){c=b("WebGraphQL").exec(new c({id:a}));b("promiseDone")(c,function(c){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({current_montage_thread:c}),h["delete"](a)})},"MontageActions")},deleteMontage:function(a,c){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_delete_message_delta:c})},handleNewMontageDelta:function(a,c){b("Bootloader").loadModules(["MessengerNewMontageMessageWebGraphQLQuery"],function(a){a=b("WebGraphQL").exec(new a({id:c.message_fbid}));b("promiseDone")(a,function(a){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_new_message_delta:a.montage_message})})},"MontageActions")},updatePollStickerChoice:function(a){b("Bootloader").loadModules(["MessengerState.bs","MessengerMontagePollVoteMutationWebGraphQLMutation"],function(c,d){b("MercuryServerPayloadPreprocessor").getForFBID(b("CurrentUser").getID()).handleUpdate({montage_poll_sticker_vote:[a]});c=b("WebGraphQL").exec(new d({input:{client_mutation_id:b("uniqueID")(),story_card_poll_id:a.pollID,option:a.optionVotedIndex,actor_id:b("CurrentUser").getID()}}));b("promiseDone")(c,function(a){},function(a){})},"MontageActions")}};e.exports=a}),null);
__d("M4IconSVG.bs",["React","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";var g=b("ReasonReact.bs").statelessComponent("M4IconSVG");function a(a,c){var d=a!==undefined?a:"16px";return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){return b("React").createElement("svg",{key:"svg",height:d,width:d,version:"1.1",viewBox:"0 0 16 16",x:"0px",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlSpace:"preserve",y:"0px"},c)},g[9],g[10],g[11],g[12]]}f.component=g;f.make=a}),null);
__d("M4IconCamcorder.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconCamcorder");function h(a,c,d){var e=a!==undefined?a:!0,f=c!==undefined?c:"blue",h={fill:e?f:"none",stroke:f};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){return b("ReasonReact.bs").element(undefined,undefined,b("M4IconSVG.bs").make(undefined,[b("React").createElement("path",{key:"body",style:h,d:"M9.5,13.5h-7c-1.1,0-2-0.9-2-2v-7c0-1.1,0.9-2,2-2h7c1.1,0,2,0.9,2,2v7C11.5,12.6,10.6,13.5,9.5,13.5z"}),b("React").createElement("line",{key:"focus-ring",stroke:e?"none":f,x1:"13.5",x2:"13.5",y1:"5",y2:"11"}),b("React").createElement("path",{key:"lens",style:h,d:"M15,3.6l-3.5,3V8v1.4l3.5,3c0.2,0.2,0.5,0,0.5-0.3V8V3.9C15.5,3.6,15.2,3.4,15,3.6z"})]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconPhone.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconPhone");function h(a,c,d){d=a!==undefined?a:!0;a=c!==undefined?c:"blue";var e={fill:d?a:"none",stroke:a};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){return b("ReasonReact.bs").element(undefined,undefined,b("M4IconSVG.bs").make(undefined,[b("React").createElement("path",{key:"all",style:e,d:"M8.8,11.6c0.1,0,0.1,0.1,0.2,0.1c0.4,0.2,0.8,0.1,1-0.3c0.1-0.2,0.2-0.4,0.3-0.6c0.2-0.2,0.5-0.6,0.8-0.7 C11.5,10,11.8,10,12,10c0.4,0,0.9,0.4,1.6,0.8c0.7,0.4,1.2,0.8,1.5,1c0.2,0.2,0.3,0.4,0.3,0.6c0,0.4,0,1.2-0.7,1.9 c-1,1.1-2.5,1.6-4.3,1c-1.8-0.6-4.1-1.7-6-3.7s-3.1-4.2-3.7-6s-0.2-3.3,1-4.3c0.7-0.6,1.4-0.7,1.9-0.7c0.2,0,0.5,0.1,0.6,0.3 c0.2,0.3,0.6,0.8,1,1.5C5.7,3.1,6,3.6,6,4c0,0.3,0,0.6-0.1,0.8C5.8,5.1,5.5,5.4,5.2,5.6C5,5.8,4.8,5.9,4.7,6C4.3,6.1,4.1,6.6,4.3,7 c0,0.1,0.1,0.1,0.1,0.2C5.5,9,7,10.5,8.8,11.6z"})]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconPhoto.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconPhoto");function h(a,c,d){var e=a!==undefined?a:!0,f=c!==undefined?c:"blue",h={fill:"none",stroke:f,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){return b("ReasonReact.bs").element(undefined,undefined,b("M4IconSVG.bs").make(undefined,[e?b("React").createElement("g",{key:"filled"},b("React").createElement("path",{key:"bg",d:"M1.3,13.1L2,1.7c0-0.1,0-0.2,0-0.4L1.2,1.4C0.5,1.5,0,2.4,0,3.4l0.6,10.9c0,0.5,0.2,0.9,0.4,1.3C1.4,15.8,1.7,16,1.9,16 c0,0,0.1,0,0.1,0l0.3,0C1.7,15.4,1.2,14.3,1.3,13.1z",fill:f}),b("React").createElement("path",{key:"hills",d:"M13,6.2c-0.2-0.2-0.6-0.3-0.8-0.1L9.4,8.5c-0.2,0.1-0.2,0.4,0,0.6L10,9.8c0.2,0.2,0.2,0.6-0.1,0.8c-0.1,0.1-0.2,0.1-0.4,0.1 c-0.2,0-0.3-0.1-0.4-0.2L7.3,8.3C7.1,8.1,6.7,8,6.5,8.2l-2.6,2l-0.4,3.1c0,0.5,0.2,1.6,0.7,1.7l8.8,0.6c0.2,0,0.5,0,0.7-0.2 c0.2-0.2,0.5-0.7,0.6-0.9l0.6-5.9L13,6.2z",fill:f}),b("React").createElement("path",{key:"frame",style:h,d:"M12.9,15.5l-8.2-0.7C4,14.7,3.4,14,3.4,13.2l1-11.4C4.5,1,5.2,0.5,6,0.5l8.2,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"})):b("React").createElement("g",{key:"outline"},b("React").createElement("path",{key:"bg",d:"M2.1,14.7c-0.1-0.1-0.2-0.3-0.2-0.5l0-0.1c-0.1-0.3-0.1-0.7-0.1-1.1l0-0.1L1,3.3c0-0.5,0.3-0.9,0.8-0.9l1-0.1l0.1-0.7\n              c0-0.1,0-0.2,0.1-0.4L1.7,1.4c-1,0.1-1.8,1-1.7,2l0.9,10.9c0,0.5,0.3,0.9,0.7,1.3C1.9,15.8,2.3,16,2.8,16c0.1,0,0.1,0,0.2,0l0.5,0\n              C2.8,15.7,2.4,15.2,2.1,14.7z",fill:f}),b("React").createElement("path",{key:"frame",style:h,d:"M12.9,15.5l-8.3-0.7c-0.8-0.1-1.4-0.8-1.3-1.6l1-11.4C4.3,1,5.1,0.4,5.8,0.5l8.3,0.7C15,1.3,15.5,2,15.5,2.8 l-1,11.4C14.4,15,13.7,15.6,12.9,15.5z"}),b("React").createElement("polyline",{key:"left-hill",style:h,points:"3.5,11 6.9,8.6 9.2,11.3 "}),b("React").createElement("polyline",{key:"right-hill",style:h,points:"14.6,9 12.5,6.5 8.3,10 "})),b("React").createElement("circle",{key:"sun",cx:"7.5",cy:"4.5",fill:f,r:"1.5"})]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconSend.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconSend");function h(a,c,d){var e=a!==undefined?a:!0,f=c!==undefined?c:"blue";return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){return b("ReasonReact.bs").element(undefined,undefined,b("M4IconSVG.bs").make(undefined,[e?b("React").createElement("path",{key:"filled",d:"M11,8.3L2.6,8.8C2.4,8.8,2.3,8.9,2.3,9l-1.2,4.1c-0.2,0.5,0,1.1,0.4,1.5C1.7,14.9,2,15,2.4,15c0.2,0,0.4,0,0.6-0.1l11.2-5.6 C14.8,9,15.1,8.4,15,7.8c-0.1-0.4-0.4-0.8-0.8-1L3,1.1C2.5,0.9,1.9,1,1.5,1.3C1,1.7,0.9,2.3,1.1,2.9L2.3,7c0,0.1,0.2,0.2,0.3,0.2 L11,7.7c0,0,0.3,0,0.3,0.3S11,8.3,11,8.3z",fill:f}):b("React").createElement("g",{key:"outline"},b("React").createElement("path",{key:"perimeter",d:"M2.4,1.6l12,6c0.7,0.4,0.7,1.4,0,1.8l-12,6C1.7,15.8,0.8,15,1,14.2l1.7-5.4c0.1-0.2,0.1-0.4,0-0.6L1,2.8 C0.8,2,1.7,1.2,2.4,1.6z",fill:"none",stroke:f,strokeMiterlimit:"10"}),b("React").createElement("line",{key:"center-line",fill:"none",stroke:f,strokeMiterlimit:"10",x1:"2.8",x2:"14.8",y1:"8.5",y2:"8.5"}))]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("M4IconSettings.bs",["React","M4IconSVG.bs","ReasonReact.bs"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReasonReact.bs").statelessComponent("M4IconSettings");function h(a,c,d){var e=a!==undefined?a:!0,f=c!==undefined?c:"blue",h={fill:"none",stroke:f,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10"};return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],function(){var a=!e;return b("ReasonReact.bs").element(undefined,undefined,b("M4IconSVG.bs").make(undefined,[a?b("React").createElement("g",{key:"filled"},b("React").createElement("path",{key:"outer",style:h,d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5\n          \t\t\tH7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3\n          \t\t\tl-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9\n          \t\t\tc0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z"}),b("React").createElement("circle",{key:"inner",style:h,cx:"8",cy:"8",r:"2.5"})):b("React").createElement("path",{key:"all",d:"M15.5,8.9V7.1l-2.2-0.5c-0.1-0.5-0.3-0.9-0.6-1.3l1.2-1.9l-1.2-1.2l-1.9,1.2C10.3,3,9.9,2.8,9.4,2.7L8.9,0.5 H7.1L6.6,2.7C6.1,2.8,5.7,3,5.2,3.2L3.3,2.1L2.1,3.3l1.2,1.9C3,5.7,2.8,6.1,2.7,6.6L0.5,7.1v1.7l2.2,0.5c0.1,0.5,0.3,0.9,0.6,1.3 l-1.2,1.9l1.2,1.2l1.9-1.2c0.4,0.2,0.9,0.4,1.3,0.6l0.5,2.2h1.7l0.5-2.2c0.5-0.1,0.9-0.3,1.3-0.6l1.9,1.2l1.2-1.2l-1.2-1.9 c0.2-0.4,0.4-0.9,0.6-1.3L15.5,8.9z M8,11c-1.7,0-3-1.3-3-3c0-1.7,1.3-3,3-3c1.7,0,3,1.3,3,3C11,9.7,9.7,11,8,11z",fill:f,stroke:f})]))},g[9],g[10],g[11],g[12]]}a=b("ReasonReact.bs").wrapReasonForJs(g,function(a){return h(a.filled,a.color,[])});f.component=g;f.make=h;f.jsComponent=a}),null);
__d("messengerCustomColorUtils",["ChatConfig"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=c||{};b("ChatConfig").getBool("chat_tab_has_gradients")||(c.backgroundColor=a);return c}e.exports={customBubbleStyle:a}}),null);
__d("MessengerBotMenuDataFetcher",["AsyncRequest","Cache","MessengerBotComposerWebGraphQLQuery","XMessengerBotsMenuController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.$1=new(b("Cache"))(),this.$2=new(b("Cache"))()}a.prototype.getMenuItems=function(a,c,d){__p&&__p();if(this.$1.has(a)){c(this.$1.get(a));return}var e=b("XMessengerBotsMenuController").getURIBuilder().setString("page_id",a).getURI();new(b("AsyncRequest"))().setURI(e).setHandler(function(b){b=b.payload.menu;this.$1.set(a,b);c(b)}.bind(this)).setErrorHandler(function(a){d()}).send()};a.prototype.getHasPageSetting=function(a,c,d,e){__p&&__p();if(!this.$2.has(a)){var f=b("MessengerBotComposerWebGraphQLQuery").getURI({node_id:a});new(b("AsyncRequest"))().setURI(f).setHandler(function(b){b=b.payload.data.node;b=b&&b.commerce_page_settings||[];this.$2.set(a,b);c(b.indexOf(e)!==-1)}.bind(this)).setErrorHandler(function(b){this.$2.set(a,[]),d()}.bind(this)).send()}f=this.$2.get(a)||[];c(f.indexOf(e)!==-1);return f.indexOf(e)!==-1};e.exports=new a()}),null);
__d("MessengerTabsThreadSearchLoader",["Promise","Bootloader","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_store:null,_actions:null,_promise:null,getStoreEnforce:function(){b("nullthrows")(this._store,"Tab thread search store is not loaded");return this._store},getActionsEnforce:function(){b("nullthrows")(this._actions,"Tab thread search actions are not loaded");return this._actions},isLoaded:function(){return this._store&&this._actions},load:function(){this._promise||(this._promise=new(b("Promise"))(function(a){b("Bootloader").loadModules(["MessengerThreadSearchActions","MessengerTabsThreadSearchStore"],function(b,c){this._store=c.get(),this._actions=b,a({store:c,actions:b})}.bind(this),"MessengerTabsThreadSearchLoader")}.bind(this)));return this._promise}};e.exports=a}),null);
__d("AutoFocusableLink.react",["Link.react","ReactDOM"],(function(a,b,c,d,e,f){"use strict";var g;g=babelHelpers.inherits(a,b("Link.react"));g&&g.prototype;a.prototype.componentDidMount=function(){this.props.autoFocus&&b("ReactDOM").findDOMNode(this).focus()};function a(){g.apply(this,arguments)}e.exports=a}),null);
__d("CustomColorHighlighting.react",["cssVar","csx","cx","React","UserAgent","guid","joinClasses"],(function(a,b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j;c=b("React").PropTypes;d="._fy2";f="._43by";g="._mh6";h=b("UserAgent").isEngine("Gecko")?"._mh6 *::-moz-selection":"._mh6 ::selection";i=b("UserAgent").isEngine("Gecko")?"._43by *::-moz-selection":"._43by ::selection";var k=d+d,l=f+f,m=g+h,n=g+g,o=f+i,p="rgba(255, 255, 255, 0.3)";d=babelHelpers.inherits(a,b("React").PureComponent);j=d&&d.prototype;function a(a){j.constructor.call(this,a),this.state={id:"cch_"+b("guid")()}}a.prototype.UNSAFE_componentWillMount=function(){this.$1()};a.prototype.componentWillUnmount=function(){this.$2(),this.state.styleTag&&document.head.removeChild(this.state.styleTag)};a.prototype.UNSAFE_componentWillReceiveProps=function(a){this.props.customColor&&!a.customColor?this.$2():a.customColor!==this.props.customColor&&this.$3(a.customColor)};a.prototype.render=function(){return b("React").createElement("span",{className:b("joinClasses")("_mh6",this.props.className),id:this.state.id},this.props.children)};a.prototype.$1=function(){var a=document.createElement("style");a.appendChild(document.createTextNode(""));document.head.appendChild(a);this.setState({styleSheet:a.sheet,styleTag:a},function(){return this.$3(this.props.customColor)}.bind(this))};a.prototype.$4=function(a,b,c){a.insertRule?a.insertRule(b+"{"+c+"}",0):a.addRule&&a.addRule(b,c,0)};a.prototype.$5=function(a){"removeRule"in a?a.removeRule(0):"deleteRule"in a&&a.deleteRule(0)};a.prototype.$2=function(){if(this.state.styleSheet){if(this.state.styleSheet.rules)while(this.state.styleSheet.rules.length)this.$5(this.state.styleSheet);if(this.state.styleSheet.cssRules)while(this.state.styleSheet.cssRules.length)this.$5(this.state.styleSheet)}};a.prototype.$6=function(a){a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);var b=parseInt(a[1],16),c=parseInt(a[2],16);a=parseInt(a[3],16);return"rgba("+b+","+c+","+a+",0.2)"};a.prototype.$3=function(a){__p&&__p();this.$2();a=a||this.props.customColor;if(a){var b=this.$6(a);b="background: "+b;this.$4(this.state.styleSheet,"#"+this.state.id+m,b);this.$4(this.state.styleSheet,"#"+this.state.id+" "+k,"color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+" "+l,"background-color: "+a);this.$4(this.state.styleSheet,"#"+this.state.id+n+" "+o,"background-color: "+p)}};a.propTypes={className:c.string,customColor:c.string};e.exports=a}),null);
__d("EmojiOnlyMessage.react",["cx","EmojiImageURL","EmojiLikeConstants","FBEmojiUtils","Image.react","MessengerHotlikeEmoji.bs","React","gkx"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.render=function(){var a="_1ift _1ifu",c=0,d=this.props.contents.map(function(d){c++;var e=d.emojiKey;if(e){e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(e)?b("EmojiImageURL").getMessengerURL(e,b("EmojiLikeConstants").sizeMap.dp32):b("EmojiImageURL").getFBEmojiURL(b("FBEmojiUtils").resolveAliasFromKey(e)||e,b("EmojiLikeConstants").sizeMap.dp32);return b("React").createElement(b("Image.react"),{alt:d.text,className:a,key:c,src:e})}else return b("React").createElement("span",{key:c},d.text)});return b("React").createElement("div",{tabIndex:"0"},d)};function a(){h.apply(this,arguments)}a.propTypes={contents:c.arrayOf(c.shape({emojiKey:c.string,text:c.string.isRequired})).isRequired};e.exports=a}),null);
__d("HotLikeSound",["MercurySoundsConfig","SoundPlayer","StickerConstants"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=[b("MercurySoundsConfig").hot_like_grow_mp3_url,b("MercurySoundsConfig").hot_like_grow_ogg_url],h=[b("MercurySoundsConfig").hot_like_pop_mp3_url,b("MercurySoundsConfig").hot_like_pop_ogg_url],i=[b("MercurySoundsConfig").hot_like_outgoing_small_mp3_url,b("MercurySoundsConfig").hot_like_outgoing_small_ogg_url],j=[b("MercurySoundsConfig").hot_like_outgoing_medium_mp3_url,b("MercurySoundsConfig").hot_like_outgoing_medium_ogg_url],k=[b("MercurySoundsConfig").hot_like_outgoing_large_mp3_url,b("MercurySoundsConfig").hot_like_outgoing_large_ogg_url],l=function(){return!1};a={setCheckSoundEnabledFunc:function(a){l=a},start:function(){this._play(g)},stop:function(){b("SoundPlayer").stop(g)},pop:function(){this.stop(),this._play(h)},snap:function(a){this.stop(),a===b("StickerConstants").HOT_LIKE_SMALL_STICKER_ID&&this._play(i),a===b("StickerConstants").HOT_LIKE_MEDIUM_STICKER_ID&&this._play(j),a===b("StickerConstants").HOT_LIKE_LARGE_STICKER_ID&&this._play(k)},_play:function(a){l()&&b("SoundPlayer").play(a)}};e.exports=a}),null);
__d("getPageIDFromThreadID",["FBIDCheck","MercuryIDs"],(function(a,b,c,d,e,f){"use strict";function a(a){a=b("MercuryIDs").getUserIDFromThreadID(a);return!a||b("FBIDCheck").isUser_deprecated(a)?null:a}e.exports=a}),null);
__d("MessageReplyPermissions",["MercuryAttachmentType","MercuryConfig","MercuryLogMessageType","MessagingTag","MessengerBotMenuDataFetcher","MNCommercePageSetting","RepliedToMessageStatusForGraphQL","emptyFunction","getPageIDFromThreadID","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={canReplyToMessage:function(a){var c=b("getPageIDFromThreadID")(a.thread_id);if(c){c=b("MessengerBotMenuDataFetcher").getHasPageSetting(c,b("emptyFunction"),b("emptyFunction"),b("MNCommercePageSetting").COMPOSER_INPUT_DISABLED);if(c)return!1}return a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER?!1:this.isRepliableMessage(a)&&b("gkx")("678637")||this._canRenderM3RedesignReply(a)},bubbleContainsRepliedToMessage:function(a,b){return!b&&this._canRenderM3RedesignReply(a)},isRepliableMessage:function(a){var c=a.log_message_type===b("MercuryLogMessageType").VIDEO_CALL||a.log_message_type===b("MercuryLogMessageType").PHONE_CALL;if(c)return!1;c=a.attachments&&a.attachments.length===1&&a.attachments[0].attach_type;return!!a.body||c===b("MercuryAttachmentType").PHOTO||c===b("MercuryAttachmentType").VIDEO||c===b("MercuryAttachmentType").STICKER||c===b("MercuryAttachmentType").THIRDPARTYSTICKER||c===b("MercuryAttachmentType").ANIMATED_IMAGE||a.attachments&&a.attachments.length>=1},_canRenderM3RedesignReply:function(a){if(!b("MercuryConfig").SM3BD)return!1;if(a.status!==b("RepliedToMessageStatusForGraphQL").VALID)return!0;a=a.message;var c=a.attachments&&a.attachments.length===1&&a.attachments[0].attach_type;return!!a.body||b("MercuryConfig").RTPE&&c===b("MercuryAttachmentType").PHOTO||b("MercuryConfig").RTVE&&c===b("MercuryAttachmentType").VIDEO||b("MercuryConfig").RTSE&&(c===b("MercuryAttachmentType").STICKER||c===b("MercuryAttachmentType").THIRDPARTYSTICKER)||b("MercuryConfig").RTGE&&c===b("MercuryAttachmentType").ANIMATED_IMAGE||b("MercuryConfig").RTOAE&&a.attachments&&a.attachments.length>=1}};e.exports=a}),null);
__d("MessageRequestUtils",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";a={isMessageRequest:function(a){return(a.folder===b("MessagingTag").PENDING||a.folder===b("MessagingTag").OTHER)&&a.can_reply},isFiltered:function(a){return a.folder===b("MessagingTag").OTHER}};e.exports=a}),null);
__d("MessageThreadAssociatedObjectUtils",["TimeSpentRoomTypeEnum"],(function(a,b,c,d,e,f){"use strict";a={shouldRender:function(a){return a&&a.room_type===b("TimeSpentRoomTypeEnum").GROUP&&!a.is_workplace_community},isLinkedToGroupChat:function(a){return a&&a.room_type===b("TimeSpentRoomTypeEnum").GROUP&&!a.is_workplace_community}};e.exports=a}),null);
__d("MessengerMentionSource",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({REPLY:"reply",ATSIGN:"@",TYPEAHEAD:"typeahead"});e.exports=a}),null);
__d("MessengerSupportedEmojiUtils",["cx","EmojiImageURL","EmojiLikeConstants","EmojiRenderer","EmoticonEmojiList","FBEmojiAliases","Image.react","MessengerEmojiTransitionMapping.bs","MessengerHotlikeEmoji.bs","MessengerSupportedEmoji","React","SupportedFBEmoji","Utf16","gkx","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=/_fe0f/g,i=new RegExp("(\r\n|[ \r\n]|s)");a={getSupportedEmojiKey:function(a){__p&&__p();if(!a)return null;var c=null,d=this.parse(a);if(d.length===1&&d[0].length===a.length){a=d[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(h,"")}if(c){d=b("FBEmojiAliases")[c];d&&(c=d.replace(h,""))}return this.isSupportedEmojiKey(c)?c:null},isSupportedEmoji:function(a){return!!this.getSupportedEmojiKey(a)},isSupportedEmojiKey:function(a){if(!a)return!1;return!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?!!b("SupportedFBEmoji")[function(a){var c=b("FBEmojiAliases")[a];return c?c.replace(h,""):a}(a)]:!!b("MessengerSupportedEmoji").emoji[a]},isMessengerSupportedEmojiKey:function(a){return!!(a&&b("MessengerSupportedEmoji").emoji[a])},getSupportedEmojiCodesArray:function(a){__p&&__p();if(!a)return null;var c=this.parse(a);if(c.length===1&&c[0].length===a.length){a=c[0].emoji.map(function(a){return b("Utf16").decode(a)});c=a.map(function(a){return a.toString(16)}).join("_").replace(h,"");if(this.isSupportedEmojiKey(c))return a}return null},getEmojiKeyFromCodes:function(a){a=a.map(function(a){return a.toString(16)}).join("_").replace(h,"");var c=b("FBEmojiAliases")[a];return c?c.replace(h,""):a},getClassSizeMap:function(){var a,c=b("EmojiLikeConstants").size;return a={},a[c.XSMALL]="_2560",a[c.SMALL]="_1ifu",a[c.MEDIUM]="_19_r",a[c.LARGE]="_19_s",a},getEmojiMatchObj:function(a){a=this.parse(a,1);if(a.length!==1)return null;var c=a[0].emoji,d=a[0].emoji.map(function(a){return b("Utf16").decode(a)});b("MessengerEmojiTransitionMapping.bs").hasGender(d)&&!b("MessengerEmojiTransitionMapping.bs").getGender(d)&&(d=b("MessengerEmojiTransitionMapping.bs").makeFemale(d));d=d.map(function(a){return a.toString(16)}).join("_").replace(h,"");return{emoji_key:d,emoji_str:c.join(""),is_supported:this.isSupportedEmojiKey(d),offset:a[0].offset,length:a[0].length}},getNewEmojiData:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[c];c=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):b("EmojiImageURL").getFBEmojiURL(a,c);return{emoji:b("React").createElement(b("Image.react"),{className:d,src:c}),emoji_key:a,url:c}},getHotLikeEmojiDataTransition:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a,!0);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):b("EmojiImageURL").getFBEmojiURL(a,c);return{emoji:b("React").createElement(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getHotLikeEmojiData:function(a,c){__p&&__p();if(!a)return null;a=this.getSupportedEmojiKey(a);if(!a)return null;var d=this.getClassSizeMap();c=this.transferSize(c);var e=c===b("EmojiLikeConstants").size.MEDIUM?b("EmojiLikeConstants").size.LARGE:c;b("EmojiLikeConstants").sizeMap[c]||(c=b("EmojiLikeConstants").size.XSMALL);d=b("joinClasses")(d[c],"_1ift");c=b("EmojiLikeConstants").sizeMap[e];e=b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)?b("EmojiImageURL").getMessengerURL(a,c):b("EmojiImageURL").getFBEmojiURL(a,c);return{emoji:b("React").createElement(b("Image.react"),{className:d,src:e}),emoji_key:a,url:e}},getEmojiOnlyContents:function(a){__p&&__p();a=a||"";var c=[];while(a.length>0&&a.trim().length>0){var d=i.exec(a),e="";while(d&&d.length&&d.index===0)e+=d[0],a=a.replace(i,""),d=i.exec(a);e.length>0&&c.push({text:e});d=b("EmoticonEmojiList").noncapturingRegexp.exec(a);if(d&&d.index===0){e=b("EmoticonEmojiList").names[d[1]];e=b("EmoticonEmojiList").emote2emojis[e];c.push({emojiKey:e,text:d[1]});a=a.replace(d[1],"")}else{d=this.getEmojiMatchObj(a);if(d&&d.is_supported)c.push({emojiKey:d.emoji_key,text:d.emoji_str}),a=a.replace(d.emoji_str,"");else return null}}return c},getUrl:function(a,c){a=a.replace(h,"");c=this.transferSize(c);if(b("gkx")("678639")&&!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(a)){var d=b("FBEmojiAliases")[a];d&&(a=d.replace(h,""));return!this.isSupportedEmojiKey(a)?null:b("EmojiImageURL").getFBEmojiURL(a,b("EmojiLikeConstants").sizeMap[c])}return!b("MessengerSupportedEmoji").emoji[a]?null:b("EmojiImageURL").getMessengerURL(a,b("EmojiLikeConstants").sizeMap[c])},containsEmoji:function(a){return this.parse(a,1).length===1},parse:function(a,c){return b("EmojiRenderer").parse(a,c)},transferSize:function(a){return b("EmojiLikeConstants").sizeMapTransfer[a]||a}};e.exports=a}),null);
__d("messengerIterateEmoji",["MessengerSupportedEmoji","ifRequired"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c,d,e){__p&&__p();var f=String(a);while(f){a=b("ifRequired")("MessengerSupportedEmojiUtils",function(a){return a.getEmojiMatchObj(f)},function(){return b("MessengerSupportedEmoji").getEmojiMatchObj(f)});if(a){var g=a.offset+a.length,h=f.substr(0,a.is_supported?a.offset:g);d(h);a.is_supported&&c(a.emoji_str,a.emoji_key,e);h=f.substr(g);f=h}else break}d(f)}e.exports=a}),null);
__d("MessengerTextWithEmoticons.react",["cx","fbt","BaseTextWithDecoration.react","EmojiImageURL","EmoticonEmojiList","FBEmojiUtils","Image.react","MessengerHotlikeEmoji.bs","React","gkx","messengerIterateEmoji","messengerIterateEmoticons"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i;c=b("React").PropTypes;function j(a,c,d,e){var f=e?128:16;a=!a&&!b("MessengerHotlikeEmoji.bs").isMessengerHotlike(d)?b("EmojiImageURL").getFBEmojiURL(b("FBEmojiUtils").resolveAliasFromKey(d)||d,f):b("EmojiImageURL").getMessengerURL(d,f);d=e?"_1ift _5m3a":"_1ift _2560";return b("React").createElement(b("Image.react"),{alt:c,className:d,src:a})}function k(a,c,d){var e=d?128:16,f=b("EmoticonEmojiList").emote2emojis[c],g=f?b("MessengerHotlikeEmoji.bs").isMessengerHotlike(f)?b("EmojiImageURL").getMessengerURL(f,e):b("EmojiImageURL").getFBEmojiURL(f,e):null;if(g){f=String.fromCodePoint(parseInt(f,e));e=d?"_1ift _5m3a":"_1ift _2560";return b("React").createElement(b("Image.react"),{alt:f,className:e,src:g})}d=h._("\u00e9motic\u00f4ne {emoticonName}",[h._param("emoticonName",c)]);return b("React").createElement("span",{"aria-label":d},a)}function l(a,b,c){return function(d,e,f){var g=function(c,d,a){e(b(c,d,a))};a(String(d),g,f,c)}}i=babelHelpers.inherits(a,b("React").Component);i&&i.prototype;a.prototype.shouldComponentUpdate=function(a){return a.text!==this.props.text};a.prototype.render=function(){var a=[l(b("messengerIterateEmoji"),j.bind(null,!!this.props.forceMessengerEmoji),this.props.customSize),l(b("messengerIterateEmoticons"),k,this.props.customSize)];return b("React").createElement(b("BaseTextWithDecoration.react"),babelHelpers["extends"]({},this.props,{text:this.props.text,decorators:a}))};function a(){i.apply(this,arguments)}a.propTypes={text:c.string,customSize:c.bool,forceMessengerEmoji:c.bool};e.exports=a}),null);
__d("ReasonBootloadOnRender.react",["LoadOnRender.react","React","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("React").Component);g=c&&c.prototype;function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=g.constructor).call.apply(a,[this].concat(e)),this.$1=function(a){b("promiseDone")(this.props.loader.load(),a)}.bind(this),c}a.prototype.render=function(){"use strict";return b("React").createElement(b("LoadOnRender.react"),{placeholder:this.props.placeholder,loader:this.$1,component:this.props.component})};e.exports=a}),null);
__d("ReasonResource",["Promise","JSResourceReference","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;g=babelHelpers.inherits(h,b("JSResourceReference"));g&&g.prototype;h.prototype.load=function(){return new(b("Promise"))(function(a){b("promiseDone")(this.getFullComponent(),function(b){a(b.jsComponent)})}.bind(this))};h.prototype.getFullComponent=function(){return this.__reference.load()};h.prototype.setResourceReference=function(a){this.__reference=a;return this};function h(){g.apply(this,arguments)}function a(a){return new h(a.getModuleId()).setResourceReference(a)}e.exports=a}),null);
__d("applyMessengerEmoticonToContentBlock",["CharacterMetadata","EmoticonEmojiList"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){if(!b("EmoticonEmojiList").names[d])return c;var f=c.getCharacterList(),g=a.createEntity("EMOTICON","IMMUTABLE",{type:b("EmoticonEmojiList").names[d],originalEmoticon:d}).getLastCreatedEntityKey();return c.merge({characterList:f.slice(0,e).concat(f.slice(e,e+d.length).map(function(a){return b("CharacterMetadata").applyEntity(a,g)}),f.slice(e+d.length))})}e.exports=a}),null);
__d("applyMessengerEmoticonToContentState",["EmoticonEmojiList","applyMessengerEmoticonToContentBlock","getTextAfterNearestEntity"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){__p&&__p();var d=c.getAnchorKey(),e=c.getAnchorOffset(),f=a.getBlockForKey(d),g=b("getTextAfterNearestEntity")(f,e),h=b("EmoticonEmojiList").regexp.exec(g);if(!h)return a;var i=h[1];if(!i&&e!==g.length)return a;i=h[2];g=e-g.length;g=g+h.index+h[1].length;h=a.getBlockMap().set(d,b("applyMessengerEmoticonToContentBlock")(a,f,i,g));return a.merge({blockMap:h,selectionBefore:c,selectionAfter:c.merge({anchorOffset:e,focusOffset:e})})}e.exports=a}),null);
__d("MessagesViewer",["AsyncRequest","DOM","MessagesViewerSetID","PhotoStore","React","ReactDOM","ge"],(function(a,b,c,d,e,f){__p&&__p();a={renderSpotlight:function(a,c,d,e){var f=a.setID;f||(f=b("MessagesViewerSetID").MESSAGES);g(b("React").createElement(d,{actorid:a.actorid,dimensions:[a.dimensions],disablepaging:a.disablePaging,disableForward:a.disableForward,forwardDialogComponent:e,open:!0,photoid:a.fbid,reverse:!1,rootClassName:a.rootClassName,setid:f,snapToPhoto:a.snapToPhoto,thumbsrc:a.src}));if(!b("PhotoStore").hasBeenCreated(f)&&a.endpoint){d=new(b("AsyncRequest"))(a.endpoint);c&&d.setRelativeTo(c);d.send()}},renderVideo:function(a){g(a)}};function g(a){var c=b("ge")("messages_viewer");c||(c=b("DOM").create("div",{id:"messages_viewer"}),document.body.appendChild(c));b("ReactDOM").render(a,c,function(){this.subscribeOnce("close",function(){b("ReactDOM").unmountComponentAtNode(c)})})}e.exports=a}),null);
__d("MercuryAttachmentViewer",["Bootloader","MessagesViewer","React","Run","emptyFunction"],(function(a,b,c,d,e,f){"use strict";a={renderVideo:function(a){b("Bootloader").loadModules(["MessagingVideoViewer.react","MessagingForwardAttachmentDialog.react"],function(c,d){b("MessagesViewer").renderVideo(b("React").createElement(c,babelHelpers["extends"]({},a,{forwardDialogComponent:d})))},"MercuryAttachmentViewer")},bootstrapWithConfig:function(a,c){b("Bootloader").loadModules(["SpotlightMessagesViewer","MessagingForwardAttachmentDialog.react"],function(d,e){b("MessagesViewer").renderSpotlight(a,c,d,e)},"MercuryAttachmentViewer")},preload:function(){b("Run").onAfterLoad(function(){b("Bootloader").loadModules(["MessagingVideoViewer.react","SpotlightMessagesViewer","MessagingForwardAttachmentDialog.react"],b("emptyFunction"),"MercuryAttachmentViewer")})}};e.exports=a}),null);
__d("MercuryNotificationRenderer",["fbt","CurrentUser","MercuryAssert","MercuryIDs","MessengerParticipants.bs","MercuryViewer","MessagingGenericAdminTextType","MessengerState.bs"],(function(a,b,c,d,e,f,g){__p&&__p();var h="source:messenger_growth:event_upcoming_bump";function a(a,c){__p&&__p();b("MercuryAssert").isThreadID(a),b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),a,function(d){__p&&__p();b("MessengerState.bs").getThreadMessagesRange(b("CurrentUser").getID(),a,0,1,function(e){__p&&__p();e=e.length&&e[e.length-1];var f=[];e.tags!==undefined&&(f=f.concat(e.tags));e.log_message_data&&(e.log_message_data.message_type==b("MessagingGenericAdminTextType").CONFIRM_FRIEND_REQUEST||e.log_message_data.message_type==b("MessagingGenericAdminTextType").WORK_INVITE_CLAIMED)?c(g._("New contact added")):f.indexOf(h)!==-1?c(g._("Vous avez un \u00e9v\u00e8nement \u00e0 venir.")):e&&e.author!=b("MercuryViewer").getID()?b("MessengerParticipants.bs").get(e.author,function(e){var f=e.short_name,h=d.custom_nickname;if(h){e=b("MercuryIDs").getUserIDFromParticipantID(e.id);h[e]&&(f=h[e])}d.name?c(g._("{senderName} a envoy\u00e9 un message \u00e0 {groupName}",[g._param("senderName",f),g._param("groupName",d.name)])):b("MercuryIDs").isGroupChat(a)?c(g._("{name} a envoy\u00e9 un message \u00e0 votre groupe",[g._param("name",f)])):c(g._("{name} vous a envoy\u00e9 un message",[g._param("name",f)]))}):c(g._("Nouveau message\u00a0!"))})})}e.exports={renderDocumentTitle:a}}),null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryDispatcher","MercuryPayloadSource","MercurySingletonProvider"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};function a(a){this.$1=a,this.$3=0,this.$2=b("MercuryDispatcher").getForFBID(this.$1),this.$2.subscribe("update-messages",this.$4.bind(this))}a.prototype.$4=function(a,c){if(!c.actions||!c.actions.length)return;if(c.payload_source===b("MercuryPayloadSource").CLIENT_SEND_MESSAGE||c.payload_source===b("MercuryPayloadSource").UNKNOWN)return;for(var a=0;a<c.actions.length;a++){var d=c.actions[a],e=d.action_type;e==b("MercuryActionType").USER_GENERATED_MESSAGE&&d.thread_id&&d.timestamp>this.$3&&(this.$3=d.timestamp)}};a.prototype.getLastUserMessageTimestamp=function(){return this.$3};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryBrowserAlerts",["ArbiterMixin","Bootloader","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","CurrentUser","Event","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryThreadInfo","MercuryViewer","MessagingTag","MessengerState.bs","Sound","UserActivity","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=3,h=6e5,i=new Map(),j=null;function k(){return!b("UserActivity").isOnTab()&&!b("UserActivity").hasBeenInactive()}function l(){i=new Map()}function m(a){b("ChatOptions").getSetting("sound")&&!k()&&b("Sound").play([b("ChatConfig").get("sound.notif_ogg_url"),b("ChatConfig").get("sound.notif_mp3_url")],a,!1)}var n=Object.assign({init:function(){b("Event").listen(window,"focus",function(){l(),clearInterval(j)}),b("Event").listen(window,"blur",function(){j=setInterval(l,h)}),b("gkx")("678573")&&b("CurrentUser").isWorkUser()&&(this._availabilityStatusStore=null,b("Bootloader").loadModules(["WorkChatAvailabilityStatusStore"],function(a){this._availabilityStatusStore=a}.bind(this),"MercuryBrowserAlerts"))},messageReceived:function(a){__p&&__p();var c=this._availabilityStatusStore&&this._availabilityStatusStore.getIsDoNotDisturb(b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID()));if(c||a.author&&b("MercuryViewer").isViewer(a.author)||!a.is_unread||a.folder!=b("MessagingTag").INBOX&&a.folder!=b("MessagingTag").ARCHIVED)return;var d=a.thread_id,e=b("ChatActivity").isActive();if(e){var f=!1;n.inform("before-alert",{threadID:d,cancelAlert:function(){f=!0}})}b("MessengerState.bs").getThreadMeta(b("CurrentUser").getID(),d,function(c){__p&&__p();var h=b("MercuryThreadInfo").isMuted(c),j=b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID());if(h)if(!b("MercuryThreadInfo").areMentionsMuted(c)){if(!a.profile_ranges||!a.profile_ranges.some||!a.profile_ranges.some(function(a){return a.id===j}))return}else return;var k=b("CurrentUser").getID();b("MessengerState.bs").compute(k,function(h){__p&&__p();h=h.blocked_ids;if(b("MercuryIgnoredBlockedParticipants.bs").isPresentInGroupThread(k,h,c))return;h=a.timestamp;if(e)f||m(h);else{b("ChatTitleBarBlinker").blink(d,h);var j=i.get(d)||0;j<g&&(i.set(d,j+1),m(h))}b("ChatTitleBarBlinker").blinkingElsewhere()})})}},b("ArbiterMixin"));e.exports=n}),null);
__d("MercuryLastMessageIndicator.react",["cx","fbt","MercuryIDs","MercuryMessageSourceTags","MercuryViewer","MessengerParticipants.bs","MessengerReadReceipt.bs","MessengerTextWithEmoticons.react","React","TooltipData","WorkModeConfig","XWorkplaceMarketingDefaultController","emptyFunction","formatDate","gkx","immutable","joinClasses"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i,j=b("immutable").Set;c=b("React").PropTypes;var k=function(a,c,d){a=b("MessengerReadReceipt.bs").getSeenTimestamp(a,d,c[0]);d=a.action*.001;return{seenTimestamp:d,seenByData:null}},l=function(a,c,d){__p&&__p();var e={};for(var f=a,g=Array.isArray(f),h=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(g){if(h>=f.length)break;i=f[h++]}else{h=f.next();if(h.done)break;i=h.value}i=i;e[i]=b("MessengerParticipants.bs").getNow(i)}i=null;c&&c.custom_nickname&&(i=c.custom_nickname);h={};g=Object.keys(e);for(var f=0;f<g.length;f++){var j=g[f],k=e[j],l;void 0;!k?l=b("MessengerParticipants.bs").getDefaultName():(l=k.short_name,i&&i[k.fbid]&&(l=i[k.fbid]));h[j]=l}var m;k=!1;j=!1;n(a,d,c)?j=!0:a.length==1?m=" "+h[a[0]]:a.length==2?m=" "+h[a[0]]+", "+h[a[1]]:a.length==3?m=" "+h[a[0]]+", "+h[a[1]]+", "+h[a[2]]:a.length>3&&(m=" "+h[a[0]]+", "+h[a[1]]+", ",k=!0);return{seenTimestamp:null,seenByData:{seenByAll:j,text:m,showTooltip:k,seenBy:a}}},m=function(a,c,d,e){e=b("MessengerReadReceipt.bs").getSeenBy(a,e,!0);if(e.length===0)return{seenTimestamp:null,seenByData:null};var f=b("MercuryIDs").getUserIDFromThreadID(d);if(f)return k(a,e,d);else return l(e,c)},n=function(a,c,d){var e=d?d.participants.length:0;a=a.length;c&&c.author!=b("MercuryViewer").getID()&&(!d||d.participants.indexOf(c.author)>-1)&&a++;return e>2&&a>=e-1};d=babelHelpers.inherits(a,b("React").Component);i=d&&d.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=i.constructor).call.apply(a,[this].concat(d)),this.state={seenTimestamp:null,seenByData:null},b}a.getDerivedStateFromProps=function(a,b){"use strict";return m(a.readReceipts,a.thread,a.threadID,a.lastMessage)};a.prototype.shouldComponentUpdate=function(a,b){"use strict";__p&&__p();if(a.thread!==this.props.thread||a.threadID!==this.props.threadID||a.lastMessage!==this.props.lastMessage||a.isTyping!==this.props.isTyping||a.readReceipts!==this.props.readReceipts||b.seenTimestamp!==this.state.seenTimestamp)return!0;a=this.state.seenByData;b=b.seenByData;if(!a&&!b)return!1;if(!a||!b)return!0;if(a.seenByAll!==b.seenByAll||a.showTooltip!==b.showTooltip||a.text!==b.text)return!0;return!j(a.seenBy).equals(j(b.seenBy))?!0:!1};a.prototype.componentDidUpdate=function(){"use strict";if(!this.isVisible())return;this.props.indicatorDidShow&&this.props.indicatorDidShow()};a.prototype.componentWillUnmount=function(){"use strict";this.$1&&this.$1.release()};a.prototype.$2=function(){"use strict";return!this.props.lastMessage?[]:this.props.lastMessage.source_tags||this.props.lastMessage.tags||[]};a.prototype.$3=function(){"use strict";if(this.props.isTyping)return b("React").createElement("div",{className:this.$4([])},b("React").createElement("div",{className:"_510h"}),b("React").createElement("span",{className:"_510f",ref:"text"},"\xa0"));var a=this.$2(),c=this.state.seenByData,d=this.state.seenTimestamp;if(c)return b("React").createElement("div",{className:this.$4(a)},b("React").createElement("div",{className:"_510h"}),b("React").createElement("span",{className:"_510f"},this.$5(c)));else if(d)return b("React").createElement("div",{className:this.$4(a)},b("React").createElement("div",{className:"_510h"}),b("React").createElement("span",{className:"_510f",ref:"text"},this.$6(d)));else return!b("WorkModeConfig").is_work_user?null:b("React").createElement("div",{className:this.$4(a)},b("React").createElement("div",{className:"_510h"}),b("React").createElement("span",{className:"_510f",ref:"text"},this.$7(a)))};a.prototype.render=function(){"use strict";return b("React").createElement("div",{className:"_4gd0"},this.$3())};a.prototype.$6=function(a){"use strict";var c=Date.now()*.001,d;a<c-518400?d="M j":a<c-86400?d="D g:ia":d="g:ia";return h._("Vu\u00a0: {timestamp}",[h._param("timestamp",b("formatDate")(a,d))])};a.prototype.$7=function(a){"use strict";__p&&__p();if(a.includes(b("MercuryMessageSourceTags").MESSENGER))if(!b("WorkModeConfig").is_work_user)return b("React").createElement("a",{href:"/mobile/messenger",className:"fcg",target:"_blank"},h._("Envoy\u00e9 depuis Messenger"));else return b("React").createElement("a",{href:"https://www.facebook.com/workplace/mobile/",className:"fcg",target:"_blank"},h._("Envoy\u00e9 depuis Workplace Chat"));else if(a.includes(b("MercuryMessageSourceTags").MOBILE)){var c=b("WorkModeConfig").is_work_user?"/workplace/mobile":"/mobile";return b("React").createElement("a",{href:c,className:"fcg",target:"_blank"},h._("Envoy\u00e9 depuis un mobile"))}else if(a.includes(b("MercuryMessageSourceTags").EMAIL))return b("React").createElement("span",null,h._("Envoy\u00e9 par e-mail"));else if(a.includes(b("MercuryMessageSourceTags").WORK_DESKTOP)){c=b("XWorkplaceMarketingDefaultController").getURIBuilder().setString("path","chat-app").setString("ref","last-message-indicator").getURI();return b("React").createElement("a",{href:c,className:"fcg",target:"_blank"},h._("Sent from the desktop app"))}return null};a.prototype.$4=function(a){"use strict";var c=this.props.lastMessage&&this.props.lastMessage.author&&b("MercuryViewer").isViewer(this.props.lastMessage.author);c="_510g"+(c?" _510e":"");var d=null;this.props.isTyping?d=null:this.state.seenByData!==null||this.state.seenTimestamp!==null?d="seen":a.includes(b("MercuryMessageSourceTags").MESSENGER)||a.includes(b("MercuryMessageSourceTags").MOBILE)?d="sentFromMobile":a.includes(b("MercuryMessageSourceTags").WORK_DESKTOP)?d="sentFromDesktop":a.includes(b("MercuryMessageSourceTags").EMAIL)&&(d="sentFromEmail");return b("joinClasses")(c,d)};a.prototype.isVisible=function(){"use strict";var a=this.$2();return a.includes(b("MercuryMessageSourceTags").MESSENGER)||a.includes(b("MercuryMessageSourceTags").MOBILE)||a.includes(b("MercuryMessageSourceTags").EMAIL)||a.includes(b("MercuryMessageSourceTags").WORK_DESKTOP)?!0:this.state.seenTimestamp!==null||this.state.seenByData!==null};a.prototype.$5=function(a){"use strict";__p&&__p();var c=a.seenByAll;if(c)return h._("Vu par tout le monde");c=a.text;if(!c)return null;c=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoji:!0,renderEmoticons:!0,text:c});var d=a.showTooltip;if(!d)return h._("Vu par {names}",[h._param("names",c)]);else{d=this.$8(a);return h._("Vu par {names}{=num more link}",[h._param("names",c),h._param("=num more link",d)])}};a.prototype.$8=function(a){"use strict";__p&&__p();if(!a.text||!a.showTooltip)return null;var c={},d=0,e=null;b("MessengerParticipants.bs").getMulti(a.seenBy,function(b){e=a.seenBy.map(function(a){return b[a].name}).join("\r\n"),d=Object.keys(b).length-2});c=Object.assign({"data-tooltip-alignh":"center"},b("TooltipData").propsFor(e,"above"));var f=h._({"*":"{num} autres"},[h._param("num",d,[0])]);return b("React").createElement("span",babelHelpers["extends"]({className:"more"},c),f)};a.propTypes={indicatorDidShow:c.func,lastMessage:c.object,readReceipts:c.any,threadID:c.string.isRequired,isTyping:c.bool.isRequired};a.defaultProps={indicatorDidShow:b("emptyFunction")};e.exports=a}),null);
__d("MercuryMessageRendererUtils",["cx","invariant","HovercardLink","MercuryViewer","MessengerTextWithEmoticons.react","React"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();a={getLinkToParticipant:function(a,c){var d=a.fbid,e=b("HovercardLink").constructEndpoint({id:d});c=c&&c.custom_nickname&&c.custom_nickname[d];c&&(c=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:c}));d=c?c:a.name;return a.href?b("React").createElement("a",{className:"_5wzt",href:a.href,"data-hovercard":e},d):d},moveCurrentUserToFront:function(a){a===void 0&&(a=[]);a||h(0,2427);var c=a.indexOf(b("MercuryViewer").getID());if(c>0){c=a.filter(function(a){return a!==b("MercuryViewer").getID()});return[b("MercuryViewer").getID()].concat(c)}return a}};e.exports=a}),null);
__d("convertMIGColorToFIGColor",["cssVar"],(function(a,b,c,d,e,f,g){"use strict";var h={"#0077e5":"#4080ff","#44bec7":"#54C7EC","#ffc300":"#f5c33b","#fa3c4c":"#F35369","#d696bb":"#d696bb","#6699cc":"#7596c8","#13cf13":"#42b72a","#ff7e29":"#F7923B","#e68585":"#e68585","#7646ff":"#8C72CB","#20cef5":"#54C7EC","#67b868":"#A3CE71","#d4a88c":"#cfa588","#ff5ca1":"#EC7EBD","#a695c7":"#AF9CDA"};function a(a){return a&&h[a]||a||""}e.exports=a}),null);
__d("MercuryLogMessageRenderer",["cx","fbt","invariant","ix","Bootloader","CSS","CurrentUser","Image.react","MercuryAttachmentViewer","MercuryLogMessageType","MercuryMessageRendererUtils","MercuryViewer","MessagingSourceEnum","MessengerAdminGroupUtils","MessengerLightweightActionUtils","MessengerParticipants.bs","MessengerState.bs","MessengerTextWithEmoticons.react","React","ReactDOM","TooltipLink.react","UserAgent","convertMIGColorToFIGColor"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();a={renderText:function(a,c,d,e){__p&&__p();c=c||b("MessengerState.bs").getThreadMetaNow(b("CurrentUser").getID(),a.thread_id);if(b("MessengerLightweightActionUtils").isLWAMessage(a)){e(b("MessengerLightweightActionUtils").getCollapsedLWAText(a));return}switch(a.log_message_type){case b("MercuryLogMessageType").SUBSCRIBE:var f=a.author;a.log_message_data||i(0,2425);var g=a.log_message_data.added_participants;g||i(0,2426);f=g.length===1&&f===g[0];g=c&&b("MessengerAdminGroupUtils").isWorkGroupSyncedChat(c)&&b("MessengerAdminGroupUtils").isWorkSyncedChatThreadMemberSyncMessage(a);f||g?b("Bootloader").loadModules(["MercuryJoinableMessageRenderer"],function(b){b.renderText(a,c,e)},"MercuryLogMessageRenderer"):m(a,e);break;case b("MercuryLogMessageType").UNSUBSCRIBE:b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?A(a,e):s(a,e):r(a,e);break;case b("MercuryLogMessageType").THREAD_NAME:c&&b("MessengerAdminGroupUtils").isWorkGroupSyncedChat(c)&&b("MessengerAdminGroupUtils").isWorkSyncedChatThreadCreationMessage(a)?v(a,e):c&&b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?B(a,c,e):t(a,c,e):w(a,c,e);break;case b("MercuryLogMessageType").THREAD_IMAGE:c&&b("MessengerAdminGroupUtils").isJoinableThread(c)?b("MessengerAdminGroupUtils").isGroupChat(c)?C(a,c,e):x(a,c,e):y(a,c,e);break;case b("MercuryLogMessageType").WALLPAPER:z(a,e);break;case b("MercuryLogMessageType").GENERIC_ADMIN_TEXT:var h=b("convertMIGColorToFIGColor")(c&&c.solid_color);b("Bootloader").loadModules(["MercuryXMATRenderer"],function(b){e(b.renderText(h,a,d))},"MercuryLogMessageRenderer");break;default:b("Bootloader").loadModules(["MercurySpecialLogMessageRenderer"],function(b){b.renderText(a,e)},"MercuryLogMessageRenderer");break}},renderIcon:function(a){return b("React").createElement(b("Image.react"),{className:k(a.log_message_type,a.log_message_data),src:j("99239")})},renderLegacy:function(a,c,d,e){k(e.log_message_type,e.log_message_data).split(" ").forEach(function(c){return c&&b("CSS").addClass(a,c)}),this.renderText(e,null,!1,function(a){b("ReactDOM").render(b("React").createElement("span",null,a),c)}),this.renderAttachmentLegacy(d,e)},renderAttachmentLegacy:function(a,c){if(c.log_message_type===b("MercuryLogMessageType").THREAD_IMAGE){c.log_message_data||i(0,2425);var d=c.log_message_data.image;d&&d.preview_url&&(b("ReactDOM").render(b("React").createElement(b("Image.react"),{className:"_z6a",onClick:function(){return l(d)},src:d.preview_url}),a),b("CSS").show(a))}}};e.exports=a;function k(a,c){c=!!(c&&c.answered);return"_5wzu"+(a===b("MercuryLogMessageType").SUBSCRIBE?" _5wzj":"")+(a===b("MercuryLogMessageType").UNSUBSCRIBE?" _5wzk":"")+(a===b("MercuryLogMessageType").THREAD_NAME?" _5wzl":"")+(a===b("MercuryLogMessageType").THREAD_IMAGE?" _5wzm":"")+(a===b("MercuryLogMessageType").VIDEO_CALL&&c?" _5wzn":"")+(a===b("MercuryLogMessageType").VIDEO_CALL&&!c?" _5wzo":"")+(a===b("MercuryLogMessageType").PHONE_CALL&&c?" _5wzp":"")+(a===b("MercuryLogMessageType").PHONE_CALL&&!c?" _5wzq":"")+(a===b("MercuryLogMessageType").SERVER_ERROR?" _5wzr":"")+(a?"":" _2r5l")}function l(a){b("MercuryAttachmentViewer").bootstrapWithConfig({src:a.preview_url,endpoint:a.url,fbid:a.metadata.fbid,dimensions:a.metadata.dimensions,disablePaging:!0},null)}function m(a,c){__p&&__p();a.log_message_data||i(0,1204);var d=b("MercuryMessageRendererUtils").moveCurrentUserToFront(a.log_message_data.added_participants);d||i(0,1205);switch(d.length){case 1:n(a,c,d);break;case 2:o(a,c,d);break;case 3:p(a,c,d);break;default:q(a,c,d);break}}function n(a,c,d){var e=[a.author,d[0]];b("MessengerParticipants.bs").getMulti(e,function(e){a.author===b("MercuryViewer").getID()?c(h._("Vous avez ajout\u00e9 {subscriber1}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]]))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} vous a ajout\u00e9(e).",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author]))])):c(h._("{actor} a ajout\u00e9 {subscriber1}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]]))]))})}function o(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){a.author===b("MercuryViewer").getID()?c(h._("Vous avez ajout\u00e9 {subscriber1} et {subscriber2}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} vous a ajout\u00e9(e), avec {subscriber2}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))])):c(h._("{actor} a ajout\u00e9 {subscriber1} et {subscriber2}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]]))]))})}function p(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){a.author===b("MercuryViewer").getID()?c(h._("Vous avez ajout\u00e9 {subscriber1}, {subscriber2} et {subscriber3}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]])),h._param("subscriber3",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[2]]))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} vous a ajout\u00e9(e), avec {subscriber2} et {subscriber3}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]])),h._param("subscriber3",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[2]]))])):c(h._("{actor} a ajout\u00e9 {subscriber1}, {subscriber2} et {subscriber3}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[0]])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[1]])),h._param("subscriber3",b("MercuryMessageRendererUtils").getLinkToParticipant(e[d[2]]))]))})}function q(a,c,d){var e=[a.author].concat(d);b("MessengerParticipants.bs").getMulti(e,function(e){function f(a){var c=b("React").createElement("div",null,a.map(function(a){return b("React").createElement("div",null,a.name)}));return b("React").createElement(b("TooltipLink.react"),{alignH:"center",position:"above",tooltip:c},h._({"*":"{num} de plus"},[h._param("num",a.length,[0])]))}var g=d.map(function(a){return e[a]});a.author===b("MercuryViewer").getID()?c(h._("Vous avez ajout\u00e9 {subscriber1}, {subscriber2} et {more_people}.",[h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(g[0])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))])):d[0]===b("MercuryViewer").getID()?c(h._("{actor} vous a ajout\u00e9(e), avec {subscriber2} et {more_people}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))])):c(h._("{actor} a ajout\u00e9 {subscriber1}, {subscriber2} et {more_people}.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e[a.author])),h._param("subscriber1",b("MercuryMessageRendererUtils").getLinkToParticipant(g[0])),h._param("subscriber2",b("MercuryMessageRendererUtils").getLinkToParticipant(g[1])),h._param("more_people",f(g.slice(2)))]))})}function r(a,c){__p&&__p();var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("Vous avez quitt\u00e9 la conversation.")):c(h._("Vous avez retir\u00e9 {name} de la conversation.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} a quitt\u00e9 la conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._("{actor} vous a retir\u00e9 de la conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} a retir\u00e9 {name} de la conversation.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function s(a,c){__p&&__p();var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("Vous avez quitt\u00e9 le salon.")):c(h._("Vous avez supprim\u00e9 {name} du salon.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} left the room.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._("{actor} vous a supprim\u00e9 du salon.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} a supprim\u00e9 {name} du salon.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function t(a,c,d){__p&&__p();a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(a.author===b("MercuryViewer").getID())if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("Vous avez nomm\u00e9 le salon\u00a0: {name}.",[h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("Vous avez supprim\u00e9 le nom du salon."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} a nomm\u00e9 le salon\u00a0: {name}.",[h._param("actor",a),h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("{actor} a supprim\u00e9 le nom du salon.",[h._param("actor",a)]))})}function u(a,c,d,e,f){a.author===b("MercuryViewer").getID()?f(h._("Vous avez nomm\u00e9 le groupe {thread_name}. Votre groupe est aussi sur Facebook.",[h._param("thread_name",b("React").createElement("span",{className:e},b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:d})))])):b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);f(h._("{actor} a nomm\u00e9 le groupe {thread_name}. Votre groupe est aussi sur Facebook.",[h._param("actor",a),h._param("thread_name",b("React").createElement("span",{className:e},b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:d})))]))})}function v(a,c){a.log_message_data||i(0,2425);a=a.log_message_data.name;var d="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(a){c(h._("Vous pouvez \u00e0 pr\u00e9sent discuter avec {name} sur Workplace Chat.",[h._param("name",b("React").createElement("span",{className:d},b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:a})))]));return}}function w(a,c,d){__p&&__p();a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(e&&a.tags&&a.tags.indexOf(b("MessagingSourceEnum").EVENT_UPCOMING_BUMP)!==-1)d(h._("Le groupe a \u00e9t\u00e9 nomm\u00e9 {name}.",[h._param("name",b("React").createElement("span",{className:f},b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e})))]));else if(e&&a.tags&&a.tags.indexOf(b("MessagingSourceEnum").GROUPSYNC_NAMING)!==-1)u(a,c,e,f,d);else if(a.author===b("MercuryViewer").getID())if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("Vous avez nomm\u00e9 la conversation\u00a0: {name}.",[h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("Vous avez supprim\u00e9 le nom de la conversation."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} a nomm\u00e9 la conversation\u00a0: {name}.",[h._param("actor",a),h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("{actor} a supprim\u00e9 le nom de la conversation.",[h._param("actor",a)]))})}function x(a,c,d){a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("Vous avez chang\u00e9 la photo du salon.")):d(h._("Vous avez supprim\u00e9 la photo du salon."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} a chang\u00e9 la photo du salon.",[h._param("actor",e)])):d(h._("{actor} a supprim\u00e9 la photo du salon.",[h._param("actor",e)]))})}function y(a,c,d){a.tags!==undefined&&a.tags.indexOf(b("MessagingSourceEnum").EVENT_UPCOMING_BUMP)!==-1?d(h._("L\u2019image de la conversation a \u00e9t\u00e9 choisie.")):a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("Vous avez chang\u00e9 l\u2019image de la conversation.")):d(h._("Vous avez supprim\u00e9 l\u2019image de la conversation."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} a chang\u00e9 l\u2019image de la conversation.",[h._param("actor",e)])):d(h._("{actor} a supprim\u00e9 l\u2019image de la conversation.",[h._param("actor",e)]))})}function z(a,c){a.author===b("MercuryViewer").getID()?c(h._("Vous avez chang\u00e9 le fond d\u2019\u00e9cran.")):b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a);c(h._("{actor} a chang\u00e9 le fond d\u2019\u00e9cran.",[h._param("actor",a)]))})}function A(a,c){__p&&__p();var d=[a.author];a.log_message_data||i(0,2425);var e=a.log_message_data.removed_participants;e||i(0,2427);var f;e.length===1&&(f=e[0],d.push(f));b("MessengerParticipants.bs").getMulti(d,function(d){var e=d[a.author];d=d[f];a.author===b("MercuryViewer").getID()?!f||f===a.author?c(h._("Vous avez quitt\u00e9 la discussion.")):c(h._("Vous avez supprim\u00e9 {name} de la discussion.",[h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))])):!f||f===a.author?c(h._("{actor} a quitt\u00e9 la discussion.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):f===b("MercuryViewer").getID()?c(h._({"*":"{actor} vous a retir\u00e9 de la discussion.","2":"{actor} vous a retir\u00e9e de la discussion.","__vcg":1},[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e))])):c(h._("{actor} a supprim\u00e9 {name} de la discussion.",[h._param("actor",b("MercuryMessageRendererUtils").getLinkToParticipant(e)),h._param("name",b("MercuryMessageRendererUtils").getLinkToParticipant(d))]))})}function B(a,c,d){__p&&__p();a.log_message_data||i(0,2425);var e=a.log_message_data.name,f="_5wzs"+(b("UserAgent").isBrowser("Chrome")?" _4fbd":"");if(a.author===b("MercuryViewer").getID())if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("Vous avez nomm\u00e9 la discussion\u00a0: {name}.",[h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("Vous avez supprim\u00e9 le nom de la discussion."));else b("MessengerParticipants.bs").get(a.author,function(a){a=b("MercuryMessageRendererUtils").getLinkToParticipant(a,c);if(e){var g=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:e});d(h._("{actor} a nomm\u00e9 la discussion\u00a0: {name}.",[h._param("actor",a),h._param("name",b("React").createElement("span",{className:f},g))]))}else d(h._("{actor} a supprim\u00e9 le nom de la discussion.",[h._param("actor",a)]))})}function C(a,c,d){a.author===b("MercuryViewer").getID()?(a.log_message_data||i(0,2425),a.log_message_data.image?d(h._("Vous avez modifi\u00e9 l\u2019image de la discussion.")):d(h._("Vous avez supprim\u00e9 l\u2019image de la discussion."))):b("MessengerParticipants.bs").get(a.author,function(e){e=b("MercuryMessageRendererUtils").getLinkToParticipant(e,c);a.log_message_data||i(0,2425);a.log_message_data.image?d(h._("{actor} a modifi\u00e9 l\u2019image de la discussion.",[h._param("actor",e)])):d(h._("{actor} a supprim\u00e9 l\u2019image de la discussion.",[h._param("actor",e)]))})}}),null);
__d("MercuryLogMessage.react",["cx","fbt","DOM","DOMDimensions","Event","EventReminderRequestHelper","FantaDropdownMenuWebDriverTestIDs","MercuryLogMessageRenderer","MercuryLogMessageType","MessagingGenericAdminTextType","React","ReactDOM","ShimButton.react","cancelAnimationFrame","emptyFunction","formatDate","joinClasses","requestAnimationFrame","requireWeak"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i;c=b("React").PropTypes;var j=266;d=babelHelpers.inherits(a,b("React").Component);i=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=i.constructor).call.apply(a,[this].concat(e)),this.state={messageText:null,showEventReminderFlyout:!1},this.$4=function(){this.$5()}.bind(this),this.$9=function(){var a;a=(a=this.props.message)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.event_id:a:a:a;!this.state.showEventReminderFlyout&&a?b("EventReminderRequestHelper").fetchEventReminder(this.props.thread.thread_id,a,function(){this.$1&&this.setState({showEventReminderFlyout:!0})}.bind(this)):this.setState({showEventReminderFlyout:!1})}.bind(this),this.$11=function(a){a!==this.state.showEventReminderFlyout&&this.setState({showEventReminderFlyout:a})}.bind(this),c}a.prototype.componentDidMount=function(){this.$1=!0,this.UNSAFE_componentWillReceiveProps(this.props)};a.prototype.componentWillUnmount=function(){this.$1=!1,this.$2&&b("cancelAnimationFrame")(this.$2)};a.prototype.$3=function(){return b("React").createElement(b("ShimButton.react"),{form:"link",onClick:this.$4},h._("Afficher les messages pr\u00e9c\u00e9dents."))};a.prototype.$5=function(){var a=this.props.loadMoreMessages&&this.props.loadMoreMessages();if(!this.$1)return;if(a)this.setState({messageText:this.$3()});else{a=h._("Messages pr\u00e9c\u00e9dents introuvables.");this.setState({messageText:a})}};a.prototype.UNSAFE_componentWillReceiveProps=function(a){if(a.message.log_message_type===b("MercuryLogMessageType").SERVER_ERROR)return;b("MercuryLogMessageRenderer").renderText(a.message,a.thread,a.isLastOfType,function(a){this.$1&&this.setState({messageText:a})}.bind(this))};a.prototype.shouldComponentUpdate=function(a,b){return this.state.messageText!=b.messageText||a.maxWidth!==this.props.maxWidth||this.state.showEventReminderFlyout!==b.showEventReminderFlyout};a.prototype.componentDidUpdate=function(){this.$6();if(!this.refs.attachment)return;b("MercuryLogMessageRenderer").renderAttachmentLegacy(this.refs.attachment,this.props.message);b("DOM").scry(this.refs.wrap,"img").forEach(function(a){var c=b("Event").listen(a,"load",function(){this.$6(),c.remove()}.bind(this))}.bind(this))};a.prototype.render=function(){return b("React").createElement("div",babelHelpers["extends"]({},this.props,{className:b("joinClasses")(this.props.className,"_5ye6"),ref:"wrap",style:babelHelpers["extends"]({},this.props.style,this.$7()),title:b("formatDate")(new Date(this.props.message.timestamp),"g:ia")}),b("React").createElement("div",{className:"_5ye7"},b("MercuryLogMessageRenderer").renderIcon(this.props.message),b("React").createElement("span",{"data-testid":b("FantaDropdownMenuWebDriverTestIDs").LOG_MESSAGE_TEXT},this.state.messageText)),b("React").createElement("div",{className:"_5ye8",ref:"attachment"},this.$8()))};a.prototype.$8=function(){__p&&__p();var a;if(this.props.thread&&!this.props.thread.lightweight_event||!this.props.message.log_message_data)return null;if(!this.props.event||!this.props.event.exists)return null;a=(a=this.props.message)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.event_time:a:a:a;if(!a)return null;typeof a==="string"&&(a=parseInt(a,10));if(a<=Math.floor(Date.now()/1e3))return null;var c;b("requireWeak")("Link.react",function(a){c=a});var d;switch(this.props.message.log_message_data.message_type){case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE:d=h._("Modifier");break;default:d=null}a=b("React").createElement(c,{href:"#",onClick:this.$9,title:h._("Modifier l\u2019\u00e9v\u00e8nement"),ref:"event_rem_link"},d);this.props.displayItems&&(a=null);return b("React").createElement("span",null,a,this.$10())};a.prototype.$10=function(){__p&&__p();var a;if(!this.state.showEventReminderFlyout)return null;var c="right",d=b("ReactDOM").findDOMNode(this.refs.wrap);d&&d instanceof Element&&d.getBoundingClientRect().left<j&&(c="left");d={alignment:c,position:"above",contextRef:function(){return this.refs.event_rem_link}.bind(this),shown:this.state.showEventReminderFlyout,onToggle:this.$11};var e;b("requireWeak")("EventsActionsLogger",function(a){e=a});c={action_history:[{surface:e.Surface.MESSENGER_CHAT_TAB,mechanism:e.Mechanism.REMINDER_ADMIN_TEXT}]};a=(a=this.props.message)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.event_id:a:a:a;a={threadID:this.props.thread.thread_id,eventID:a,dialogProps:d,flyoutNoSheet:!0,isEditing:!0,actionContext:c};var f;b("requireWeak")("ChatEventReminderContainer.react",function(a){f=a});return b("React").createElement(f,a)};a.prototype.$7=function(){return this.props.maxWidth?{maxWidth:this.props.maxWidth}:null};a.prototype.$6=function(){this.$2&&b("cancelAnimationFrame")(this.$2);if(!this.$1)return;this.$2=b("requestAnimationFrame")(function(){this.props.onImageLoad&&this.props.onImageLoad(b("DOMDimensions").getElementDimensions(this.refs.wrap).height),delete this.$2}.bind(this))};a.propTypes={loadMoreMessages:c.func,maxWidth:c.number,message:c.object.isRequired,onImageLoad:c.func,thread:c.object,isLastOfType:c.bool.isRequired,event:c.object};a.defaultProps={onImageLoad:b("emptyFunction")};e.exports=a}),null);
__d("MercuryLogMessageContainer.react",["EventReminderStateStore","FluxContainer","MercuryLogMessage.react","React"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;g=babelHelpers.inherits(a,b("React").PureComponent);g&&g.prototype;a.getStores=function(){return[b("EventReminderStateStore")]};a.calculateState=function(a,c){a=(a=c.message)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.event_id:a:a:a;return{event:b("EventReminderStateStore").getEvent(c.thread?c.thread.thread_id:"",a)}};a.prototype.render=function(){return b("React").createElement(b("MercuryLogMessage.react"),{className:this.props.className,onLogMessageExpanded:this.props.onLogMessageExpanded,loadMoreMessages:this.props.loadMoreMessages,message:this.props.message,onImageLoad:this.props.onImageLoad,viewer:this.props.viewer,isPageMessage:this.props.isPageMessage,thread:this.props.thread,isLastOfType:this.props.isLastOfType,event:this.state.event})};function a(){g.apply(this,arguments)}e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);
__d("MessengerQuickReplyUtils",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={localizeTitleIfNecessary:function(a){return a.map(function(a){return a.content_type==="location"?Object.assign(a,{title:g._("Envoyer la position")}):a})}};e.exports=a}),null);
__d("MercuryQuickReply.react",["cx","BootloadedComponent.react","JSResource","MercuryIDs","MessengerQuickCamOrigins","MessengerQuickReplyUtils","MessengerViewerContactMethodsWebGraphQLQuery","React","WebGraphQL","XUISpinner.react","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").PureComponent);h=d&&d.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=h.constructor).call.apply(a,[this].concat(d)),this.state={viewerEmail:null,viewerPhone:null},b}a.prototype.componentDidMount=function(){this.$1(this.props.lastMessage)!==null&&this.props.quickReplyDidShow()};a.prototype.componentDidUpdate=function(a){this.$1(this.props.lastMessage)!==null&&this.$1(a.lastMessage)===null&&this.props.quickReplyDidShow(),this.$2(this.props.lastMessage)};a.prototype.render=function(){__p&&__p();var a=this.props.lastMessage,c=b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer);if(!a||a.author===c)return null;c=this.$1(a);if(Array.isArray(c)){var d=c.every(function(a){return a.content_type==="user_email"&&this.state.viewerEmail===null||a.content_type==="user_phone_number"&&this.state.viewerPhone===null}.bind(this));if(!d){d=b("MessengerQuickReplyUtils").localizeTitleIfNecessary(c);return b("React").createElement("div",{className:"_419m"},b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("MessengerBotsQuickReplyButtonList.react").__setRef("MercuryQuickReply.react"),bootloadPlaceholder:b("React").createElement(b("XUISpinner.react"),{className:"_5h-9"}),isSponsored:a.is_sponsored,messageId:a.message_id,options:d,pageId:b("MercuryIDs").getUserIDFromParticipantID(a.author),threadID:a.thread_id,quickCamOriginLocation:this.props.quickCamOriginLocation,viewer:this.props.viewer,viewerEmail:this.state.viewerEmail,viewerPhone:this.state.viewerPhone}))}}return null};a.prototype.$1=function(a){a=a&&a.platform_xmd&&JSON.parse(a.platform_xmd);return Array.isArray(a&&a.quick_replies)?a&&a.quick_replies:null};a.prototype.$2=function(a){__p&&__p();a=this.$1(a);if(!a||a.length===0)return;a.some(function(a){return a.content_type==="user_email"||a.content_type==="user_phone_number"})&&b("promiseDone")(b("WebGraphQL").exec(new(b("MessengerViewerContactMethodsWebGraphQLQuery"))({})),function(a){var b;b=(b=a)!=null?(b=b.viewer)!=null?(b=b.user)!=null?b.all_phones:b:b:b;a=(a=a)!=null?(a=a.viewer)!=null?a.all_emails:a:a;var c=b?b.find(function(a){return a.is_preferred}):null;!c&&b&&(c=b[0]);b=a?a.find(function(a){return a.is_primary}):null;this.setState({viewerEmail:(a=b)!=null?a.display_email:a,viewerPhone:(b=c)!=null?(b=b.phone_number)!=null?b.universal_number:b:b})}.bind(this))};a.propTypes={quickReplyDidShow:c.func.isRequired,lastMessage:c.object,quickCamOriginLocation:c.oneOf(b("MessengerQuickCamOrigins").getValues()).isRequired,threadID:c.string.isRequired,viewer:c.string.isRequired};e.exports=a}),null);
__d("MercuryThreadTitle.react",["fbt","MercuryIDs","MercuryParticipantListRenderer","MessengerParticipants.bs","MessengerTextWithEmoticons.react","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=h.constructor).call.apply(a,[this].concat(d)),this.$1=!1,this.state={participantNames:""},b}a.prototype.componentDidMount=function(){this.$1=!0,this.$2(this.props)};a.prototype.componentWillUnmount=function(){this.$1=!1};a.prototype.UNSAFE_componentWillReceiveProps=function(a){this.$2(a)};a.prototype.render=function(){return b("React").createElement("span",{className:this.props.className},this.props.thread.name?this.$3():this.state.participantNames,this.props.children)};a.prototype.getTitle=function(){return this.state.participantNames};a.prototype.$3=function(){var a=this.props.thread,c=this.props.maxTitle?this.props.maxTitle<a.name.length?a.name.slice(0,this.props.maxTitle)+"...":a.name:a.name;c=b("React").createElement(b("MessengerTextWithEmoticons.react"),{renderEmoticons:!0,renderEmoji:!0,text:c});return!a.unread_count||!this.props.showUnreadCount?c:this.$4(c,a.unread_count)};a.prototype.$2=function(a){__p&&__p();if(a.thread.name)return;this.setState({participantNames:""});var c=b("MercuryIDs").getParticipantIDFromUserID(a.viewer),d=a.thread.participants||[];d.length>1&&(d=d.filter(function(a){return a!=c}));b("MessengerParticipants.bs").getMulti(d,function(c){__p&&__p();if(!this.$1)return;var e=d.map(function(a){return c[a]}),f=a.thread.custom_nickname?{}:null,g=b("MessengerTextWithEmoticons.react");if(f)for(var h in a.thread.custom_nickname)f[h]=b("React").createElement(g,{renderEmoticons:!0,renderEmoji:!0,text:a.thread.custom_nickname[h]});g=new(b("MercuryParticipantListRenderer"))().setUseShortName(a.useShortName).setUseAndSeparator(a.useAndSeparator).setIsNewThread(a.isNewThread).setNickname(f).renderParticipantList(e);f=a.showUnreadCount&&a.thread.unread_count?this.$4(g,a.thread.unread_count):g;this.setState({participantNames:f})}.bind(this))};a.prototype.$4=function(a,b){return g._("{conversation-title} ({unread-count})",[g._param("conversation-title",a),g._param("unread-count",b)])};a.propTypes={className:c.string,isNewThread:c.bool,maxTitle:c.number,showUnreadCount:c.bool,thread:c.object.isRequired,useAndSeparator:c.bool,useShortName:c.bool,viewer:c.string.isRequired};a.defaultProps={isNewThread:!1,showUnreadCount:!1,useShortName:!1,useAndSeparator:!1};e.exports=a}),null);
__d("MercuryMessageGroup",["MercuryActionType","MercuryAttachmentType","MercuryShareAttachmentRenderLocations","MercuryThreadlistConstants","MessengerLightweightActionUtils","MessengerMessage.bs","enumerate","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={calculateMessageGroups:function(a,c){__p&&__p();var d=[],e=null,f={value:null};a=b("enumerate")(a);var h;while(!(h=a.next()).done){var i=g.canAppendMessageToLastGroup(f.value,h.value,c);i||(e=[],d.push(e));e.push(h.value);f=h}return d},canAppendMessageToLastGroup:function(a,c,d){var e=b("MercuryThreadlistConstants").GROUPING_THRESHOLD;if(!a||h(a,d)||h(c,d)||a.author!=c.author||a.timestamp<c.timestamp-e||a.is_spoof_warning!==c.is_spoof_warning||a.page_admin_notes||c.replied_to_message)return!1;d=b("MessengerMessage.bs").getPersona(a);e=b("MessengerMessage.bs").getPersona(c);if(!d&&!e)return!0;return!b("gkx")("678634")?!0:d===null||e===null?!1:d.id===e.id}};function h(a,c){var d=a.has_attachment;d&&(c===b("MercuryShareAttachmentRenderLocations").MESSENGER||c===b("MercuryShareAttachmentRenderLocations").CHAT)&&(d=i(a));return!!(b("MessengerLightweightActionUtils").isLWAMessage(a)||a.action_type==b("MercuryActionType").LOG_MESSAGE||d||a.html_body||a.body&&a.body.length>b("MercuryThreadlistConstants").MAX_CHARS_BEFORE_BREAK)}function i(a){a=a.attachments[0];return!a||a.attach_type===b("MercuryAttachmentType").STICKER||a.attach_type===b("MercuryAttachmentType").ANIMATED_IMAGE}e.exports=g}),null);
__d("MessageList.react",["cx","MercuryActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageGroup","MercuryShareAttachmentRenderLocations","MessagingGenericAdminTextType","MessengerCallLogEvent","MessengerDomIDs.bs","MessengerGrowthNewFriendBumpSubtype","MessengerLightweightActionUtils","MessengerMessage.bs","PagesMessageListGreeting.react","React","ReactDOM","gkx","immutable","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("MessengerDomIDs.bs").ids;c=b("React").PropTypes;var j=1e3*60*60,k=function(a){__p&&__p();var c;c=(c=a)!=null?(c=c.log_message_data)!=null?c.message_type:c:c;switch(c){case b("MessagingGenericAdminTextType").GROUP_POLL:return(c=a)!=null?(c=c.log_message_data)!=null?(c=c.untypedData)!=null?c.question_id:c:c:c;case b("MessagingGenericAdminTextType").INSTANT_GAME_UPDATE:return(c=a)!=null?(c=c.log_message_data)!=null?(c=c.untypedData)!=null?c.game_id:c:c:c;case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY:case b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP:return(c=a)!=null?(c=c.log_message_data)!=null?(c=c.untypedData)!=null?c.event_id:c:c:c;case b("MessagingGenericAdminTextType").CONFIRM_FRIEND_REQUEST:c=((c=a)!=null?(c=c.log_message_data)!=null?(c=c.untypedData)!=null?c.friend_request_subtype:c:c:c)||((c=a)!=null?(c=c.log_message_data)!=null?(c=c.untypedData)!=null?c.subtype:c:c:c);return!c||c.toLowerCase()!==b("MessengerGrowthNewFriendBumpSubtype").ICEBREAKER?null:n(a);case b("MessagingGenericAdminTextType").MESSENGER_ICEBREAKER_VOTE_CAST:return n(a);default:return null}},l=function(a){return b("MessengerLightweightActionUtils").isLWAMessage(a)?"lwa":null};d=babelHelpers.inherits(a,b("React").PureComponent);h=d&&d.prototype;function a(){var a,b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b=(a=h.constructor).call.apply(a,[this].concat(d)),this.state={activeMessageID:null,messageGroups:[],prevMessages:null},this.$5=function(a){this.setState(function(b){return{activeMessageID:b.activeMessageID===a?null:b.activeMessageID}})}.bind(this),this.$6=function(a){this.setState({activeMessageID:a})}.bind(this),b}a.getDerivedStateFromProps=function(a,c){if(c.prevMessages!==a.messages)return{messageGroups:b("MercuryMessageGroup").calculateMessageGroups(a.messages,a.location),prevMessages:a.messages};else return null};a.prototype.render=function(){__p&&__p();var a=this.props,c=a.DateBreak,d=a.forGameChat,e=a.location,f=a.MessageGroup;a=a.CollapsedLogMessageGroup;var g=[],h=[],n,s=this.props.thread&&this.props.thread.solid_color;s=s?{backgroundColor:s}:null;var t=this.state.activeMessageID,u=this.state.messageGroups,v=u.length,w=this.props.readReceipts,x=w.last();x=x?x.watermark:0;var y=b("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),z={};for(var A=this.props.messages.size-1;A>=0;A--){var B=this.props.messages.get(A),C=k(B)||l(B);C&&!z[C]&&(z[C]=B.message_id)}for(var C=0;C<v;C++){B=C>0?u[C-1]:null;A=B&&B.length>0?B[B.length-1]:null;B=u[C];var D=B[0],E=B[B.length-1],F=!1;if(!A||D.timestamp-A.timestamp>j){F=!0;A=b("React").createElement(c,{date:new Date(D.timestamp),key:"db:"+D.message_id,ref:"db:"+D.message_id});h.length===0&&g.push(A)}A=l(D);if(A&&z[A]!==D.message_id){A=this.$1(D,z);g.push(A);continue}if(D.action_type==b("MercuryActionType").LOG_MESSAGE){var G;A=(A=D)!=null?(A=A.log_message_data)!=null?A.message_type:A:A;G=(G=D)!=null?(G=G.log_message_data)!=null?(G=G.untypedData)!=null?G.friend_request_subtype:G:G:G;var H=A===b("MessagingGenericAdminTextType").PARTIES_PRESENCE,I=A===b("MessagingGenericAdminTextType").INSTANT_GAME_UPDATE,J=A===b("MessagingGenericAdminTextType").GROUP_POLL;G=A===b("MessagingGenericAdminTextType").MESSENGER_ICEBREAKER_VOTE_CAST||A===b("MessagingGenericAdminTextType").CONFIRM_FRIEND_REQUEST&&G&&G.toLowerCase()===b("MessengerGrowthNewFriendBumpSubtype").ICEBREAKER;var K=[b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY,b("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP].includes(A);if((e===b("MercuryShareAttachmentRenderLocations").CHAT||e===b("MercuryShareAttachmentRenderLocations").MESSENGER)&&(D.log_message_type===b("MercuryLogMessageType").VIDEO_CALL||D.log_message_type===b("MercuryLogMessageType").PHONE_CALL||A===b("MessagingGenericAdminTextType").MESSENGER_CALL_LOG&&(((A=D)!=null?(A=A.log_message_data)!=null?(A=A.untypedData)!=null?A.event:A:A:A)===b("MessengerCallLogEvent").MISSED_CALL||((A=D)!=null?(A=A.log_message_data)!=null?(A=A.untypedData)!=null?A.event:A:A:A)===b("MessengerCallLogEvent").ONE_ON_ONE_CALL_ENDED||b("gkx")("678642")))){A=this.$2(D,y,u,v,C,w,x,E,z);g.push(A)}else{A=this.$3(D,z);n=D.message_id;!I&&!J&&!K&&!G&&h.push(A);if(H&&b("gkx")("678643"))continue;(h.length===B.length||I||J||K||G)&&(this.$4(h,g,n,s,a),h=[]);(I||J||K||G)&&g.push(A)}continue}B=b("immutable").List(B);H=o(u,v,C,z);n=!q(w,B,H);I=p(x,E);J=r(this.props.deliveryTimestamp,E);K=B.first().author;G=K?b("MercuryIDs").getUserIDFromParticipantID(K):null;A=G&&this.props.onlineUsers?this.props.onlineUsers.includes(G):!1;K=b("MessengerMessage.bs").getPersona(E);g.push(b("React").createElement(f,{activeMessageID:m(t,B),author:B.first().author,deliveryTimestamp:J,forGameChat:d,hasDateBreak:F,isCanonical:this.props.isCanonical,isFromViewer:y===D.author,isPageMessage:this.props.isPageMessage,isOnline:A,key:"mg:"+D.message_id,lastReadTimestamp:I,maxBubbleWidth:this.props.maxBubbleWidth,messages:B,nextTimestamp:H,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$5,onMessageSelect:this.$6,onStickerClick:this.props.onStickerClick,onReplyToMessage:this.props.onReplyToMessage,pageID:this.props.isPageMessage===!0?this.props.viewer:null,persona:b("gkx")("678634")?K:null,readReceipts:n?w:b("immutable").OrderedMap(),ref:"mg:"+D.message_id,thread:this.props.thread,threadID:this.props.threadID,scrollToRepliedMessage:this.props.scrollToRepliedMessage}))}G=this.props.threadID||this.props.thread&&this.props.thread.thread_id||this.props.thread&&this.props.thread.thread_fbid;E=null;e===b("MercuryShareAttachmentRenderLocations").MESSENGER&&G&&this.props.isPageMessage&&(E=b("React").createElement(b("PagesMessageListGreeting.react"),{messageCount:h.length+v,threadID:G}));return b("React").createElement("div",{id:e===b("MercuryShareAttachmentRenderLocations").MESSENGER?i.CONVERSATION:null},E,g)};a.prototype.getMessageElement=function(a,c){__p&&__p();if(c===!0){var d=this.refs["db:"+a];if(d)return b("ReactDOM").findDOMNode(d)}d=this.$7(a);if(!d)return null;d=d[0].message_id;var e=this.refs["mg:"+d];if(!e)return null;return c===!0&&d===a?b("ReactDOM").findDOMNode(e):e.getMessageElement(a)};a.prototype.getMessageComponent=function(a){var b=this.$7(a);if(!b)return null;b=b[0].message_id;b=this.refs["mg:"+b];return!b?null:b.getMessage(a)};a.prototype.$7=function(a){return this.state.messageGroups.find(function(b){return b.some(function(b){return b.message_id===a})})};a.prototype.$4=function(a,c,d,e,f){a.length!==0&&(a.length>1?c.push(b("React").createElement(f,{key:"mg:"+d,style:e},a)):c.push(b("React").createElement("div",{key:"mg:"+d},a)))};a.prototype.$2=function(a,c,d,e,f,g,h,i,j){__p&&__p();var k,l,m=this.props.MessageGroup;l=((l=a)!=null?(l=l.log_message_data)!=null?l.untypedData:l:l)||{};k=(k=a)!=null?(k=k.log_message_data)!=null?k.message_type:k:k;if(k===b("MessagingGenericAdminTextType").MESSENGER_CALL_LOG){k={message_type:b("MessagingGenericAdminTextType").MESSENGER_CALL_LOG,caller:b("MercuryIDs").getParticipantIDFromUserID(b("nullthrows")(l.caller_id,"caller id")),callee:b("MercuryIDs").getParticipantIDFromUserID(b("nullthrows")(l.callee_id,"callee id")),server_info_data:l.server_info,thread_id:a.thread_fbid,answered:l.event!==b("MessengerCallLogEvent").MISSED_CALL,log_message_type:l.video?b("MercuryLogMessageType").VIDEO_CALL:b("MercuryLogMessageType").PHONE_CALL,event:l.event,added_participants:null,removed_participants:null,untypedData:null,image:null,name:null};a=babelHelpers["extends"]({},a,{log_message_data:k})}l={attach_type:"share",share:{style_list:["rtc_call_log","fallback"],log_message_body:a.log_message_body,log_message_data:a.log_message_data,log_message_type:a.log_message_type,timestamp:a.timestamp}};k=babelHelpers["extends"]({},a,{attachments:[l],body:""});l=b("immutable").List([k]);k=o(d,e,f,j);d=!q(g,l,k);e=p(h,i);f=r(this.props.deliveryTimestamp,i);return b("React").createElement(m,{author:l.first().author,deliveryTimestamp:f,forGameChat:this.props.forGameChat,isCanonical:this.props.isCanonical,isFromViewer:c===a.author,isPageMessage:this.props.isPageMessage,key:a.message_id,lastReadTimestamp:e,maxBubbleWidth:this.props.maxBubbleWidth,messages:l,nextTimestamp:k,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$5,onMessageSelect:this.$6,onStickerClick:this.props.onStickerClick,readReceipts:d?g:b("immutable").OrderedMap(),thread:this.props.thread,threadID:this.props.threadID})};a.prototype.$3=function(a,c){var d=this.props.LogMessage,e=k(a);c=e?c[e]:null;return a.log_message_type!==b("MercuryLogMessageType").SERVER_ERROR?b("React").createElement(d,{className:this.props.location===b("MercuryShareAttachmentRenderLocations").CHAT?"_5w0o":null,key:a.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:a,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,isPageMessage:this.props.isPageMessage,thread:this.props.thread,isLastOfType:c===a.message_id}):null};a.prototype.$1=function(a,c){c=c[b("nullthrows")(l(a),"other group id first message")];var d=this.props.LogMessage;return b("React").createElement(d,{className:this.props.location===b("MercuryShareAttachmentRenderLocations").CHAT?"_5w0o":null,key:a.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:a,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:c===a.message_id})};a.propTypes={CollapsedLogMessageGroup:c.func.isRequired,DateBreak:c.func.isRequired,deliveryTimestamp:c.number.isRequired,forGameChat:c.bool,isCanonical:c.bool,isPageMessage:c.bool,location:c.string.isRequired,LogMessage:c.func.isRequired,loadMoreMessages:c.func,MessageGroup:c.func.isRequired,messages:c.instanceOf(b("immutable").List).isRequired,onAttachmentLoad:c.func,onlineUsers:c.instanceOf(b("immutable").List),onStickerClick:c.func,onReplyToMessage:c.func,readReceipts:c.instanceOf(b("immutable").OrderedMap).isRequired,viewer:c.string.isRequired,thread:c.object,threadID:c.string,scrollToRepliedMessage:c.func};function m(a,b){return b.find(function(b){return b.message_id===a})?a:null}function n(a){return(a=a)!=null?(a=a.log_message_data)!=null?(a=a.untypedData)!=null?a.icebreaker_type:a:a:a}function o(a,c,d,e){if(d>=c-1)return Infinity;var f=a[d+1][0],g=l(f);if(g&&e[g]!==f.message_id||((g=f)!=null?g.action_type:g)==b("MercuryActionType").LOG_MESSAGE)return o(a,c,d+1,e);else return f.timestamp}function p(a,b){return b.timestamp>a?a:Infinity}function q(a,b,c){return b.isEmpty()||!a.isEmpty()&&(a.last().action<b.first().timestamp||a.first().action>=c)}function r(a,b){return b.timestamp>a?a:Infinity}e.exports=a}),null);
__d("MessengerEmojiSpan.react",["cx","EmojiLikeConstants","MessengerSupportedEmojiUtils","React","cssURL"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){if(this.props.entityKey==null)return null;var a=this.props.contentState.getEntity(this.props.entityKey);a=a.getData();a=a.type;a=b("MessengerSupportedEmojiUtils").getUrl(a,b("EmojiLikeConstants").size.SMALL);a=a?a:"";return b("React").createElement("span",{className:"_21wj",style:{backgroundImage:b("cssURL")(a)},"data-offset-key":this.props.offsetKey},b("React").createElement("span",{className:"_21wk"},this.props.children))};function a(){h.apply(this,arguments)}a.propTypes={children:c.arrayOf(c.object),contentState:c.object.isRequired,entityKey:c.string,offsetKey:c.string};e.exports=a}),null);
__d("MessengerEmoticonSpan.react",["cx","EmojiLikeConstants","EmoticonEmojiList","MessengerSupportedEmojiUtils","React","cssURL"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;c=b("React").PropTypes;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){if(this.props.entityKey==null)return null;var a=this.props.contentState.getEntity(this.props.entityKey);a=a.getData();a=a.type;a=b("EmoticonEmojiList").emote2emojis[a];a=b("MessengerSupportedEmojiUtils").getUrl(a,b("EmojiLikeConstants").size.XSMALL);a=a?a:"";return b("React").createElement("span",{className:"_21wj",style:{backgroundImage:b("cssURL")(a)},"data-offset-key":this.props.offsetKey},b("React").createElement("span",{className:"_21wk"},this.props.children))};function a(){h.apply(this,arguments)}a.propTypes={children:c.arrayOf(c.object),contentState:c.object.isRequired,entityKey:c.string,offsetKey:c.string};e.exports=a}),null);
__d("MessengerMentionsEntityDecorator.react",["cx","React"],(function(a,b,c,d,e,f,g){"use strict";var h;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){return b("React").createElement("span",{className:"_fy2"},this.props.children)};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("createMessengerMentionDraftEntity",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.createEntity("MENTION","SEGMENTED",{mid:b.getUniqueID()})}e.exports=a}),null);
__d("MercuryAudienceRestrictedTypeaheadDataSource",["CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("DataSource"));g=c&&c.prototype;function a(a){"use strict";a=a||{},a.kanaNormalization=!0,a.maxResults=b("MercuryTypeaheadConstants").COMPOSER_CHATTAB_MAX,a.minQueryLength=2,g.constructor.call(this,a),this.$MercuryAudienceRestrictedTypeaheadDataSource1=!1,this.$MercuryAudienceRestrictedTypeaheadDataSource2=!1,this.$MercuryAudienceRestrictedTypeaheadDataSource3={},this.$MercuryAudienceRestrictedTypeaheadDataSource4=!0,this.queryCache={},this.localCache={},this.queryIDs={}}a.prototype.dirty=function(){"use strict";return this};a.prototype.buildData=function(a){"use strict";return g.buildData.call(this,a)};a.prototype.query=function(a,b,c,d){"use strict";b=b||a.length===1;return g.query.call(this,a,b,c,d)};a.prototype.getQueryData=function(a,b){"use strict";return babelHelpers["extends"]({},g.getQueryData.call(this,a,b))};a.prototype.setEntry=function(a,b){"use strict";this.$MercuryAudienceRestrictedTypeaheadDataSource3[a]=b};a.prototype.getEntry=function(a){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource3[a]||null};a.prototype.getCachedShortProfileIDs=function(){"use strict";var a=b("ShortProfiles").getCachedProfileIDs();a=a.filter(function(a){var c=b("ShortProfiles").getNow(a);return a==b("CurrentUser").getID()||c&&(c.type===b("MercuryParticipantTypes").FRIEND||c.type===b("MercuryParticipantTypes").FB4C)});return a};a.prototype.isBootstrapped=function(){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource1};a.prototype.isBootstrapping=function(){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource2};a.prototype.processEntries=function(a,c){"use strict";a=a&&a.map(function(a){a.index==null&&(a.render_type===b("MercuryParticipantTypes").FRIEND||a.render_type===b("MercuryParticipantTypes").FB4C)&&(a.index=b("OrderedFriendsList").getActiveRank(a.uid));return a});return g.processEntries.call(this,a)};a.prototype.mergeUids=function(a,b,c,d){"use strict";b=b.sort(function(a,b){a=this.getEntry(a);b=this.getEntry(b);return a&&a.index&&b&&b.index?a.index-b.index:0}.bind(this));return g.mergeUids.call(this,a,b,c,d)};a.prototype.setQueryData=function(a,b){"use strict";return g.setQueryData.call(this,a)};a.prototype.respond=function(a,b,c){"use strict";return g.respond.call(this,a,b,c)};a.prototype.setShowThreads=function(a){"use strict";this.$MercuryAudienceRestrictedTypeaheadDataSource4=a};e.exports=a}),null);
__d("MercuryErrorInfo",["fbt","MercuryErrorType","MessengerMessage.bs"],(function(a,b,c,d,e,f,g){var h={getMessage:function(a){var b="";h.isConnectionError(a)?(b=g._("Ce message n\u2019a pas \u00e9t\u00e9 envoy\u00e9.").toString(),h.isTransient(a)&&(b=g._("{message} V\u00e9rifiez votre connexion Internet et cliquez pour r\u00e9essayer.",[g._param("message",b)]).toString())):(a&&a.description?b=a.description:b=g._("Le message n\u2019a pas pu \u00eatre envoy\u00e9.").toString(),h.isTransient(a)&&(b=g._("{message} Cliquez pour renvoyer.",[g._param("message",b)]).toString()));return b},isConnectionError:function(a){return a&&a.type==b("MercuryErrorType").TRANSPORT?a.code===1001||a.code===1004||a.code===1006:!1},isTransient:function(a){return a&&a.is_transient},isPermanent:function(a){return a?!this.isTransient(a):!1},hasErrorStatus:function(a){return b("MessengerMessage.bs").hasError(a)}};e.exports=h}),null);
__d("getGroupNameTooltipFromParticipantIDs",["fbt","MercuryViewer","MessengerParticipants.bs"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=10,i="\n";function a(a,c){__p&&__p();var d=[],e=b("MercuryViewer").getID();a=a&&a.filter(function(a){return a!==e});if(!a||!a.length){c(null);return}var f=a.length,j=f-h;j>1&&(a=a.slice(0,h));b("MessengerParticipants.bs").getMulti(a,function(a){for(var b in a){var e=a[b];d.push(e.name)}if(j>1){e=g._("et {number of hidden chat participants} autres.",[g._param("number of hidden chat participants",j)]);d.push(e)}c(d.join(i))})}function c(a){__p&&__p();var c=[],d=b("MercuryViewer").getID();a=a&&a.filter(function(a){return a!==d});if(!a||!a.length)return null;c=a.map(function(a){a=b("MessengerParticipants.bs").getNow(a);return a&&a.name}).filter(function(a){return!!a});a=a.length-(a.length-c.length)-h;if(a>1){c=c.slice(0,h);a=g._("et {number of hidden chat participants} autres.",[g._param("number of hidden chat participants",a)]);c.push(a)}return c.join(i)}e.exports={getGroupNameTooltipFromParticipantIDs:c,getGroupNameTooltipFromParticipantIDsAsync:a}}),null);
__d("getProfileRangesForContentState",["EmojiFormat.bs","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("emptyFunction").thatReturnsTrue;function a(a,c){__p&&__p();var d=[],e=0;a.getBlockMap().forEach(function(f){__p&&__p();var h=0,i=f.getText();f.findEntityRanges(g,function(g,i){__p&&__p();var j=f.getEntityAt(g);if(j){j=a.getEntity(j);if(j.getType()==="EMOTICON")h+=j.getData().originalEmoticon.length-1;else if(j.getType()==="EMOJI"){var k=j.getData().type;k=b("EmojiFormat.bs").codeStringToCodeArray(k);k=String.fromCodePoint.apply(String,k);h+=k.length-1}else if(j.getType()==="MENTION"){k=g+h+e;j=j.getData().mid;var l=null;c&&j===c?l="t":c&&j===c+"-active"?(j=c,l="a"):/^\d+$/.test(j)&&(l="p");l!==null&&d.push({id:j,offset:k,length:i-g,type:l})}}});e+=i.length+h+1});return d}e.exports=a}),null);
__d("getThreadTypeNameFromThreadType",["MessagingThreadType"],(function(a,b,c,d,e,f){"use strict";function a(a){for(var c in b("MessagingThreadType"))if(b("MessagingThreadType")[c]===a)return c;return""}e.exports=a}),null);
__d("getVisibleValueForContentStateWithMessengerEmoji",["EmojiFormat.bs","emptyFunction"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){__p&&__p();var c=a.getBlockMap().map(function(c){__p&&__p();var d=c.getText(),e="";c.findEntityRanges(b("emptyFunction").thatReturnsTrue,function(f,g){__p&&__p();var h=c.getEntityAt(f);if(!h)e+=d.slice(f,g);else{h=a.getEntity(h);if(h.getType()==="EMOTICON")e+=h.getData().originalEmoticon;else if(h.getType()==="EMOJI"){h=h.getData().type;h=b("EmojiFormat.bs").codeStringToCodeArray(h);e+=String.fromCodePoint.apply(String,h)}else e+=d.slice(f,g)}});return e});return c.join("\n")}e.exports=a}),null);
__d("insertMessengerEmojiIntoContentState",["DraftModifier","EmojiFormat.bs"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){var f=c.createEntity("EMOJI","IMMUTABLE",{type:a});f=f.getLastCreatedEntityKey();return b("DraftModifier").insertText(c,d,b("EmojiFormat.bs").codeStringToUnicode(a),e,f)}e.exports=a}),null);
__d("handleBeforeInputForMessengerEmoji",["EditorState","MessengerSupportedEmojiUtils","insertMessengerEmojiIntoContentState"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){var d=a.getSelection();if(!d.isCollapsed()||!c)return a;c=b("MessengerSupportedEmojiUtils").getEmojiMatchObj(c);if(!c||!c.is_supported)return a;c=b("insertMessengerEmojiIntoContentState")(c.emoji_key,a.getCurrentContent(),d,a.getCurrentInlineStyle());return b("EditorState").push(a,c,"insert-characters")}e.exports=a}),null);
__d("handleBeforeInputForMessengerEmoticon",["DraftModifier","EditorState","applyMessengerEmoticonToContentState"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=new RegExp(/[\s\'\".,!?]/);function a(a,c){var d=a.getSelection();if(!d.isCollapsed()||!c||!g.test(c))return a;var e=a.getCurrentContent();d=b("applyMessengerEmoticonToContentState")(e,d);if(d===e)return a;e=b("DraftModifier").insertText(d,d.getSelectionAfter(),c);return b("EditorState").push(a,e,"insert-characters")}e.exports=a}),null);
__d("handleSoftNewlineForMessengerEmoticon",["DraftModifier","EditorState","applyMessengerEmoticonToContentState"],(function(a,b,c,d,e,f){"use strict";function a(a){var c=a.getCurrentContent(),d=a.getSelection(),e=b("applyMessengerEmoticonToContentState")(c,d);c=b("DraftModifier").splitBlock(e,c===e?d:e.getSelectionAfter());return b("EditorState").push(a,c,"split-block")}e.exports=a}),null);
__d("MercuryTypingAnimation.react",["cx","React","joinClasses"],(function(a,b,c,d,e,f,g){"use strict";var h;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.prototype.render=function(){return b("React").createElement("div",{className:b("joinClasses")("_4a0v _1x3z",this.props.className)},b("React").createElement("div",{className:"_4b0g"},b("React").createElement("div",{className:"_5pd7"}),b("React").createElement("div",{className:"_5pd7"}),b("React").createElement("div",{className:"_5pd7"})))};function a(){h.apply(this,arguments)}e.exports=a}),null);
__d("MercuryCanonicalGroupThreadManager",["Bootloader","KeyedCallbackManager","MercuryIDs","MercuryPayloadSource","MercuryServerDispatcher","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MessengerServerPayloadTransformer.bs","SubscriptionsHandler"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){this.$1=a,this.$2=new(b("KeyedCallbackManager"))(),this.$3=b("MercuryServerPayloadPreprocessor").getForFBID(this.$1),this.$4={},this.$7(),this.$8(),this.$6={}}a.getForFBID=function(a){return g.getForFBID(a)};a.get=function(){return g.get()};a.prototype.getCanonicalGroupThreadIDForParticipants=function(a,b){a=this.$9(a);var c=this.$10(a);c=this.$2.executeOrEnqueue(c,b);this.$11(a);return c};a.prototype.unsubscribe=function(a){a&&this.$2.unsubscribe(a)};a.prototype.$10=function(a){return a.sort().join(",")};a.prototype.$12=function(a,c){c=b("MercuryIDs").getThreadIDFromThreadFBID(c);this.$2.setResource(a,c);this.$4[c]=a};a.prototype.$11=function(a){var c=this.$10(a);c={canonical_group_key:c,participants:a};b("MercuryServerDispatcher").trySend("/ajax/mercury/search_canonical_groups.php",c,null,this.$1)};a.prototype.$7=function(){b("MercuryServerDispatcher").registerEndpoints({"/ajax/mercury/search_canonical_groups.php":{request_user_id:this.$1,mode:b("MercuryServerDispatcher").IMMEDIATE,handler:function(a){this.handleUpdate(a)}.bind(this)}})};a.prototype.$9=function(a){a.indexOf(this.$1)===-1&&a.push(this.$1);return a};a.prototype.handleUpdate=function(a){if(a.graphql_payload){var c=b("MessengerServerPayloadTransformer.bs").transformThread(a.viewer,a.graphql_payload,a.for_page);this.$3.handleUpdate({threads:[c],payload_source:b("MercuryPayloadSource").SERVER_SEARCH})}c=a.canonical_group;if(c)for(var d in c)this.$12(d,c[d])};a.prototype.getNow=function(a){a=this.$10(this.$9(a));return this.$2.getResource(a)};a.prototype.$8=function(){b("Bootloader").loadModules(["MercuryThreadInformer"],function(a){a=a.getForFBID(this.$1);var c=new(b("SubscriptionsHandler"))();c.addSubscriptions(a.subscribe("threads-deleted",function(a,b){for(var c in b)this.$4[c]&&(this.$2.setResource(this.$4[c],undefined),delete this.$4[c])}.bind(this)));this.$5=c}.bind(this),"MercuryCanonicalGroupThreadManager")};var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInformer","UserActivity","debounceAcrossTransitions","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryConfig").delivery_timeout||12e4;a.getForFBID=function(a){return h.getForFBID(a)};a.get=function(){return h.get()};function a(a){this.$8=function(){if(this.$5.length===0&&Object.keys(this.$6).length===0)return;var a=this.$5.map(function(a){return a.message_id});a&&this.$2.sendDeliveryReceipts(a,this.$6);this.$6={};this.$5=[]}.bind(this),this.$1=a,this.$2=b("MercuryServerRequests").getForFBID(this.$1),this.$3=b("MercuryThreadInformer").getForFBID(this.$1),this.$4=b("MercuryThreadIDMap").getForFBID(this.$1),this.$5=[],this.$6={},this.$3.subscribe("messages-received",this.$7.bind(this)),b("UserActivity").subscribe(b("debounceAcrossTransitions")(this.$8,300,this))}a.prototype.$7=function(a,c){for(var d in c){a=c[d];a.forEach(function(a){this.$9(a)&&(this.$5.push(a),this.$4.getServerIDFromClientID(d,function(b){this.$6[b]||(this.$6[b]=[]),this.$6[b].push(a.message_id)}.bind(this)))}.bind(this))}(b("UserActivity").isActive(g)||b("gkx")("678665"))&&this.$8()};a.prototype.$9=function(a){var c=a.author?b("MercuryIDs").getUserIDFromParticipantID(a.author):null;if(c===this.$1)return!1;return!a.is_unread?!1:!0};var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MercurySyncEnvironment",["Arbiter","ChannelInitialData","CurrentUser","MercurySyncDeltaHandler","MessengerMQTTGating"],(function(a,b,c,d,e,f){"use strict";function a(){if(!b("ChannelInitialData").channelConfig&&!b("MessengerMQTTGating").isEnabled())return;b("MercurySyncDeltaHandler").get();b("Arbiter").inform("MercurySyncDeltaHandler/initSeqID",{fbid:b("CurrentUser").getAccountID(),seqID:b("ChannelInitialData").channelConfig?b("ChannelInitialData").channelConfig.sequenceId:0})}e.exports={setUp:a}}),null);
__d("MercuryTriodeSourceUtil",["MercurySourceType","MessengerEnvironment"],(function(a,b,c,d,e,f){"use strict";a={getMercuryTriodeSource:function(){return b("MessengerEnvironment").messengerdotcom?b("MercurySourceType").MESSENGER_WEB:b("MercurySourceType").TITAN_WEB}};e.exports=a}),null);
__d("shouldAddMRefParam",["isFacebookURI"],(function(a,b,c,d,e,f){a=function(a){if(!b("isFacebookURI")(a)||a.getFragment())return!1;return/^\/events\//.test(a.getPath())?!0:!1};e.exports=a}),null);
__d("isWebMessengerURI",[],(function(a,b,c,d,e,f){function a(a){return/^(\/messages)/.test(a.getPath())}e.exports=a}),null);
__d("MessengerHoverCardLink",["URI"],(function(a,b,c,d,e,f){var g={getBaseURI:function(){return new(b("URI"))("/ajax/hovercard/chat.php")},constructEndpoint:function(a){return new(b("URI"))(g.getBaseURI()).setQueryData({id:a.id,type:"chat"})}};e.exports=g}),null);
__d("MercuryTypeaheadDataSource",["CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles","WorkModeConfig"],(function(a,b,c,d,e,f){__p&&__p();var g,h=[],i={},j={},k={},l=[],m=[],n=[],o=!1,p=!1;c=babelHelpers.inherits(a,b("DataSource"));g=c&&c.prototype;function a(a){"use strict";a=a||{},a.kanaNormalization=!0,g.constructor.call(this,a),this.showDefaultList=a.showDefaultList||!1}a.prototype.dirty=function(){"use strict";this.$MercuryTypeaheadDataSource1=h;this.localCache=j;this.queryCache=i;this.queryIDs=k;this.defaultList=l;this.topEntryIDs=m;this.nullStateExclusions=n;return this};a.prototype.bootstrap=function(){"use strict";if(o||p)return!1;p=!0;b("ShortProfiles").fetchAll().then(function(){this.updateBootstrapData(),p=!1,o=!0,this.showDefaultList&&this.inform("show-default",{impressions:this.defaultList})}.bind(this),function(){}.bind(this));return!0};a.prototype.updateBootstrapData=function(){"use strict";__p&&__p();var a=this.getCachedShortProfileIDs(),c=b("WorkModeConfig").is_work_user?b("MercuryParticipantTypes").FB4C:b("MercuryParticipantTypes").FRIEND;a=a.map(function(a){var d=b("ShortProfiles").getNow(a),e=a==b("CurrentUser").getID()?c:d.type,f=[d.additionalName,d.alternateName].concat(d.searchTokens||[]).join(" "),g=d.name,h=null;return{uid:a,index:b("OrderedFriendsList").getActiveRank(a),text:g,subtext:h,tokens:f,localized_text:d.name,additional_text:d.additionalName,photo:d.thumbSrc,render_type:e,type:b("MercuryTypeaheadConstants").USER_TYPE}});a.length&&this.addEntries(a);if(!this.showDefaultList)return;m=a.sort(function(a,b){return a.index-b.index}).map(function(a){return a.uid});this.defaultList=this.buildData(m.slice(0,5));this.topEntryIDs=m};a.prototype.updateDefaultList=function(a){"use strict";if(!a)return;this.nullStateExclusions.includes(a)?this.nullStateExclusions=this.nullStateExclusions.filter(function(b){return b!==a}):this.nullStateExclusions.push(a);l=this.topEntryIDs.filter(function(a){return!this.nullStateExclusions.includes(a)}.bind(this));this.defaultList=this.buildData(l.slice(0,5))};a.prototype.query=function(a,b,c,d){"use strict";b=b||a.length===1;return g.query.call(this,a,b,c,d)};a.prototype.getQueryData=function(a,b){"use strict";return babelHelpers["extends"]({},g.getQueryData.call(this,a,b))};a.prototype.setEntry=function(a,b){"use strict";this.$MercuryTypeaheadDataSource1[a]=b};a.prototype.getEntry=function(a){"use strict";return this.$MercuryTypeaheadDataSource1[a]||null};a.prototype.getCachedShortProfileIDs=function(){"use strict";var a=b("ShortProfiles").getCachedProfileIDs();a=a.filter(function(a){var c=b("ShortProfiles").getNow(a);return a==b("CurrentUser").getID()||c.type===b("MercuryParticipantTypes").FRIEND||c.type===b("MercuryParticipantTypes").FB4C});return a};a.prototype.isBootstrapped=function(){"use strict";return o};a.prototype.isBootstrapping=function(){"use strict";return p};a.prototype.processEntries=function(a,c){"use strict";a=a.map(function(a){a.index==null&&(a.render_type===b("MercuryParticipantTypes").FRIEND||a.render_type===b("MercuryParticipantTypes").FB4C)&&(a.index=b("OrderedFriendsList").getActiveRank(a.uid));return a});return g.processEntries.call(this,a)};a.prototype.mergeUids=function(a,b,c,d){"use strict";b=b.sort(function(a,b){return this.getEntry(a).index-this.getEntry(b).index}.bind(this));return g.mergeUids.call(this,a,b,c,d)};a.prototype.setShowDefaultList=function(a){"use strict";this.showDefaultList=a};e.exports=a}),null);
__d("MessengerSecondarySearchFunnelConstants",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({MESSENGER_DOT_COM:"messenger_dot_com",WWW:"www"});b=Object.freeze({ABANDON:"abandon",CREATE_GROUP:"create_group",ENTER_THREAD:"enter_thread",RESULT_SELECTED:"result_selected",SEND:"send",SINGLE_RESULT_SELECTED:"single_result_selected"});c=Object.freeze({ACTION:"action"});d=Object.freeze({EXISTING_TAB:"existing_tab",JEWEL:"jewel",SIDEBAR:"sidebar",COMPOSER:"composer"});f=Object.freeze({END:"end",IMPRESSIONS:"impressions",MICRO_SESSION_ENDED:"micro_session_ended",MICRO_SESSION_STARTED:"micro_session_started",QUERY_CHANGED:"query_changed",RESULT_SELECTED:"result_selected",SOURCE_ENDED:"source_ended",SOURCE_STARTED:"source_started",START:"start",TOKEN_REMOVED:"token_removed"});var g=Object.freeze({BROADCAST:"broadcast",GROUP_CREATION:"group_creation",OMNIPICKER:"omnipicker",SHARE:"share"}),h=Object.freeze({DIRECT_SEND:"direct_send",ADD:"add"}),i=Object.freeze({FINISHED:"finished",FAILED:"failed"}),j=Object.freeze({BROADCAST:9500,GROUP_CREATE:9501}),k=Object.freeze({QUERY:"query",NO_QUERY:"no_query"}),l=Object.freeze({BOOTSTRAP:"bootstrap",LOCAL:"local",LOCAL_AND_SERVER:"local_and_server",LOCAL_CONTACTS:"local_contacts",ORDERED_GCF_FRIENDLIST:"local_ordered_gcf_friendlist",QUERY_CACHE:"query_cache",SERVER:"server",SHORT_PROFILES:"local_short_profiles",SUGGESTED_RECIPIENTS:"local_suggested_recipients"});e.exports={FUNNEL_NAME:"MESSENGER_SECONDARY_SEARCH_FUNNEL",CLIENTS:a,END_ACTIONS:b,END_REASONS:c,ENTRY_SURFACES:d,EVENTS:f,SEARCH_SURFACES:g,SELECTION_TYPES:h,SOURCE_STATUSES:i,LOGGING_IDS:j,MICRO_SESSION_TYPES:k,SOURCES:l}}),null);
__d("PagesMessageListGreeting.react",["cx","FluxContainer","PagesMessagingMercuryChatTabActions","PagesMessagingMercuryChatTabStore","React"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h;h=babelHelpers.inherits(a,b("React").PureComponent);h&&h.prototype;a.getStores=function(){return[b("PagesMessagingMercuryChatTabStore")]};a.calculateState=function(a,c){if(c.messageCount>0)return{shouldShowGreeting:!1};a=b("PagesMessagingMercuryChatTabStore").getStateByThread(c.threadID);return{greetingContent:a.pagesGreetingContent,shouldShowGreeting:a.pagesGreetingShouldShow}};a.prototype.componentDidMount=function(){b("PagesMessagingMercuryChatTabActions").requestGreetingConfig(this.props.threadID)};a.prototype.render=function(){return!this.state.shouldShowGreeting||!this.state.greetingContent||this.state.greetingContent.trim().length===0?null:b("React").createElement("div",{className:"_4fsh _3-8z"},this.state.greetingContent)};function a(){h.apply(this,arguments)}e.exports=b("FluxContainer").create(a,{withProps:!0})}),null);
__d("MercurySyncRTCEventLogTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){var d=b("MercurySyncNewMessageTransformer").transform(a,c),e=c.messageMetadata.actorFbId;a=e===a?c.messageMetadata.threadKey.otherUserFbId:a;var f=c.eventType==="VOICE_EVENT"?b("MercuryLogMessageType").PHONE_CALL:b("MercuryLogMessageType").VIDEO_CALL;d.action_type=b("MercuryActionType").LOG_MESSAGE;d.log_message_body=c.messageMetadata.adminText;d.log_message_data={answered:c.duration>0,callee:b("MercuryIDs").getParticipantIDFromUserID(a),caller:b("MercuryIDs").getParticipantIDFromUserID(e)};d.log_message_type=f;return d}e.exports={transform:a}}),null);